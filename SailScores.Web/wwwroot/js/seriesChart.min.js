!function(){for(var t=600,e=document.getElementsByClassName("results-chart"),a=0;a<e.length;a++)r(e[a].dataset.seriesId,"#"+e[a].id);function r(e,a){var r,n,i="/series/chart?seriesId="+e;function s(t,e){var a=e.races.find((e=>e.id===t.raceId)),r=e.races.filter((t=>t.date===a.date)),n=r.findIndex((t=>t.id===a.id))+1;return new Date(new Date(a.date).getTime()+24*n*60*60*1e3/(r.length+1))}function l(e,a){var r=Math.max(...a.entries.filter((t=>t.raceId===e.raceId)).map((t=>t.seriesPoints))),n=Math.min(...a.entries.filter((t=>t.raceId===e.raceId&&0!==t.seriesPoints)).map((t=>t.seriesPoints))),i=Math.min(...a.entries.filter((t=>t.raceId===e.raceId&&0!==t.seriesPoints&&null!==t.seriesPoints)).map((t=>t.seriesPoints)));n=Math.max(n,i-10);var s=Math.max(e.seriesPoints-n,0)/(r-n);return a.isLowPoints||(s=1-s),isNaN(s)&&(s=0),0===e.seriesPoints&&(s=1),30+s*(t-30-30)}function o(t){var e=d3.select(t.node().parentNode),a=parseInt(t.style("width")),r=parseInt(t.style("height")),n=a/r;function i(){var r=parseInt(e.style("width"));r<=100&&(r=a),t.attr("width",r),t.attr("height",Math.round(r/n))}t.attr("viewBox","0 0 "+a+" "+r).attr("preserveAspectRatio","xMinYMid").call(i),d3.select(window).on("resize."+e.attr("id"),i)}"undefined"!=typeof d3&&null!=d3&&d3.json(i).then((function(e){if(null!==e){var i=e.races.map((t=>new Date(t.date)));r=new Date(Math.min.apply(null,i)),(n=new Date(Math.max.apply(null,i))).setDate(n.getDate()+1);var c=d3.scaleTime().domain([r,n]).range([30,780]),d=d3.scaleOrdinal(d3.schemeDark2);t=16*e.competitors.length+60;var p=d3.select(a).attr("width",960).attr("height",t).call(o),m=d3.select(a).selectAll("g.legendEntry").attr("transform","translate(810,32)").data(e.competitors).enter().append("g").attr("class","legendEntry").attr("data-compId",(t=>t.id)).attr("transform",(function(t,e){return"translate(810,"+(16*e+2+20)+")"})).attr("opacity",1).on("mouseover",g).on("mouseout",x);m.append("rect").attr("width",149).attr("height",16).attr("fill","none").attr("stroke-width",2),m.append("rect").attr("width",18).attr("height",12).attr("x",2).attr("y",2).style("fill",(t=>d(t.id))).style("stroke-width",0),m.append("text").attr("x",22).attr("y",12).style("font-size","11px").text((function(t){return t.name}));var h=d3.axisTop().scale(c),y=d3.select("html").attr("lang").substring(0,2);(r-n<864e6||"en"!==y)&&(h=h.tickFormat("")),p.append("g").attr("id","xAxisG").attr("transform","translate(0,20)").call(h);var f=d3.line().x((t=>c(s(t,e)))).y((t=>l(t,e)));p.selectAll("path.compLine").data(e.competitors).enter().append("path").attr("class","compLine").attr("d",(t=>f(e.entries.filter((e=>e.competitorId===t.id))))).attr("fill","none").attr("opacity",1).attr("stroke",(t=>d(t.id))).attr("stroke-width",1).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("data-compId",(t=>t.id)).on("mouseover",g).on("mouseout",x),p.selectAll("circle").data(e.entries).enter().append("circle").attr("r",3).attr("cy",(t=>l(t,e))).attr("cx",(t=>c(s(t,e)))).attr("data-compId",(t=>t.competitorId)).attr("fill",(t=>d(t.competitorId))).on("mouseover",(function(t){u.attr("transform","translate("+c(s(t,e))+","+(l(t,e)-16)+")").attr("opacity",1).select("text").selectAll("*").remove(),u.select("text").append("tspan").text((a=t.raceId,e.races.find((t=>t.id===a)).shortName)),u.select("text").append("tspan").attr("x",5).attr("y",27).text("Race Score: "+t.racePlace),u.select("text").append("tspan").attr("x",5).attr("y",43).text("Series Score: "+t.seriesPoints),g(t);var a})).on("mouseout",x);var u=p.append("g").attr("opacity",0);u.append("rect").attr("width",120).attr("height",48).attr("fill","white").attr("fill-opacity",".7"),u.append("text").attr("x",5).attr("y",11).style("font-size","11px")}function g(t){var e=t.competitorId||t.id;p.selectAll("path.compLine").attr("opacity",.4),p.selectAll("path[data-compId='"+e+"']").attr("stroke-width",4).attr("opacity",1),p.selectAll("g.legendEntry").attr("opacity",.4),p.selectAll("g.legendEntry[data-compId='"+e+"']").attr("opacity",1),p.selectAll("g.legendEntry[data-compId='"+e+"'] rect").attr("stroke",(t=>d(t.id))),p.selectAll("circle").attr("opacity",.4),p.selectAll("circle[data-compId='"+e+"']").attr("opacity",1)}function x(e){p.selectAll("path.compLine").attr("stroke-width",1.5),p.selectAll("path.compLine").attr("opacity",1),p.selectAll("g.legendEntry rect").attr("stroke","none"),u.attr("opacity",0).attr("transform","translate(960,"+t+")"),p.selectAll("path.compLine").attr("opacity",1),p.selectAll("g.legendEntry").attr("opacity",1),p.selectAll("circle").attr("opacity",1)}}))}}();
//# sourceMappingURL=seriesChart.js.map