!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}([function(e,t){e.exports=jQuery},function(e,t){e.exports=bootstrap},function(e,t){e.exports=window["bootstrap-select"]},,,,,,,,,,,function(e,t,n){e.exports=n(14)},function(e,t,n){"use strict";n.r(t),n.d(t,"initialize",(function(){return i})),n.d(t,"loadSeriesOptions",(function(){return l})),n.d(t,"loadFleet",(function(){return c})),n.d(t,"dateChanged",(function(){return u})),n.d(t,"weatherChanged",(function(){return s})),n.d(t,"raceStateChanged",(function(){return d})),n.d(t,"compCreateSubmit",(function(){return m})),n.d(t,"completeCompCreate",(function(){return p})),n.d(t,"completeCompCreateFailed",(function(){return f})),n.d(t,"hideAlert",(function(){return v})),n.d(t,"moveUp",(function(){return g})),n.d(t,"moveDown",(function(){return h})),n.d(t,"deleteResult",(function(){return b})),n.d(t,"confirmDelete",(function(){return y})),n.d(t,"hideScoreButtonFooter",(function(){return S})),n.d(t,"addNewCompetitorFromButton",(function(){return C})),n.d(t,"calculatePlaces",(function(){return N}));var o=n(0),a=n.n(o);n(1),n(2);function r(e){const t=e||event;return/textarea/i.test(t.srcElement.tagName)||13!==(e.keyCode||e.which||e.charCode||0)}function i(){if(document.querySelector("form").onkeypress=r,a()("#fleetId").change(c),"True"===a()("#needsLocalDate").val()){var e=new Date;e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),a()("#date").val(e.toISOString().substring(0,10)),a()("#needsLocalDate").val("")}a()("#date").change(u),a()("#raceState").data("previous",a()("#raceState").val()),a()("#raceState").change(d),a()(".weather-input").change(s),a()("#results").on("click",".select-code",N),a()("#results").on("click",".move-up",g),a()("#results").on("click",".move-down",h),a()("#results").on("click",".delete-button",y),a()("#scoreButtonDiv").on("click",".add-comp-enabled",C),a()("#deleteConfirmed").click(b),a()("#closefooter").click(S),a()("#compform").submit(m),a()("#raceform").submit((function(e){!function(e){!function(e){a()(e).find("[name^=Scores]").remove()}(e);for(var t=document.getElementById("results").getElementsByTagName("li"),n=1;n<t.length;n++){const a=(n-1).toString();var o=document.createElement("input");o.type="hidden",o.name="Scores["+a+"].competitorId",o.value=t[n].getAttribute("data-competitorId"),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+a+"].place",z(t[n])&&(o.value=t[n].getAttribute("data-place")),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+a+"].code",o.value=j(t[n]),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+a+"].codePointsString",o.value=_(t[n]),e.appendChild(o)}}(document.getElementById("raceform"))})),c(),l(),N(),a()("#submitButton").prop("disabled",!1),a()("#submitDisabledMessage").prop("hidden",!0),H(null)}function l(){!function(e,t){e&&t&&a.a.getJSON("/api/Series",{clubId:e,date:t},(function(e){D=e,function(){let e=a()("#seriesIds");var t=e.val();e.empty(),a.a.each(D,(function(t,n){let o=n;e.append(a()("<option></option>").attr("value",o.id.toString()).text(o.name))})),e.selectpicker("destroy"),e.selectpicker(),e.val(t),e.selectpicker("refresh")}()}))}(a()("#clubId").val(),a()("#date").val())}function c(){let e=a()("#clubId").val(),t=a()("#fleetId").val(),n=document.getElementById("fleetId"),o=n.options[n.selectedIndex].getAttribute("data-boat-class-id");o&&a()("#createCompBoatClassSelect").val(o),t.length<30?a()("#createCompButton").prop("disabled",!0):a()("#createCompButton").prop("disabled",!1),a()("#createCompFleetId").val(t),x(e,t)}function u(){console.log("dateChanged"),l(),"true"===a()("#defaultWeather").val()&&(console.log("defaultWeather was true"),G())}function s(){a()("#defaultWeather").val("false")}function d(){let e=a()("#raceState").val();var t;"2"===e&&G(),"1"===e&&"4"!==a()("#raceState").data("previous")&&(t=a()("#clubInitials").val(),a.a.getJSON("/"+t+"/weather/current/",{},(function(e){e.icon&&a()("#weatherIcon").val(null)&&(a()("#weatherIcon").val(e.icon),a()("#weatherIcon").selectpicker("refresh")),e.description&&a()("#weatherDescription").val(null)&&a()("#weatherDescription").val(e.description),e.windSpeed&&a()("#windSpeed").val(null)&&a()("#windSpeed").val(e.windSpeed),e.windGust&&a()("#windGust").val(null)&&a()("#windGust").val(e.windGust),e.windDirection&&a()("#windDirection").val(null)&&a()("#windDirection").val(e.windDirection),e.temperature&&a()("#temperature").val(null)&&a()("#temperature").val(e.temperature),e.humidity&&a()("#humidity").val(null)&&a()("#humidity").val(e.humidity),e.cloudCoverPercent&&a()("#cloudCover").val(null)&&a()("#cloudCover").val(e.cloudCoverPercent)}))),a()("#raceState").data("previous",e)}function m(e){e.preventDefault(),a()("#compLoading").show();var t=a()(this),n=t.attr("data-submit-url");return a.a.ajax({type:"POST",url:n,beforeSend:function(e){a()("#compLoading").show(),e.setRequestHeader("RequestVerificationToken",a()('input:hidden[name="__RequestVerificationToken"]').val())},data:t.serialize(),success:p,error:f}),a()("#compLoading").hide(),!1}function p(){x(a()("#clubId").val(),a()("#fleetId").val()),a()("#createCompetitor").modal("hide")}function f(){a()("#compCreateAlert").show()}function v(){a()("#compCreateAlert").hide()}function g(){var e=event.target,t=a()(e).closest("li");t.prev().insertAfter(t),N()}function h(){var e=event.target,t=a()(e).closest("li");t.next().insertBefore(t),N()}function b(){var e=a()("#deleteConfirm"),t=e.find("#compIdToDelete").val();a()("#results").find(`[data-competitorid='${t}']`).remove(),N(),P(),e.modal("hide")}function y(){var e=event.target,t=a()(e).closest("li"),n=t.data("competitorid"),o=t.find(".competitor-name").text();o||(o=t.find(".sail-number").text());var r=a()("#deleteConfirm");r.find("#competitorNameToDelete").text(o),r.find("#compIdToDelete").val(n),r.show()}function S(){a()("#scoreButtonFooter").hide()}function C(){if(!(event.target instanceof HTMLButtonElement))return;var e=event.target.dataset.competitorid;w(E.find(t=>t.id.toString()===e))}function w(e){var t=document.getElementById("results"),n=document.getElementById("competitorTemplate").cloneNode(!0);n.id=e.id.toString(),n.setAttribute("data-competitorId",e.id.toString());var o=n.getElementsByClassName("competitor-name")[0];o.appendChild(document.createTextNode(e.name||"")),(o=n.getElementsByClassName("sail-number")[0]).appendChild(document.createTextNode(e.sailNumber||"")),e.alternativeSailNumber&&((o=n.getElementsByClassName("alt-sail-number")[0]).appendChild(document.createTextNode(" ("+e.alternativeSailNumber+")")),o.style.display=""),(o=n.getElementsByClassName("race-place")[0]).appendChild(document.createTextNode((0).toString()));for(var r=n.getElementsByClassName("delete-button"),i=0;i<r.length;i++)r[i].setAttribute("data-competitorId",e.id.toString());n.style.display="",B(e)||(t.appendChild(n),N(),a()("html, body").animate({scrollTop:a()(n).offset().top-150},300),a()("#newCompetitor").val(""),O(),P())}function N(){for(var e=document.getElementById("results").getElementsByTagName("li"),t=1,n=1,o=e.length;n<o;n++){var a=e[n].getElementsByClassName("race-place")[0];e[n].setAttribute("data-place",n.toString());var r=e[n].getAttribute("data-originalScore");"competitorTemplate"!==a.id&&(z(e[n])&&"0"!==r?(a.textContent=t.toString(),e[n].setAttribute("data-place",t.toString()),t++):(a.textContent=j(e[n]),e[n].removeAttribute("data-place")));var i=e[n].getElementsByClassName("code-points")[0];F(e[n])?i.style.display="":(i.style.display="none",i.value="")}}function B(e){for(var t=document.getElementById("results").getElementsByTagName("li"),n=0,o=t.length;n<o;n++)if(t[n].getAttribute("data-competitorId")===e.id.toString())return!0;return!1}var E,I,D;function x(e,t){a.a&&e&&t&&t.length>31&&a.a.getJSON("/api/Competitors",{clubId:e,fleetId:t},(function(e){E=e,O(),function(){a()("#scoreButtonDiv").empty(),E&&E.length&&E.length<21?a()("#scoreButtonFooter").show():a()("#scoreButtonFooter").hide();E.forEach(e=>{let t="btn ";B(e)?t+="btn-primary add-comp-disabled":t+="btn-outline-primary add-comp-enabled",a()("#scoreButtonDiv").append('<button class="'+t+'" data-competitorid="'+e.id+'" > '+(e.sailNumber||e.alternativeSailNumber||e.name)+" </button>")})}()}))}var R,T,k,A,L,M=!1;function O(){I=function(){const e=[];return E.forEach(t=>{if(!B(t)){let n={value:t.name,data:t};t.alternativeSailNumber?n.value=t.sailNumber+" ( "+t.alternativeSailNumber+" ) - "+t.name:t.sailNumber&&(n.value=t.sailNumber+" - "+t.name),e.push(n)}}),e}(),M&&a()("#newCompetitor").autocomplete().dispose(),a()("#newCompetitor").autocomplete({lookup:I,onSelect:function(e){w(e.data)},autoSelectFirst:!0,triggerSelectOnValidInput:!1,noCache:!0}),M=!0}function P(){a()("#scoreButtonDiv").empty(),E.forEach(e=>{let t="btn ";B(e)?t+="btn-primary add-comp-disabled":t+="btn-outline-primary add-comp-enabled",a()("#scoreButtonDiv").append('<button class="'+t+'" data-competitorid="'+e.id+'" > '+(e.sailNumber||e.alternativeSailNumber||e.name)+" </button>")})}function j(e){const t=e.getElementsByClassName("select-code")[0].value;return"No Code"===t?null:t}function _(e){const t=e.getElementsByClassName("code-points")[0].value;return"No Code"===t?null:t}function z(e){const t=e.getElementsByClassName("select-code")[0].value;return"No Code"===t||!!scoreCodes.filter(e=>e.name===t)[0].preserveResult}function F(e){const t=e.getElementsByClassName("select-code")[0].value;return"No Code"!==t&&"MAN"===scoreCodes.filter(e=>e.name===t)[0].formula}function G(){a()("#weatherIcon").val("Select..."),a()("#weatherIcon").selectpicker("refresh"),a()("#weatherDescription").val(null),a()("#windSpeed").val(null),a()("#windGust").val(null),a()("#windDirection").val(null),a()("#temperature").val(null),a()("#humidity").val(null),a()("#cloudcover").val(null)}function H(e){a.a.ajax({type:"GET",url:window.speechInfoUrl,dataType:"json",beforeSend:function(e){e.setRequestHeader("Accept","application/json")},success:function(t){$=0,k=t.token,T=t.region,R=t.userLanguage,A=Date.now(),e&&e()},error:function(e,t,n){++$<3&&a.a.ajax(this)}})}var W,q,J,U,V,$=0;function K(e,t){!function(e){switch(console.debug("(recognized)  Reason: "+W.ResultReason[e.reason]),e.reason){case W.ResultReason.NoMatch:var t=W.NoMatchDetails.fromResult(e);console.debug(` NoMatchReason: ${W.NoMatchReason[t.reason]}\r\n`),ee();break;case W.ResultReason.Canceled:var n=W.CancellationDetails.fromResult(e);console.debug(" CancellationReason: "+W.CancellationReason[n.reason]),console.debug(n.reason===W.CancellationReason.Error?": "+n.errorDetails:""),ee();break;case W.ResultReason.RecognizedSpeech:e.text&&(q.innerHTML=e.text),e.text&&function e(t){let n;var o,a;console.debug(t),n=E.find(e=>e.sailNumber&&t.startsWith(Q(e.sailNumber)+" ")),n&&(o=Q(n.sailNumber));n||(n=E.find(e=>e.alternativeSailNumber&&t.startsWith(Q(e.alternativeSailNumber)+" ")),n&&(o=Q(n.alternativeSailNumber)));n||(n=E.find(e=>e.name&&t.startsWith(Q(e.name)+" ")),n&&(o=Q(n.name)));n?(w(n),L=Date.now(),a=t.substr(o.length+1).trimLeft()):!a&&t.indexOf(" ")>-1&&(a=t.substr(t.indexOf(" ")+1).trimLeft());a.length>0&&e(a);ee()}(Q(e.text)+" ")}}(t.result)}function Q(e){return e?e.replace(/[.?,\/#!$%\^&\*;:{}=\-_`~()]/g,"").toUpperCase():null}function X(e,t){console.debug("(sessionStarted)"),J.style.display="none",U.style.display="block",q.innerHTML="Listening"}function Y(e,t){console.debug("(sessionStopped)"),q.innerHTML="",J.style.display="block",U.style.display="none"}function Z(e,t){window.console.log(t),console.debug("(cancel) Reason: "+W.CancellationReason[t.reason]),t.reason===W.CancellationReason.Error&&console.debug(": "+t.errorDetails),ee()}function ee(){L<Date.now()-3e4&&ne()}function te(){if(q.innerHTML="",L=Date.now(),A<Date.now()-3e5)H(te);else{var e=W.AudioConfig.fromDefaultMicrophoneInput(),t=function(e){var t;return k&&(t=e.fromAuthorizationToken(k,T)),t.setProperty(W.SpeechServiceConnection_EndSilenceTimeoutMs,1e3),t.speechRecognitionLanguage=R,t}(W.SpeechConfig);t&&(function(e){if(e.recognized=K,e.canceled=Z,V.sessionStarted=X,V.sessionStopped=Y,I)for(var t=W.PhraseListGrammar.fromRecognizer(V),n=0;n<E.length;n++)E[n].sailNumber&&t.addPhrase(E[n].sailNumber),E[n].alternativeSailNumber&&t.addPhrase(E[n].alternativeSailNumber),E[n].name&&t.addPhrase(E[n].name)}(V=new W.SpeechRecognizer(t,e)),V.startContinuousRecognitionAsync())}}function ne(){V.stopContinuousRecognitionAsync((function(){V.close(),V=void 0}),(function(e){V.close(),V=void 0}))}document.addEventListener("DOMContentLoaded",(function(){var e;J=document.getElementById("scenarioStartButton"),U=document.getElementById("scenarioStopButton"),q=document.getElementById("phraseDiv"),U&&U.addEventListener("click",ne),J&&(J.addEventListener("click",te),e=function(e){W=e},window.SpeechSDK&&(document.getElementById("speechwarning").style.display="none",e(window.SpeechSDK)))})),i()}]);
//# sourceMappingURL=raceEditor.js.map