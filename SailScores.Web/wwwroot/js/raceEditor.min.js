(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=jQuery;var n=e.n(t);bootstrap;const a="No Code";function o(e){const t=e||event;return/textarea/i.test(t.srcElement.tagName)||13!==(e.keyCode||e.which||e.charCode||0)}function i(){var e,t;e=n()("#clubId").val(),t=n()("#date").val(),e&&t&&n().getJSON("/api/Series",{clubId:e,date:t},(function(e){N=e,function(){let e=n()("#SeriesIds"),t=e.val()||[];e.hasClass("select2-hidden-accessible")&&e.select2("destroy"),e.empty(),n().each(N,(function(t,a){let o=a;e.append(n()("<option></option>").attr("value",o.id.toString()).text(o.name))})),e.select2({width:"100%",placeholder:"Select Series",allowClear:!0}),e.val(t).trigger("change")}()}))}function l(){let e=n()("#clubId").val(),t=n()("#fleetId").val(),a=document.getElementById("fleetId"),o=a.options[a.selectedIndex].getAttribute("data-boat-class-id");o&&n()("#createCompBoatClassSelect").val(o),t.length<30?n()("#createCompButton").prop("disabled",!0):n()("#createCompButton").prop("disabled",!1),n()("#createCompFleetId").val(t),I(e,t),T()}function r(){i(),"true"===n()("#defaultWeather").val()&&(console.log("defaultWeather was true"),$()),T()}function s(){n()("#defaultWeather").val("false")}function c(){let e=n()("#raceState").val();var t;"2"===e&&$(),"1"===e&&"4"!==n()("#raceState").data("previous")&&(t=n()("#clubInitials").val(),n().getJSON("/"+t+"/weather/current/",{},(function(e){e.icon&&n()("#weatherIcon").val(null)&&n()("#weatherIcon").val(e.icon),e.description&&n()("#weatherDescription").val(null)&&n()("#weatherDescription").val(e.description),e.windSpeed&&n()("#windSpeed").val(null)&&n()("#windSpeed").val(e.windSpeed),e.windGust&&n()("#windGust").val(null)&&n()("#windGust").val(e.windGust),e.windDirection&&n()("#windDirection").val(null)&&n()("#windDirection").val(e.windDirection),e.temperature&&n()("#temperature").val(null)&&n()("#temperature").val(e.temperature),e.humidity&&n()("#humidity").val(null)&&n()("#humidity").val(e.humidity),e.cloudCoverPercent&&n()("#cloudCover").val(null)&&n()("#cloudCover").val(e.cloudCoverPercent)}))),n()("#raceState").data("previous",e)}function u(e){e.preventDefault(),n()("#compLoading").show();var t=n()(this),a=t.attr("data-submit-url");return n().ajax({type:"POST",url:a,beforeSend:function(e){n()("#compLoading").show(),e.setRequestHeader("RequestVerificationToken",n()('input:hidden[name="__RequestVerificationToken"]').val())},data:t.serialize(),success:d,error:m}),n()("#compLoading").hide(),!1}function d(){I(n()("#clubId").val(),n()("#fleetId").val()),n()("#createCompetitor").modal("hide")}function m(){n()("#compCreateAlert").show()}function p(){var e=event.target,t=n()(e).closest("li");t.prev().insertAfter(t),S()}function f(){var e=event.target,t=n()(e).closest("li");t.next().insertBefore(t),S()}function v(){document.activeElement.blur();var e=n()("#deleteConfirm"),t=e.find("#compIdToDelete").val();n()("#results").find(`[data-competitorid='${t}']`).remove(),S(),M(),A(),e.modal("hide")}function g(){var e=event.target,t=n()(e).closest("li"),a=t.data("competitorid"),o=t.find(".competitor-name").text();o||(o=t.find(".sail-number").text());var i=n()("#deleteConfirm");i.find("#competitorNameToDelete").text(o),i.find("#compIdToDelete").val(a),i.show()}function h(){n()("#scoreButtonFooter").hide()}function b(){if(event.target instanceof HTMLButtonElement){var e=event.target.dataset.competitorid;y(w.find((t=>t.id.toString()===e)))}}function y(e){var t=document.getElementById("results"),a=document.getElementById("competitorTemplate").cloneNode(!0);a.id=e.id.toString(),a.setAttribute("data-competitorId",e.id.toString());var o=a.getElementsByClassName("competitor-name")[0];o.appendChild(document.createTextNode(e.name||"")),(o=a.getElementsByClassName("sail-number")[0]).appendChild(document.createTextNode(e.sailNumber||"")),e.alternativeSailNumber&&((o=a.getElementsByClassName("alt-sail-number")[0]).appendChild(document.createTextNode(" ("+e.alternativeSailNumber+")")),o.style.display=""),(o=a.getElementsByClassName("race-place")[0]).appendChild(document.createTextNode((0).toString()));for(var i=a.getElementsByClassName("delete-button"),l=0;l<i.length;l++)i[l].setAttribute("data-competitorId",e.id.toString());var r=document.getElementById("trackTimesCheckbox")?.checked,s=a.getElementsByClassName("finish-time-div")[0],c=a.getElementsByClassName("finish-time-input")[0];s.style.display=r?"":"none";var u=a.getElementsByClassName("elapsed-time-div")[0],d=a.getElementsByClassName("elapsed-time-input")[0];u.style.display=r?"":"none";const m=n()("#date").val(),p=new Date;if(m===p.toISOString().substring(0,10)){c.value=p.toTimeString().slice(0,8);const e=document.getElementById("StartTime");if(e&&e.value){const t=H(e.value);if(t){const e=new Date(p);t>e&&t.setDate(t.getDate()-1);let n=e.getTime()-t.getTime();n<0&&(n+=864e5),d.value=W(n)}}}c&&n()(c).change(re),d&&n()(d).change(se),a.style.display="",C(e)||(t.appendChild(a),S(),n()("html, body").animate({scrollTop:n()(a).offset().top-150},300),n()("#newCompetitor").val(""),M(),A())}function S(){for(var e=document.getElementById("results").getElementsByTagName("li"),t=1,n=1,a=e.length;n<a;n++){var o=e[n].getElementsByClassName("race-place")[0];e[n].setAttribute("data-place",n.toString());var i=e[n].getAttribute("data-originalScore");"competitorTemplate"!==o.id&&(F(e[n])&&"0"!==i?(o.textContent=t.toString(),e[n].setAttribute("data-place",t.toString()),t++):(o.textContent=O(e[n]),e[n].removeAttribute("data-place")));var l=e[n].getElementsByClassName("code-points")[0];q(e[n])?l.style.display="":(l.style.display="none",l.value="")}}function C(e){for(var t=document.getElementById("results").getElementsByTagName("li"),n=0,a=t.length;n<a;n++)if(t[n].getAttribute("data-competitorId")===e.id.toString())return!0;return!1}var w,E,N;function I(e,t){n()&&e&&t&&t.length>31&&n().getJSON("/api/Competitors",{clubId:e,fleetId:t},(function(e){w=e,M(),n()("#scoreButtonDiv").empty(),n()("#scoreButtonFooter").show(),w.forEach((e=>{let t="btn quick-comp ";C(e)?t+="btn-primary add-comp-disabled":t+="btn-outline-primary add-comp-enabled",n()("#scoreButtonDiv").append('<button class="'+t+'" data-competitorid="'+e.id+'" > '+(e.sailNumber||e.alternativeSailNumber||e.name)+" </button>")}))}))}function T(){let e=document.getElementById("raceNumber");if(null==e)return;let t=n()("#clubId").val(),a=n()("#fleetId").val(),o=n()("#regattaId").val(),i=n()("#date").val();n()&&t&&a&&i&&a.length>=32&&n().getJSON("/api/Races/RaceNumber",{clubId:t,fleetId:a,raceDate:i,regattaId:o},(function(t){t&&t.order?e.textContent=t.order.toString():e.textContent=""}))}var D,B,R,k,x,L=!1;function M(){E=function(){const e=[];return w.forEach((t=>{if(!C(t)){let n={value:t.name,data:t};t.alternativeSailNumber?n.value=t.sailNumber+" ( "+t.alternativeSailNumber+" ) - "+t.name:t.sailNumber&&(n.value=t.sailNumber+" - "+t.name),e.push(n)}})),e}(),L&&n()("#newCompetitor").autocomplete().dispose(),n()("#newCompetitor").autocomplete({lookup:E,onSelect:function(e){y(e.data)},autoSelectFirst:!0,triggerSelectOnValidInput:!1,noCache:!0}),L=!0}function A(){n()("#scoreButtonDiv").empty(),w.forEach((e=>{let t="btn quick-comp ";C(e)?t+="btn-primary add-comp-disabled":t+="btn-outline-primary add-comp-enabled",n()("#scoreButtonDiv").append('<button class="'+t+'" data-competitorid="'+e.id+'" > '+(e.sailNumber||e.alternativeSailNumber||e.name)+" </button>")}))}function O(e){const t=e.getElementsByClassName("select-code")[0].value;return t===a?null:t}function P(e){const t=e.getElementsByClassName("code-points")[0].value;return t===a?null:t}function F(e){const t=e.getElementsByClassName("select-code")[0].value;return t===a||!!scoreCodes.filter((e=>e.name===t))[0].preserveResult}function q(e){const t=e.getElementsByClassName("select-code")[0].value;return t!==a&&"MAN"===scoreCodes.filter((e=>e.name===t))[0].formula}function $(){n()("#weatherIcon").val("Select..."),n()("#weatherDescription").val(null),n()("#windSpeed").val(null),n()("#windGust").val(null),n()("#windDirection").val(null),n()("#temperature").val(null),n()("#humidity").val(null),n()("#cloudcover").val(null)}function j(e){n().ajax({type:"GET",url:window.speechInfoUrl,dataType:"json",beforeSend:function(e){e.setRequestHeader("Accept","application/json")},success:function(t){X=0,R=t.token,B=t.region,D=t.userLanguage,k=Date.now(),e&&e()},error:function(e,t,a){++X<3&&n().ajax(this)}})}function z(){const e=document.getElementById("trackTimesCheckbox");if(!e||!e.checked)return;const t=document.getElementById("StartTime");if(!t||!t.value)return;const a=H(t.value);a&&n()("#results li").each((function(){const e=n()(this).find('input[name="FinishTime"]')[0],t=n()(this).find('input[name="ElapsedTime"]')[0];if(e||t)if(t&&t.value){const n=G(t.value);if(null!==n){let t=new Date(a.getTime()+n);t<a&&(t=new Date(t.getTime()+864e5)),e.value=_(t)}}else if(e&&e.value){let n=H(e.value,a);if(n){n<a&&(n=new Date(n.getTime()+864e5));const o=n.getTime()-a.getTime();t.value=W(o),e.value=_(n)}}}))}function H(e,t){if(!e)return null;const n=e.split(":");if(n.length<2)return null;const a=t?new Date(t):new Date;return a.setSeconds(0,0),a.setHours(parseInt(n[0],10)),a.setMinutes(parseInt(n[1],10)),n.length>2&&a.setSeconds(parseInt(n[2],10)),a}function W(e){const t=Math.floor(e/1e3),n=Math.floor(t/3600),a=Math.floor(t%3600/60),o=t%60;return`${n.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}function G(e){if(!e)return null;const t=e.split(":").map(Number);if(t.some(isNaN))return null;let n=0;if(3===t.length)n=3600*t[0]+60*t[1]+t[2];else if(2===t.length)n=60*t[0]+t[1];else{if(1!==t.length)return null;n=t[0]}return 1e3*n}function _(e){return e.toTimeString().slice(0,8)}!function(){if(document.querySelector("form").onkeypress=o,n()("#fleetId").change(l),""==n()("#defaultRaceDateOffset").val())n()("#date").val("");else if("True"===n()("#needsLocalDate").val()){var e=new Date;const d=new Date(n()("#date").val()),m=new Date(e);m.setDate(e.getDate()+1);const y=new Date(e);if(y.setDate(e.getDate()-1),d>y&&d<m){const C=parseInt(n()("#defaultRaceDateOffset").val(),10);e.setDate(e.getDate()+C),e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),n()("#date").val(e.toISOString().substring(0,10))}n()("#needsLocalDate").val("")}n()("#date").change(r),n()('#results input[name="FinishTime"]').change(re),n()('#results input[name="ElapsedTime"]').change(se),n()("#raceState").data("previous",n()("#raceState").val()),n()("#raceState").change(c),n()(".weather-input").change(s),n()("#results").on("click",".select-code",S),n()("#results").on("click",".move-up",p),n()("#results").on("click",".move-down",f),n()("#results").on("click",".delete-button",g),n()("#scoreButtonDiv").on("click",".add-comp-enabled",b),n()("#deleteConfirmed").click(v),n()("#closefooter").click(h),n()("#compform").submit(u),n()("#raceform").submit((function(e){var t=n()("#ssWaitingModal");t&&t.show(),n()("#submitButton").attr("value","Please wait...");var a=document.getElementById("raceform");n()("#submitButton").attr("disabled","disabled"),function(e){!function(e){n()(e).find("[name^=Scores]").remove()}(e);for(var t=document.getElementById("results").getElementsByTagName("li"),a=1;a<t.length;a++){const n=(a-1).toString();var o=document.createElement("input");o.type="hidden",o.name="Scores["+n+"].competitorId",o.value=t[a].getAttribute("data-competitorId"),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+n+"].place",F(t[a])&&(o.value=t[a].getAttribute("data-place")),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+n+"].code",o.value=O(t[a]),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+n+"].codePointsString",o.value=P(t[a]),e.appendChild(o);var i=t[a].querySelector('input[name="FinishTime"]');i&&i.value&&((o=document.createElement("input")).type="hidden",o.name="Scores["+n+"].FinishTime",o.value=i.value,e.appendChild(o));var l=t[a].querySelector('input[name="ElapsedTime"]');l&&l.value&&((o=document.createElement("input")).type="hidden",o.name="Scores["+n+"].ElapsedTime",o.value=l.value,e.appendChild(o))}}(a)})),n()("#submitButton").prop("disabled",!1),n()("#submitDisabledMessage").prop("hidden",!0),j(null),window.onload=function(){l(),i(),S()};const t=document.getElementById("trackTimesCheckbox");if(t){function w(){!function(e){const t=e?"":"none";n()("#results li").each((function(){n()(this).find('input[name="FinishTime"]').closest("div").css("display",t),n()(this).find('input[name="ElapsedTime"]').closest("div").css("display",t)}))}(t.checked),z()}t.addEventListener("change",w),w()}const a=document.getElementById("StartTime");a&&a.addEventListener("change",(function(){z()}))}();var J,V,K,U,Q,X=0;function Y(e,t){!function(e){switch(console.debug(`(recognized)  Reason: ${J.ResultReason[e.reason]}`),e.reason){case J.ResultReason.NoMatch:var t=J.NoMatchDetails.fromResult(e);console.debug(` NoMatchReason: ${J.NoMatchReason[t.reason]}\r\n`),oe();break;case J.ResultReason.Canceled:var n=J.CancellationDetails.fromResult(e);console.debug(` CancellationReason: ${J.CancellationReason[n.reason]}`),console.debug(n.reason===J.CancellationReason.Error?`: ${n.errorDetails}`:""),oe();break;case J.ResultReason.RecognizedSpeech:e.text&&(V.innerHTML=e.text),e.text&&Z(ee(e.text)+" ")}}(t.result)}function Z(e){let t;var a,o;if(console.debug(e),t=w.find((t=>t.sailNumber&&e.startsWith(ee(t.sailNumber)+" "))),t&&(a=ee(t.sailNumber)),t||(t=w.find((t=>t.alternativeSailNumber&&e.startsWith(ee(t.alternativeSailNumber)+" "))),t&&(a=ee(t.alternativeSailNumber))),t||(t=w.find((t=>t.name&&e.startsWith(ee(t.name)+" "))),t&&(a=ee(t.name))),t)y(t),x=Date.now(),o=e.substr(a.length).trimLeft();else{var i=scoreCodes.find((t=>e.startsWith(ee(t.name)+" ")));!function(e){n()(".select-code").last().val(e)}(i.name),a=ee(i.name),o=e.substr(a.length).trimLeft()}t||i||!o&&e.indexOf(" ")>-1&&(o=e.substr(e.indexOf(" ")+1).trimLeft()),o.length>0&&Z(o),oe()}function ee(e){return e?e.replace(/[.?,\/#!$%\^&\*;:{}=\-_`~()]/g,"").toUpperCase():null}function te(e,t){console.debug("(sessionStarted)"),K.style.display="none",U.style.display="block",V.innerHTML="Listening"}function ne(e,t){console.debug("(sessionStopped)"),V.innerHTML="",K.style.display="block",U.style.display="none"}function ae(e,t){window.console.log(t),console.debug("(cancel) Reason: "+J.CancellationReason[t.reason]),t.reason===J.CancellationReason.Error&&console.debug(": "+t.errorDetails),oe()}function oe(){x<Date.now()-3e4&&le()}function ie(){if(V.innerHTML="",x=Date.now(),k<Date.now()-3e5)j(ie);else{var e=J.AudioConfig.fromDefaultMicrophoneInput(),t=function(e){var t;return R&&(t=e.fromAuthorizationToken(R,B)),t.setProperty(J.SpeechServiceConnection_EndSilenceTimeoutMs,1e3),t.speechRecognitionLanguage=D,t}(J.SpeechConfig);t&&(function(e){if(e.recognized=Y,e.canceled=ae,Q.sessionStarted=te,Q.sessionStopped=ne,E){for(var t=J.PhraseListGrammar.fromRecognizer(Q),n=0;n<w.length;n++)w[n].sailNumber&&t.addPhrase(w[n].sailNumber),w[n].alternativeSailNumber&&t.addPhrase(w[n].alternativeSailNumber),w[n].name&&t.addPhrase(w[n].name);for(n=0;n<scoreCodes.length;n++)t.addPhrase(scoreCodes[n].name)}}(Q=new J.SpeechRecognizer(t,e)),Q.startContinuousRecognitionAsync())}}function le(){Q.stopContinuousRecognitionAsync((function(){Q.close(),Q=void 0}),(function(e){Q.close(),Q=void 0}))}function re(){const e=this,t=n()(e).closest("li").find('input[name="ElapsedTime"]')[0],a=document.getElementById("StartTime");if(!a||!a.value||!e.value)return;const o=H(a.value),i=H(e.value,o);if(!o||!i)return;let l=i.getTime()-o.getTime();l<0&&(l+=864e5),t.value=W(l)}function se(){const e=this,t=n()(e).closest("li").find('input[name="FinishTime"]')[0],a=document.getElementById("StartTime");if(!a||!a.value||!e.value)return;const o=H(a.value),i=G(e.value);if(!o||null===i)return;const l=new Date(o.getTime()+i);t.value=_(l)}document.addEventListener("DOMContentLoaded",(function(){var e;K=document.getElementById("scenarioStartButton"),U=document.getElementById("scenarioStopButton"),V=document.getElementById("phraseDiv"),U&&U.addEventListener("click",le),K&&(K.addEventListener("click",ie),e=function(e){J=e},window.SpeechSDK&&(document.getElementById("speechwarning").style.display="none",e(window.SpeechSDK)))}))})();
//# sourceMappingURL=raceEditor.min.js.map