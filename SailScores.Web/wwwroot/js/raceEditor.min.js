!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t){e.exports=jQuery},,,,,,,function(e,t,n){e.exports=n(8)},function(e,t,n){"use strict";n.r(t),n.d(t,"initialize",(function(){return i})),n.d(t,"loadSeriesOptions",(function(){return l})),n.d(t,"loadFleet",(function(){return c})),n.d(t,"dateChanged",(function(){return u})),n.d(t,"weatherChanged",(function(){return d})),n.d(t,"raceStateChanged",(function(){return s})),n.d(t,"compCreateSubmit",(function(){return m})),n.d(t,"completeCompCreate",(function(){return p})),n.d(t,"completeCompCreateFailed",(function(){return f})),n.d(t,"hideAlert",(function(){return v})),n.d(t,"moveUp",(function(){return g})),n.d(t,"moveDown",(function(){return h})),n.d(t,"deleteResult",(function(){return b})),n.d(t,"confirmDelete",(function(){return y})),n.d(t,"hideScoreButtonFooter",(function(){return C})),n.d(t,"addNewCompetitorFromButton",(function(){return S})),n.d(t,"calculatePlaces",(function(){return N}));var o=n(0),r=n.n(o);n(9),n(10);function a(e){const t=e||event;return/textarea/i.test(t.srcElement.tagName)||13!==(e.keyCode||e.which||e.charCode||0)}function i(){if(document.querySelector("form").onkeypress=a,r()("#fleetId").change(c),"true"===r()("#needsLocalDate").val()){var e=new Date;e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),r()("#date").val(e.toISOString().substring(0,10)),r()("#needsLocalDate").val("false")}r()("#date").change(u),r()("#raceState").change(s),r()(".weather-input").change(d),r()("#results").on("click",".select-code",N),r()("#results").on("click",".move-up",g),r()("#results").on("click",".move-down",h),r()("#results").on("click",".delete-button",y),r()("#scoreButtonDiv").on("click",".add-comp-enabled",S),r()("#deleteConfirmed").click(b),r()("#closefooter").click(C),r()("#compform").submit(m),r()("#raceform").submit((function(e){!function(e){!function(e){r()(e).find("[name^=Scores]").remove()}(e);for(var t=document.getElementById("results").getElementsByTagName("li"),n=1;n<t.length;n++){const r=(n-1).toString();var o=document.createElement("input");o.type="hidden",o.name="Scores["+r+"].competitorId",o.value=t[n].getAttribute("data-competitorId"),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+r+"].place",j(t[n])&&(o.value=t[n].getAttribute("data-place")),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+r+"].code",o.value=O(t[n]),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+r+"].codePointsString",o.value=P(t[n]),e.appendChild(o)}}(document.getElementById("raceform"))})),c(),l(),N(),r()("#submitButton").prop("disabled",!1),r()("#submitDisabledMessage").prop("hidden",!0)}function l(){!function(e,t){e&&t&&r.a.getJSON("/api/Series",{clubId:e,date:t},(function(e){x=e,function(){let e=r()("#seriesIds");var t=e.val();e.empty(),r.a.each(x,(function(t,n){let o=n;e.append(r()("<option></option>").attr("value",o.id.toString()).text(o.name))})),e.selectpicker("destroy"),e.selectpicker(),e.val(t),e.selectpicker("refresh")}()}))}(r()("#clubId").val(),r()("#date").val())}function c(){let e=r()("#clubId").val(),t=r()("#fleetId").val(),n=document.getElementById("fleetId"),o=n.options[n.selectedIndex].getAttribute("data-boat-class-id");o&&r()("#createCompBoatClassSelect").val(o),t.length<30?r()("#createCompButton").prop("disabled",!0):r()("#createCompButton").prop("disabled",!1),r()("#createCompFleetId").val(t),D(e,t)}function u(){console.log("dateChanged"),l(),"true"===r()("#defaultWeather").val()&&(console.log("defaultWeather was true"),M())}function d(){r()("#defaultWeather").val("false")}function s(){let e=r()("#raceState").val();var t;"2"===e&&M(),"1"===e&&(t=r()("#clubInitials").val(),r.a.getJSON("/"+t+"/weather/current/",{},(function(e){e.icon&&r()("#weatherIcon").val(null)&&(r()("#weatherIcon").val(e.icon),r()("#weatherIcon").selectpicker("refresh")),e.description&&r()("#weatherDescription").val(null)&&r()("#weatherDescription").val(e.description),e.windSpeed&&r()("#windSpeed").val(null)&&r()("#windSpeed").val(e.windSpeed),e.windGust&&r()("#windGust").val(null)&&r()("#windGust").val(e.windGust),e.windDirection&&r()("#windDirection").val(null)&&r()("#windDirection").val(e.windDirection),e.temperature&&r()("#temperature").val(null)&&r()("#temperature").val(e.temperature),e.humidity&&r()("#humidity").val(null)&&r()("#humidity").val(e.humidity),e.cloudCoverPercent&&r()("#cloudCover").val(null)&&r()("#cloudCover").val(e.cloudCoverPercent)})))}function m(e){e.preventDefault(),r()("#compLoading").show();var t=r()(this),n=t.attr("data-submit-url");return r.a.ajax({type:"POST",url:n,beforeSend:function(e){r()("#compLoading").show(),e.setRequestHeader("RequestVerificationToken",r()('input:hidden[name="__RequestVerificationToken"]').val())},data:t.serialize(),success:p,error:f}),r()("#compLoading").hide(),!1}function p(){D(r()("#clubId").val(),r()("#fleetId").val()),r()("#createCompetitor").modal("hide")}function f(){r()("#compCreateAlert").show()}function v(){r()("#compCreateAlert").hide()}function g(){var e=event.target,t=r()(e).closest("li");t.prev().insertAfter(t),N()}function h(){var e=event.target,t=r()(e).closest("li");t.next().insertBefore(t),N()}function b(){var e=r()("#deleteConfirm"),t=e.find("#compIdToDelete").val();r()("#results").find(`[data-competitorid='${t}']`).remove(),N(),A(),e.modal("hide")}function y(){var e=event.target,t=r()(e).closest("li"),n=t.data("competitorid"),o=t.find(".competitor-name").text();o||(o=t.find(".sail-number").text());var a=r()("#deleteConfirm");a.find("#competitorNameToDelete").text(o),a.find("#compIdToDelete").val(n),a.show()}function C(){r()("#scoreButtonFooter").hide()}function S(){if(!(event.target instanceof HTMLButtonElement))return;var e=event.target.dataset.competitorid;w(I.find(t=>t.id.toString()===e))}function w(e){var t=document.getElementById("results"),n=document.getElementById("competitorTemplate").cloneNode(!0);n.id=e.id.toString(),n.setAttribute("data-competitorId",e.id.toString());var o=n.getElementsByClassName("competitor-name")[0];o.appendChild(document.createTextNode(e.name||"")),(o=n.getElementsByClassName("sail-number")[0]).appendChild(document.createTextNode(e.sailNumber||"")),e.alternativeSailNumber&&((o=n.getElementsByClassName("alt-sail-number")[0]).appendChild(document.createTextNode(" ("+e.alternativeSailNumber+")")),o.style.display=""),(o=n.getElementsByClassName("race-place")[0]).appendChild(document.createTextNode((0).toString()));for(var a=n.getElementsByClassName("delete-button"),i=0;i<a.length;i++)a[i].setAttribute("data-competitorId",e.id.toString());n.style.display="",t.appendChild(n),N(),r()("html, body").animate({scrollTop:r()(n).offset().top-150},300),r()("#newCompetitor").val(""),k(),A()}function N(){for(var e=document.getElementById("results").getElementsByTagName("li"),t=1,n=1,o=e.length;n<o;n++){var r=e[n].getElementsByClassName("race-place")[0];e[n].setAttribute("data-place",n.toString());var a=e[n].getAttribute("data-originalScore");"competitorTemplate"!==r.id&&(j(e[n])&&"0"!==a?(r.textContent=t.toString(),e[n].setAttribute("data-place",t.toString()),t++):(r.textContent=O(e[n]),e[n].removeAttribute("data-place")));var i=e[n].getElementsByClassName("code-points")[0];F(e[n])?i.style.display="":(i.style.display="none",i.value="")}}function B(e){for(var t=document.getElementById("results").getElementsByTagName("li"),n=0,o=t.length;n<o;n++)if(t[n].getAttribute("data-competitorId")===e.id.toString())return!0;return!1}var I,E,x;function D(e,t){r.a&&e&&t&&t.length>31&&r.a.getJSON("/api/Competitors",{clubId:e,fleetId:t},(function(e){I=e,k(),function(){r()("#scoreButtonDiv").empty(),I&&I.length&&I.length<21?r()("#scoreButtonFooter").show():r()("#scoreButtonFooter").hide();I.forEach(e=>{let t="btn ";B(e)?t+="btn-primary add-comp-disabled":t+="btn-outline-primary add-comp-enabled",r()("#scoreButtonDiv").append('<button class="'+t+'" data-competitorid="'+e.id+'" > '+(e.sailNumber||e.alternativeSailNumber||e.name)+" </button>")})}()}))}var T=!1;function k(){E=function(){const e=[];return I.forEach(t=>{if(!B(t)){let n={value:t.name,data:t};t.alternativeSailNumber?n.value=t.sailNumber+" ( "+t.alternativeSailNumber+" ) - "+t.name:t.sailNumber&&(n.value=t.sailNumber+" - "+t.name),e.push(n)}}),e}(),T&&r()("#newCompetitor").autocomplete().dispose(),r()("#newCompetitor").autocomplete({lookup:E,onSelect:function(e){w(e.data)},autoSelectFirst:!0,triggerSelectOnValidInput:!1,noCache:!0}),T=!0}function A(){r()("#scoreButtonDiv").empty(),I.forEach(e=>{let t="btn ";B(e)?t+="btn-primary add-comp-disabled":t+="btn-outline-primary add-comp-enabled",r()("#scoreButtonDiv").append('<button class="'+t+'" data-competitorid="'+e.id+'" > '+(e.sailNumber||e.alternativeSailNumber||e.name)+" </button>")})}function O(e){const t=e.getElementsByClassName("select-code")[0].value;return"No Code"===t?null:t}function P(e){const t=e.getElementsByClassName("code-points")[0].value;return"No Code"===t?null:t}function j(e){const t=e.getElementsByClassName("select-code")[0].value;return"No Code"===t||!!scoreCodes.filter(e=>e.name===t)[0].preserveResult}function F(e){const t=e.getElementsByClassName("select-code")[0].value;return"No Code"!==t&&"MAN"===scoreCodes.filter(e=>e.name===t)[0].formula}function M(){r()("#weatherIcon").val("Select..."),r()("#weatherIcon").selectpicker("refresh"),r()("#weatherDescription").val(null),r()("#windSpeed").val(null),r()("#windGust").val(null),r()("#windDirection").val(null),r()("#temperature").val(null),r()("#humidity").val(null),r()("#cloudcover").val(null)}i()},function(e,t){e.exports=bootstrap},function(e,t){e.exports=window["bootstrap-select"]}]);
//# sourceMappingURL=raceEditor.js.map