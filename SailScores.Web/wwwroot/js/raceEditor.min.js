(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=jQuery;var n=e.n(t);bootstrap;const a="No Code";function o(e){const t=e||event;return/textarea/i.test(t.srcElement.tagName)||13!==(e.keyCode||e.which||e.charCode||0)}function i(){var e,t;e=n()("#clubId").val(),t=n()("#date").val(),e&&t&&n().getJSON("/api/Series",{clubId:e,date:t},(function(e){I=e,function(){let e=n()("#seriesIds");var t=e.val();e.empty(),n().each(I,(function(t,a){let o=a;e.append(n()("<option></option>").attr("value",o.id.toString()).text(o.name))})),e.select2(),e.val(t).trigger("change")}()}))}function r(){let e=n()("#clubId").val(),t=n()("#fleetId").val(),a=document.getElementById("fleetId"),o=a.options[a.selectedIndex].getAttribute("data-boat-class-id");o&&n()("#createCompBoatClassSelect").val(o),t.length<30?n()("#createCompButton").prop("disabled",!0):n()("#createCompButton").prop("disabled",!1),n()("#createCompFleetId").val(t),B(e,t),E()}function l(){i(),"true"===n()("#defaultWeather").val()&&(console.log("defaultWeather was true"),W()),E()}function c(){n()("#defaultWeather").val("false")}function s(){let e=n()("#raceState").val();var t;"2"===e&&W(),"1"===e&&"4"!==n()("#raceState").data("previous")&&(t=n()("#clubInitials").val(),n().getJSON("/"+t+"/weather/current/",{},(function(e){e.icon&&n()("#weatherIcon").val(null)&&n()("#weatherIcon").val(e.icon),e.description&&n()("#weatherDescription").val(null)&&n()("#weatherDescription").val(e.description),e.windSpeed&&n()("#windSpeed").val(null)&&n()("#windSpeed").val(e.windSpeed),e.windGust&&n()("#windGust").val(null)&&n()("#windGust").val(e.windGust),e.windDirection&&n()("#windDirection").val(null)&&n()("#windDirection").val(e.windDirection),e.temperature&&n()("#temperature").val(null)&&n()("#temperature").val(e.temperature),e.humidity&&n()("#humidity").val(null)&&n()("#humidity").val(e.humidity),e.cloudCoverPercent&&n()("#cloudCover").val(null)&&n()("#cloudCover").val(e.cloudCoverPercent)}))),n()("#raceState").data("previous",e)}function d(e){e.preventDefault(),n()("#compLoading").show();var t=n()(this),a=t.attr("data-submit-url");return n().ajax({type:"POST",url:a,beforeSend:function(e){n()("#compLoading").show(),e.setRequestHeader("RequestVerificationToken",n()('input:hidden[name="__RequestVerificationToken"]').val())},data:t.serialize(),success:u,error:m}),n()("#compLoading").hide(),!1}function u(){B(n()("#clubId").val(),n()("#fleetId").val()),n()("#createCompetitor").modal("hide")}function m(){n()("#compCreateAlert").show()}function p(){var e=event.target,t=n()(e).closest("li");t.prev().insertAfter(t),S()}function v(){var e=event.target,t=n()(e).closest("li");t.next().insertBefore(t),S()}function f(){document.activeElement.blur();var e=n()("#deleteConfirm"),t=e.find("#compIdToDelete").val();n()("#results").find(`[data-competitorid='${t}']`).remove(),S(),A(),M(),e.modal("hide")}function g(){var e=event.target,t=n()(e).closest("li"),a=t.data("competitorid"),o=t.find(".competitor-name").text();o||(o=t.find(".sail-number").text());var i=n()("#deleteConfirm");i.find("#competitorNameToDelete").text(o),i.find("#compIdToDelete").val(a),i.show()}function b(){n()("#scoreButtonFooter").hide()}function h(){if(event.target instanceof HTMLButtonElement){var e=event.target.dataset.competitorid;y(w.find((t=>t.id.toString()===e)))}}function y(e){var t=document.getElementById("results"),a=document.getElementById("competitorTemplate").cloneNode(!0);a.id=e.id.toString(),a.setAttribute("data-competitorId",e.id.toString());var o=a.getElementsByClassName("competitor-name")[0];o.appendChild(document.createTextNode(e.name||"")),(o=a.getElementsByClassName("sail-number")[0]).appendChild(document.createTextNode(e.sailNumber||"")),e.alternativeSailNumber&&((o=a.getElementsByClassName("alt-sail-number")[0]).appendChild(document.createTextNode(" ("+e.alternativeSailNumber+")")),o.style.display=""),(o=a.getElementsByClassName("race-place")[0]).appendChild(document.createTextNode((0).toString()));for(var i=a.getElementsByClassName("delete-button"),r=0;r<i.length;r++)i[r].setAttribute("data-competitorId",e.id.toString());a.style.display="",C(e)||(t.appendChild(a),S(),n()("html, body").animate({scrollTop:n()(a).offset().top-150},300),n()("#newCompetitor").val(""),A(),M())}function S(){for(var e=document.getElementById("results").getElementsByTagName("li"),t=1,n=1,a=e.length;n<a;n++){var o=e[n].getElementsByClassName("race-place")[0];e[n].setAttribute("data-place",n.toString());var i=e[n].getAttribute("data-originalScore");"competitorTemplate"!==o.id&&(j(e[n])&&"0"!==i?(o.textContent=t.toString(),e[n].setAttribute("data-place",t.toString()),t++):(o.textContent=O(e[n]),e[n].removeAttribute("data-place")));var r=e[n].getElementsByClassName("code-points")[0];z(e[n])?r.style.display="":(r.style.display="none",r.value="")}}function C(e){for(var t=document.getElementById("results").getElementsByTagName("li"),n=0,a=t.length;n<a;n++)if(t[n].getAttribute("data-competitorId")===e.id.toString())return!0;return!1}var w,N,I;function B(e,t){n()&&e&&t&&t.length>31&&n().getJSON("/api/Competitors",{clubId:e,fleetId:t},(function(e){w=e,A(),n()("#scoreButtonDiv").empty(),n()("#scoreButtonFooter").show(),w.forEach((e=>{let t="btn quick-comp ";C(e)?t+="btn-primary add-comp-disabled":t+="btn-outline-primary add-comp-enabled",n()("#scoreButtonDiv").append('<button class="'+t+'" data-competitorid="'+e.id+'" > '+(e.sailNumber||e.alternativeSailNumber||e.name)+" </button>")}))}))}function E(){let e=document.getElementById("raceNumber");if(null==e)return;let t=n()("#clubId").val(),a=n()("#fleetId").val(),o=n()("#regattaId").val(),i=n()("#date").val();n()&&t&&a&&i&&a.length>=32&&n().getJSON("/api/Races/RaceNumber",{clubId:t,fleetId:a,raceDate:i,regattaId:o},(function(t){t&&t.order?e.textContent=t.order.toString():e.textContent=""}))}var D,R,T,x,k,L=!1;function A(){N=function(){const e=[];return w.forEach((t=>{if(!C(t)){let n={value:t.name,data:t};t.alternativeSailNumber?n.value=t.sailNumber+" ( "+t.alternativeSailNumber+" ) - "+t.name:t.sailNumber&&(n.value=t.sailNumber+" - "+t.name),e.push(n)}})),e}(),L&&n()("#newCompetitor").autocomplete().dispose(),n()("#newCompetitor").autocomplete({lookup:N,onSelect:function(e){y(e.data)},autoSelectFirst:!0,triggerSelectOnValidInput:!1,noCache:!0}),L=!0}function M(){n()("#scoreButtonDiv").empty(),w.forEach((e=>{let t="btn quick-comp ";C(e)?t+="btn-primary add-comp-disabled":t+="btn-outline-primary add-comp-enabled",n()("#scoreButtonDiv").append('<button class="'+t+'" data-competitorid="'+e.id+'" > '+(e.sailNumber||e.alternativeSailNumber||e.name)+" </button>")}))}function O(e){const t=e.getElementsByClassName("select-code")[0].value;return t===a?null:t}function P(e){const t=e.getElementsByClassName("code-points")[0].value;return t===a?null:t}function j(e){const t=e.getElementsByClassName("select-code")[0].value;return t===a||!!scoreCodes.filter((e=>e.name===t))[0].preserveResult}function z(e){const t=e.getElementsByClassName("select-code")[0].value;return t!==a&&"MAN"===scoreCodes.filter((e=>e.name===t))[0].formula}function W(){n()("#weatherIcon").val("Select..."),n()("#weatherDescription").val(null),n()("#windSpeed").val(null),n()("#windGust").val(null),n()("#windDirection").val(null),n()("#temperature").val(null),n()("#humidity").val(null),n()("#cloudcover").val(null)}function q(e){n().ajax({type:"GET",url:window.speechInfoUrl,dataType:"json",beforeSend:function(e){e.setRequestHeader("Accept","application/json")},success:function(t){J=0,T=t.token,R=t.region,D=t.userLanguage,x=Date.now(),e&&e()},error:function(e,t,a){++J<3&&n().ajax(this)}})}var G,H,$,_,F,J=0;function V(e,t){!function(e){switch(console.debug(`(recognized)  Reason: ${G.ResultReason[e.reason]}`),e.reason){case G.ResultReason.NoMatch:var t=G.NoMatchDetails.fromResult(e);console.debug(` NoMatchReason: ${G.NoMatchReason[t.reason]}\r\n`),Z();break;case G.ResultReason.Canceled:var n=G.CancellationDetails.fromResult(e);console.debug(` CancellationReason: ${G.CancellationReason[n.reason]}`),console.debug(n.reason===G.CancellationReason.Error?`: ${n.errorDetails}`:""),Z();break;case G.ResultReason.RecognizedSpeech:e.text&&(H.innerHTML=e.text),e.text&&K(U(e.text)+" ")}}(t.result)}function K(e){let t;var a,o;if(console.debug(e),t=w.find((t=>t.sailNumber&&e.startsWith(U(t.sailNumber)+" "))),t&&(a=U(t.sailNumber)),t||(t=w.find((t=>t.alternativeSailNumber&&e.startsWith(U(t.alternativeSailNumber)+" "))),t&&(a=U(t.alternativeSailNumber))),t||(t=w.find((t=>t.name&&e.startsWith(U(t.name)+" "))),t&&(a=U(t.name))),t)y(t),k=Date.now(),o=e.substr(a.length).trimLeft();else{var i=scoreCodes.find((t=>e.startsWith(U(t.name)+" ")));!function(e){n()(".select-code").last().val(e)}(i.name),a=U(i.name),o=e.substr(a.length).trimLeft()}t||i||!o&&e.indexOf(" ")>-1&&(o=e.substr(e.indexOf(" ")+1).trimLeft()),o.length>0&&K(o),Z()}function U(e){return e?e.replace(/[.?,\/#!$%\^&\*;:{}=\-_`~()]/g,"").toUpperCase():null}function Q(e,t){console.debug("(sessionStarted)"),$.style.display="none",_.style.display="block",H.innerHTML="Listening"}function X(e,t){console.debug("(sessionStopped)"),H.innerHTML="",$.style.display="block",_.style.display="none"}function Y(e,t){window.console.log(t),console.debug("(cancel) Reason: "+G.CancellationReason[t.reason]),t.reason===G.CancellationReason.Error&&console.debug(": "+t.errorDetails),Z()}function Z(){k<Date.now()-3e4&&te()}function ee(){if(H.innerHTML="",k=Date.now(),x<Date.now()-3e5)q(ee);else{var e=G.AudioConfig.fromDefaultMicrophoneInput(),t=function(e){var t;return T&&(t=e.fromAuthorizationToken(T,R)),t.setProperty(G.SpeechServiceConnection_EndSilenceTimeoutMs,1e3),t.speechRecognitionLanguage=D,t}(G.SpeechConfig);t&&(function(e){if(e.recognized=V,e.canceled=Y,F.sessionStarted=Q,F.sessionStopped=X,N){for(var t=G.PhraseListGrammar.fromRecognizer(F),n=0;n<w.length;n++)w[n].sailNumber&&t.addPhrase(w[n].sailNumber),w[n].alternativeSailNumber&&t.addPhrase(w[n].alternativeSailNumber),w[n].name&&t.addPhrase(w[n].name);for(n=0;n<scoreCodes.length;n++)t.addPhrase(scoreCodes[n].name)}}(F=new G.SpeechRecognizer(t,e)),F.startContinuousRecognitionAsync())}}function te(){F.stopContinuousRecognitionAsync((function(){F.close(),F=void 0}),(function(e){F.close(),F=void 0}))}document.addEventListener("DOMContentLoaded",(function(){var e;$=document.getElementById("scenarioStartButton"),_=document.getElementById("scenarioStopButton"),H=document.getElementById("phraseDiv"),_&&_.addEventListener("click",te),$&&($.addEventListener("click",ee),e=function(e){G=e},window.SpeechSDK&&(document.getElementById("speechwarning").style.display="none",e(window.SpeechSDK)))})),function(){if(document.querySelector("form").onkeypress=o,n()("#fleetId").change(r),"True"===n()("#needsLocalDate").val()){var e=new Date;e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),n()("#date").val(e.toISOString().substring(0,10)),n()("#needsLocalDate").val("")}n()("#date").change(l),n()("#raceState").data("previous",n()("#raceState").val()),n()("#raceState").change(s),n()(".weather-input").change(c),n()("#results").on("click",".select-code",S),n()("#results").on("click",".move-up",p),n()("#results").on("click",".move-down",v),n()("#results").on("click",".delete-button",g),n()("#scoreButtonDiv").on("click",".add-comp-enabled",h),n()("#deleteConfirmed").click(f),n()("#closefooter").click(b),n()("#compform").submit(d),n()("#raceform").submit((function(e){var t=n()("#ssWaitingModal");t&&t.show(),n()("#submitButton").attr("value","Please wait...");var a=document.getElementById("raceform");n()("#submitButton").attr("disabled","disabled"),function(e){!function(e){n()(e).find("[name^=Scores]").remove()}(e);for(var t=document.getElementById("results").getElementsByTagName("li"),a=1;a<t.length;a++){const n=(a-1).toString();var o=document.createElement("input");o.type="hidden",o.name="Scores["+n+"].competitorId",o.value=t[a].getAttribute("data-competitorId"),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+n+"].place",j(t[a])&&(o.value=t[a].getAttribute("data-place")),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+n+"].code",o.value=O(t[a]),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+n+"].codePointsString",o.value=P(t[a]),e.appendChild(o)}}(a)})),n()("#submitButton").prop("disabled",!1),n()("#submitDisabledMessage").prop("hidden",!0),q(null),window.onload=function(){r(),i(),S()}}()})();
//# sourceMappingURL=raceEditor.js.map