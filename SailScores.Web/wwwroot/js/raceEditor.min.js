(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=jQuery;var n=e.n(t);bootstrap;const a="No Code";function i(e){const t=e||event;return/textarea/i.test(t.srcElement.tagName)||13!==(e.keyCode||e.which||e.charCode||0)}function o(){var e,t;e=n()("#clubId").val(),t=n()("#date").val(),e&&t&&n().getJSON("/api/Series",{clubId:e,date:t},(function(e){N=e,function(){let e=n()("#SeriesIds"),t=e.val()||[];e.hasClass("select2-hidden-accessible")&&e.select2("destroy"),e.empty(),n().each(N,(function(t,a){let i=a;e.append(n()("<option></option>").attr("value",i.id.toString()).text(i.name))})),e.select2({width:"100%",placeholder:"Select Series",allowClear:!0}),e.val(t).trigger("change")}()}))}function l(){let e=n()("#clubId").val(),t=n()("#fleetId").val(),a=document.getElementById("fleetId"),i=a.options[a.selectedIndex].getAttribute("data-boat-class-id");i&&n()("#createCompBoatClassSelect").val(i),t.length<30?n()("#createCompButton").prop("disabled",!0):n()("#createCompButton").prop("disabled",!1),n()("#createCompFleetId").val(t),T(e,t),I()}function r(){o(),"true"===n()("#defaultWeather").val()&&(console.log("defaultWeather was true"),$()),I()}function s(){n()("#defaultWeather").val("false")}function c(){let e=n()("#raceState").val();var t;"2"===e&&$(),"1"===e&&"4"!==n()("#raceState").data("previous")&&(t=n()("#clubInitials").val(),n().getJSON("/"+t+"/weather/current/",{},(function(e){e.icon&&n()("#weatherIcon").val(null)&&n()("#weatherIcon").val(e.icon),e.description&&n()("#weatherDescription").val(null)&&n()("#weatherDescription").val(e.description),e.windSpeed&&n()("#windSpeed").val(null)&&n()("#windSpeed").val(e.windSpeed),e.windGust&&n()("#windGust").val(null)&&n()("#windGust").val(e.windGust),e.windDirection&&n()("#windDirection").val(null)&&n()("#windDirection").val(e.windDirection),e.temperature&&n()("#temperature").val(null)&&n()("#temperature").val(e.temperature),e.humidity&&n()("#humidity").val(null)&&n()("#humidity").val(e.humidity),e.cloudCoverPercent&&n()("#cloudCover").val(null)&&n()("#cloudCover").val(e.cloudCoverPercent)}))),n()("#raceState").data("previous",e)}function u(e){e.preventDefault(),n()("#compLoading").show();var t=n()(this),a=t.attr("data-submit-url");return n().ajax({type:"POST",url:a,beforeSend:function(e){n()("#compLoading").show(),e.setRequestHeader("RequestVerificationToken",n()('input:hidden[name="__RequestVerificationToken"]').val())},data:t.serialize(),success:d,error:m}),n()("#compLoading").hide(),!1}function d(){T(n()("#clubId").val(),n()("#fleetId").val()),n()("#createCompetitor").modal("hide")}function m(){n()("#compCreateAlert").show()}function p(){var e=event.target,t=n()(e).closest("li");t.prev().insertAfter(t),S()}function f(){var e=event.target,t=n()(e).closest("li");t.next().insertBefore(t),S()}function v(){document.activeElement.blur();var e=n()("#deleteConfirm"),t=e.find("#compIdToDelete").val();n()("#results").find(`[data-competitorid='${t}']`).remove(),S(),M(),A(),e.modal("hide")}function g(){var e=event.target,t=n()(e).closest("li"),a=t.get(0).dataset.competitorid,i=t.find(".competitor-name").text();i||(i=t.find(".sail-number").text());var o=n()("#deleteConfirm");o.find("#competitorNameToDelete").text(i),o.find("#compIdToDelete").val(a),o.show()}function h(){n()("#scoreButtonFooter").hide()}function b(){if(!(event.target instanceof HTMLButtonElement))return;let e=event.target.dataset.competitorid;y(w.find((t=>t.id.toString()===e)))}function y(e){let t=document.getElementById("results"),a=document.getElementById("competitorTemplate").cloneNode(!0);a.id=e.id.toString(),a.setAttribute("data-competitorId",e.id.toString()),function(e,t,n){var a=e.getElementsByClassName("competitor-name")[0];a.appendChild(document.createTextNode(t.name||"")),(a=e.getElementsByClassName("sail-number")[0]).appendChild(document.createTextNode(t.sailNumber||"")),t.alternativeSailNumber&&((a=e.getElementsByClassName("alt-sail-number")[0]).appendChild(document.createTextNode(" ("+t.alternativeSailNumber+")")),a.style.display=""),(a=e.getElementsByClassName("race-place")[0]).appendChild(document.createTextNode((0).toString()));for(var i=e.getElementsByClassName("delete-button"),o=0;o<i.length;o++)i[o].dataset.competitorid=t.id.toString()}(a,e),function(e){var t=document.getElementById("trackTimesCheckbox")?.checked,a=e.getElementsByClassName("finish-time-div")[0],i=e.getElementsByClassName("finish-time-input")[0];a.style.display=t?"":"none";var o=e.getElementsByClassName("elapsed-time-div")[0],l=e.getElementsByClassName("elapsed-time-input")[0];o.style.display=t?"":"none";const r=n()("#date").val(),s=new Date;if(r===s.toISOString().substring(0,10)&&t){i.value=s.toTimeString().slice(0,8);const e=document.getElementById("StartTime");if(e?.value){const t=H(e.value);if(t){const e=new Date(s);t>e&&t.setDate(t.getDate()-1);let n=e.getTime()-t.getTime();n<0&&(n+=864e5),l.value=W(n)}}}}(a),function(e){var t=e.getElementsByClassName("finish-time-input")[0],a=e.getElementsByClassName("elapsed-time-input")[0];t&&n()(t).change(re),a&&n()(a).change(se)}(a),a.style.display="",C(e)||(t.appendChild(a),function(e){S(),n()("html, body").animate({scrollTop:n()(e).offset().top-150},300),n()("#newCompetitor").val(""),M(),A()}(a))}function S(){for(var e=document.getElementById("results").getElementsByTagName("li"),t=1,n=1,a=e.length;n<a;n++){var i=e[n].getElementsByClassName("race-place")[0];e[n].setAttribute("data-place",n.toString());var o=e[n].getAttribute("data-originalScore");"competitorTemplate"!==i.id&&(F(e[n])&&"0"!==o?(i.textContent=t.toString(),e[n].setAttribute("data-place",t.toString()),t++):(i.textContent=O(e[n]),e[n].removeAttribute("data-place")));var l=e[n].getElementsByClassName("code-points")[0];q(e[n])?l.style.display="":(l.style.display="none",l.value="")}}function C(e){for(var t=document.getElementById("results").getElementsByTagName("li"),n=0,a=t.length;n<a;n++)if(t[n].getAttribute("data-competitorId")===e.id.toString())return!0;return!1}var w,E,N;function T(e,t){n()&&e&&t&&t.length>31&&n().getJSON("/api/Competitors",{clubId:e,fleetId:t},(function(e){w=e,M(),n()("#scoreButtonDiv").empty(),n()("#scoreButtonFooter").show(),w.forEach((e=>{let t="btn quick-comp ";C(e)?t+="btn-primary add-comp-disabled":t+="btn-outline-primary add-comp-enabled",n()("#scoreButtonDiv").append('<button class="'+t+'" data-competitorid="'+e.id+'" > '+(e.sailNumber||e.alternativeSailNumber||e.name)+" </button>")}))}))}function I(){let e=document.getElementById("raceNumber");if(null==e)return;let t=n()("#clubId").val(),a=n()("#fleetId").val(),i=n()("#regattaId").val(),o=n()("#date").val();n()&&t&&a&&o&&a.length>=32&&n().getJSON("/api/Races/RaceNumber",{clubId:t,fleetId:a,raceDate:o,regattaId:i},(function(t){e.textContent=t?.order?t.order.toString():""}))}var B,D,R,k,x,L=!1;function M(){E=function(){const e=[];return w.forEach((t=>{if(!C(t)){let n={value:t.name,data:t};t.alternativeSailNumber?n.value=t.sailNumber+" ( "+t.alternativeSailNumber+" ) - "+t.name:t.sailNumber&&(n.value=t.sailNumber+" - "+t.name),e.push(n)}})),e}(),L&&n()("#newCompetitor").autocomplete().dispose(),n()("#newCompetitor").autocomplete({lookup:E,onSelect:function(e){y(e.data)},autoSelectFirst:!0,triggerSelectOnValidInput:!1,noCache:!0}),L=!0}function A(){n()("#scoreButtonDiv").empty(),w.forEach((e=>{let t="btn quick-comp ";C(e)?t+="btn-primary add-comp-disabled":t+="btn-outline-primary add-comp-enabled",n()("#scoreButtonDiv").append('<button class="'+t+'" data-competitorid="'+e.id+'" > '+(e.sailNumber||e.alternativeSailNumber||e.name)+" </button>")}))}function O(e){const t=e.getElementsByClassName("select-code")[0].value;return t===a?null:t}function P(e){const t=e.getElementsByClassName("code-points")[0].value;return t===a?null:t}function F(e){const t=e.getElementsByClassName("select-code")[0].value;return t===a||!!scoreCodes.filter((e=>e.name===t))[0].preserveResult}function q(e){const t=e.getElementsByClassName("select-code")[0].value;return t!==a&&"MAN"===scoreCodes.filter((e=>e.name===t))[0].formula}function $(){n()("#weatherIcon").val("Select..."),n()("#weatherDescription").val(null),n()("#windSpeed").val(null),n()("#windGust").val(null),n()("#windDirection").val(null),n()("#temperature").val(null),n()("#humidity").val(null),n()("#cloudcover").val(null)}function j(e){n().ajax({type:"GET",url:window.speechInfoUrl,dataType:"json",beforeSend:function(e){e.setRequestHeader("Accept","application/json")},success:function(t){X=0,R=t.token,D=t.region,B=t.userLanguage,k=Date.now(),e&&e()},error:function(e,t,a){++X<3&&n().ajax(this)}})}function z(){const e=document.getElementById("trackTimesCheckbox");if(!e||!e.checked)return;const t=document.getElementById("StartTime");if(!t||!t.value)return;const a=H(t.value);a&&n()("#results li").each((function(){const e=n()(this).find('input[name="FinishTime"]')[0],t=n()(this).find('input[name="ElapsedTime"]')[0];if(e||t)if(t&&t.value){const n=G(t.value);if(null!==n){let t=new Date(a.getTime()+n);t<a&&(t=new Date(t.getTime()+864e5)),e.value=_(t)}}else if(e&&e.value){let n=H(e.value,a);if(n){n<a&&(n=new Date(n.getTime()+864e5));const i=n.getTime()-a.getTime();t.value=W(i),e.value=_(n)}}}))}function H(e,t){if(!e)return null;const n=e.split(":");if(n.length<2)return null;const a=t?new Date(t):new Date;return a.setSeconds(0,0),a.setHours(parseInt(n[0],10)),a.setMinutes(parseInt(n[1],10)),n.length>2&&a.setSeconds(parseInt(n[2],10)),a}function W(e){const t=Math.floor(e/1e3),n=Math.floor(t/3600),a=Math.floor(t%3600/60),i=t%60;return`${n.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}function G(e){if(!e)return null;const t=e.split(":").map(Number);if(t.some(isNaN))return null;let n=0;if(3===t.length)n=3600*t[0]+60*t[1]+t[2];else if(2===t.length)n=60*t[0]+t[1];else{if(1!==t.length)return null;n=t[0]}return 1e3*n}function _(e){return e.toTimeString().slice(0,8)}!function(){if(document.querySelector("form").onkeypress=i,n()("#fleetId").change(l),""==n()("#defaultRaceDateOffset").val())n()("#date").val("");else if("True"===n()("#needsLocalDate").val()){let a=new Date;const d=new Date(n()("#date").val()),m=new Date(a);m.setDate(a.getDate()+1);const y=new Date(a);if(y.setDate(a.getDate()-1),d>y&&d<m){const C=Number.parseInt(n()("#defaultRaceDateOffset").val(),10);a.setDate(a.getDate()+C),a.setMinutes(a.getMinutes()-a.getTimezoneOffset()),n()("#date").val(a.toISOString().substring(0,10))}n()("#needsLocalDate").val("")}n()("#date").change(r),n()('#results input[name="FinishTime"]').change(re),n()('#results input[name="ElapsedTime"]').change(se),n()("#raceState").data("previous",n()("#raceState").val()),n()("#raceState").change(c),n()(".weather-input").change(s),n()("#results").on("click",".select-code",S),n()("#results").on("click",".move-up",p),n()("#results").on("click",".move-down",f),n()("#results").on("click",".delete-button",g),n()("#scoreButtonDiv").on("click",".add-comp-enabled",b),n()("#deleteConfirmed").click(v),n()("#closefooter").click(h),n()("#compform").submit(u),n()("#raceform").submit((function(e){var t=n()("#ssWaitingModal");t&&t.show(),n()("#submitButton").attr("value","Please wait...");var a=document.getElementById("raceform");n()("#submitButton").attr("disabled","disabled"),function(e){!function(e){n()(e).find("[name^=Scores]").remove()}(e);for(var t=document.getElementById("results").getElementsByTagName("li"),a=1;a<t.length;a++){const n=(a-1).toString();var i=document.createElement("input");i.type="hidden",i.name="Scores["+n+"].competitorId",i.value=t[a].getAttribute("data-competitorId"),e.appendChild(i),(i=document.createElement("input")).type="hidden",i.name="Scores["+n+"].place",F(t[a])&&(i.value=t[a].getAttribute("data-place")),e.appendChild(i),(i=document.createElement("input")).type="hidden",i.name="Scores["+n+"].code",i.value=O(t[a]),e.appendChild(i),(i=document.createElement("input")).type="hidden",i.name="Scores["+n+"].codePointsString",i.value=P(t[a]),e.appendChild(i);var o=t[a].querySelector('input[name="FinishTime"]');o?.value&&((i=document.createElement("input")).type="hidden",i.name="Scores["+n+"].FinishTime",i.value=o.value,e.appendChild(i));let l=t[a].querySelector('input[name="ElapsedTime"]');l?.value&&((i=document.createElement("input")).type="hidden",i.name="Scores["+n+"].ElapsedTime",i.value=l.value,e.appendChild(i))}}(a)})),n()("#submitButton").prop("disabled",!1),n()("#submitDisabledMessage").prop("hidden",!0),j(null),window.onload=function(){l(),o(),S()};const e=document.getElementById("trackTimesCheckbox");if(e){function w(){!function(e){const t=e?"":"none";n()("#results li").each((function(){n()(this).find('input[name="FinishTime"]').closest("div").css("display",t),n()(this).find('input[name="ElapsedTime"]').closest("div").css("display",t)}))}(e.checked),z()}e.addEventListener("change",w),w()}const t=document.getElementById("StartTime");t&&t.addEventListener("change",(function(){z()}))}();var J,V,K,U,Q,X=0;function Y(e,t){!function(e){switch(console.debug(`(recognized)  Reason: ${J.ResultReason[e.reason]}`),e.reason){case J.ResultReason.NoMatch:var t=J.NoMatchDetails.fromResult(e);console.debug(` NoMatchReason: ${J.NoMatchReason[t.reason]}\r\n`),ie();break;case J.ResultReason.Canceled:var n=J.CancellationDetails.fromResult(e);console.debug(` CancellationReason: ${J.CancellationReason[n.reason]}`),console.debug(n.reason===J.CancellationReason.Error?`: ${n.errorDetails}`:""),ie();break;case J.ResultReason.RecognizedSpeech:e.text&&(V.innerHTML=e.text),e.text&&Z(ee(e.text)+" ")}}(t.result)}function Z(e){let t;var a,i;if(console.debug(e),t=w.find((t=>t.sailNumber&&e.startsWith(ee(t.sailNumber)+" "))),t&&(a=ee(t.sailNumber)),t||(t=w.find((t=>t.alternativeSailNumber&&e.startsWith(ee(t.alternativeSailNumber)+" "))),t&&(a=ee(t.alternativeSailNumber))),t||(t=w.find((t=>t.name&&e.startsWith(ee(t.name)+" "))),t&&(a=ee(t.name))),t)y(t),x=Date.now(),i=e.substr(a.length).trimLeft();else{var o=scoreCodes.find((t=>e.startsWith(ee(t.name)+" ")));!function(e){n()(".select-code").last().val(e)}(o.name),a=ee(o.name),i=e.substr(a.length).trimLeft()}t||o||!i&&e.indexOf(" ")>-1&&(i=e.substr(e.indexOf(" ")+1).trimLeft()),i.length>0&&Z(i),ie()}function ee(e){return e?e.replace(/[.?,\/#!$%\^&\*;:{}=\-_`~()]/g,"").toUpperCase():null}function te(e,t){console.debug("(sessionStarted)"),K.style.display="none",U.style.display="block",V.innerHTML="Listening"}function ne(e,t){console.debug("(sessionStopped)"),V.innerHTML="",K.style.display="block",U.style.display="none"}function ae(e,t){window.console.log(t),console.debug("(cancel) Reason: "+J.CancellationReason[t.reason]),t.reason===J.CancellationReason.Error&&console.debug(": "+t.errorDetails),ie()}function ie(){x<Date.now()-3e4&&le()}function oe(){if(V.innerHTML="",x=Date.now(),k<Date.now()-3e5)j(oe);else{var e=J.AudioConfig.fromDefaultMicrophoneInput(),t=function(e){var t;return R&&(t=e.fromAuthorizationToken(R,D)),t.setProperty(J.SpeechServiceConnection_EndSilenceTimeoutMs,1e3),t.speechRecognitionLanguage=B,t}(J.SpeechConfig);t&&(function(e){if(e.recognized=Y,e.canceled=ae,Q.sessionStarted=te,Q.sessionStopped=ne,E){for(var t=J.PhraseListGrammar.fromRecognizer(Q),n=0;n<w.length;n++)w[n].sailNumber&&t.addPhrase(w[n].sailNumber),w[n].alternativeSailNumber&&t.addPhrase(w[n].alternativeSailNumber),w[n].name&&t.addPhrase(w[n].name);for(n=0;n<scoreCodes.length;n++)t.addPhrase(scoreCodes[n].name)}}(Q=new J.SpeechRecognizer(t,e)),Q.startContinuousRecognitionAsync())}}function le(){Q.stopContinuousRecognitionAsync((function(){Q.close(),Q=void 0}),(function(e){Q.close(),Q=void 0}))}function re(){const e=this,t=n()(e).closest("li").find('input[name="ElapsedTime"]')[0],a=document.getElementById("StartTime");if(!a||!a.value||!e.value)return;const i=H(a.value),o=H(e.value,i);if(!i||!o)return;let l=o.getTime()-i.getTime();l<0&&(l+=864e5),t.value=W(l)}function se(){const e=this,t=n()(e).closest("li").find('input[name="FinishTime"]')[0],a=document.getElementById("StartTime");if(!a||!a.value||!e.value)return;const i=H(a.value),o=G(e.value);if(!i||null===o)return;const l=new Date(i.getTime()+o);t.value=_(l)}document.addEventListener("DOMContentLoaded",(function(){var e;K=document.getElementById("scenarioStartButton"),U=document.getElementById("scenarioStopButton"),V=document.getElementById("phraseDiv"),U&&U.addEventListener("click",le),K&&(K.addEventListener("click",oe),e=function(e){J=e},window.SpeechSDK&&(document.getElementById("speechwarning").style.display="none",e(window.SpeechSDK)))}))})();
//# sourceMappingURL=raceEditor.min.js.map