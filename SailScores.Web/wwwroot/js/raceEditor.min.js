!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}([function(e,t){e.exports=jQuery},function(e,t){e.exports=bootstrap},function(e,t){e.exports=window["bootstrap-select"]},,,,,,,,,,,function(e,t,n){e.exports=n(14)},function(e,t,n){"use strict";n.r(t),n.d(t,"initialize",(function(){return a})),n.d(t,"loadSeriesOptions",(function(){return r})),n.d(t,"loadFleet",(function(){return i})),n.d(t,"dateChanged",(function(){return l})),n.d(t,"weatherChanged",(function(){return c})),n.d(t,"raceStateChanged",(function(){return u})),n.d(t,"compCreateSubmit",(function(){return s})),n.d(t,"completeCompCreate",(function(){return d})),n.d(t,"completeCompCreateFailed",(function(){return m})),n.d(t,"hideAlert",(function(){return p})),n.d(t,"moveUp",(function(){return f})),n.d(t,"moveDown",(function(){return v})),n.d(t,"deleteResult",(function(){return g})),n.d(t,"confirmDelete",(function(){return h})),n.d(t,"hideScoreButtonFooter",(function(){return b})),n.d(t,"addNewCompetitorFromButton",(function(){return y})),n.d(t,"calculatePlaces",(function(){return C}));n(0),n(1),n(2);function o(e){const t=e||event;return/textarea/i.test(t.srcElement.tagName)||13!==(e.keyCode||e.which||e.charCode||0)}function a(){if(document.querySelector("form").onkeypress=o,$("#fleetId").change(i),"True"===$("#needsLocalDate").val()){var e=new Date;e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),$("#date").val(e.toISOString().substring(0,10)),$("#needsLocalDate").val("")}$("#date").change(l),$("#raceState").data("previous",$("#raceState").val()),$("#raceState").change(u),$(".weather-input").change(c),$("#results").on("click",".select-code",C),$("#results").on("click",".move-up",f),$("#results").on("click",".move-down",v),$("#results").on("click",".delete-button",h),$("#scoreButtonDiv").on("click",".add-comp-enabled",y),$("#deleteConfirmed").click(g),$("#closefooter").click(b),$("#compform").submit(s),$("#raceform").submit((function(e){!function(e){!function(e){$(e).find("[name^=Scores]").remove()}(e);for(var t=document.getElementById("results").getElementsByTagName("li"),n=1;n<t.length;n++){const a=(n-1).toString();var o=document.createElement("input");o.type="hidden",o.name="Scores["+a+"].competitorId",o.value=t[n].getAttribute("data-competitorId"),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+a+"].place",j(t[n])&&(o.value=t[n].getAttribute("data-place")),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+a+"].code",o.value=O(t[n]),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+a+"].codePointsString",o.value=P(t[n]),e.appendChild(o)}}(document.getElementById("raceform"))})),i(),r(),C(),$("#submitButton").prop("disabled",!1),$("#submitDisabledMessage").prop("hidden",!0),F(null)}function r(){!function(e,t){e&&t&&$.getJSON("/api/Series",{clubId:e,date:t},(function(e){E=e,function(){let e=$("#seriesIds");var t=e.val();e.empty(),$.each(E,(function(t,n){let o=n;e.append($("<option></option>").attr("value",o.id.toString()).text(o.name))})),e.selectpicker("destroy"),e.selectpicker(),e.val(t),e.selectpicker("refresh")}()}))}($("#clubId").val(),$("#date").val())}function i(){let e=$("#clubId").val(),t=$("#fleetId").val(),n=document.getElementById("fleetId"),o=n.options[n.selectedIndex].getAttribute("data-boat-class-id");o&&$("#createCompBoatClassSelect").val(o),t.length<30?$("#createCompButton").prop("disabled",!0):$("#createCompButton").prop("disabled",!1),$("#createCompFleetId").val(t),I(e,t)}function l(){console.log("dateChanged"),r(),"true"===$("#defaultWeather").val()&&(console.log("defaultWeather was true"),z())}function c(){$("#defaultWeather").val("false")}function u(){let e=$("#raceState").val();var t;"2"===e&&z(),"1"===e&&"4"!==$("#raceState").data("previous")&&(t=$("#clubInitials").val(),$.getJSON("/"+t+"/weather/current/",{},(function(e){e.icon&&$("#weatherIcon").val(null)&&($("#weatherIcon").val(e.icon),$("#weatherIcon").selectpicker("refresh")),e.description&&$("#weatherDescription").val(null)&&$("#weatherDescription").val(e.description),e.windSpeed&&$("#windSpeed").val(null)&&$("#windSpeed").val(e.windSpeed),e.windGust&&$("#windGust").val(null)&&$("#windGust").val(e.windGust),e.windDirection&&$("#windDirection").val(null)&&$("#windDirection").val(e.windDirection),e.temperature&&$("#temperature").val(null)&&$("#temperature").val(e.temperature),e.humidity&&$("#humidity").val(null)&&$("#humidity").val(e.humidity),e.cloudCoverPercent&&$("#cloudCover").val(null)&&$("#cloudCover").val(e.cloudCoverPercent)}))),$("#raceState").data("previous",e)}function s(e){e.preventDefault(),$("#compLoading").show();var t=$(this),n=t.attr("data-submit-url");return $.ajax({type:"POST",url:n,beforeSend:function(e){$("#compLoading").show(),e.setRequestHeader("RequestVerificationToken",$('input:hidden[name="__RequestVerificationToken"]').val())},data:t.serialize(),success:d,error:m}),$("#compLoading").hide(),!1}function d(){I($("#clubId").val(),$("#fleetId").val()),$("#createCompetitor").modal("hide")}function m(){$("#compCreateAlert").show()}function p(){$("#compCreateAlert").hide()}function f(){var e=event.target,t=$(e).closest("li");t.prev().insertAfter(t),C()}function v(){var e=event.target,t=$(e).closest("li");t.next().insertBefore(t),C()}function g(){var e=$("#deleteConfirm"),t=e.find("#compIdToDelete").val();$("#results").find(`[data-competitorid='${t}']`).remove(),C(),M(),e.modal("hide")}function h(){var e=event.target,t=$(e).closest("li"),n=t.data("competitorid"),o=t.find(".competitor-name").text();o||(o=t.find(".sail-number").text());var a=$("#deleteConfirm");a.find("#competitorNameToDelete").text(o),a.find("#compIdToDelete").val(n),a.show()}function b(){$("#scoreButtonFooter").hide()}function y(){if(!(event.target instanceof HTMLButtonElement))return;var e=event.target.dataset.competitorid;S(N.find(t=>t.id.toString()===e))}function S(e){var t=document.getElementById("results"),n=document.getElementById("competitorTemplate").cloneNode(!0);n.id=e.id.toString(),n.setAttribute("data-competitorId",e.id.toString());var o=n.getElementsByClassName("competitor-name")[0];o.appendChild(document.createTextNode(e.name||"")),(o=n.getElementsByClassName("sail-number")[0]).appendChild(document.createTextNode(e.sailNumber||"")),e.alternativeSailNumber&&((o=n.getElementsByClassName("alt-sail-number")[0]).appendChild(document.createTextNode(" ("+e.alternativeSailNumber+")")),o.style.display=""),(o=n.getElementsByClassName("race-place")[0]).appendChild(document.createTextNode((0).toString()));for(var a=n.getElementsByClassName("delete-button"),r=0;r<a.length;r++)a[r].setAttribute("data-competitorId",e.id.toString());n.style.display="",w(e)||(t.appendChild(n),C(),$("html, body").animate({scrollTop:$(n).offset().top-150},300),$("#newCompetitor").val(""),A(),M())}function C(){for(var e=document.getElementById("results").getElementsByTagName("li"),t=1,n=1,o=e.length;n<o;n++){var a=e[n].getElementsByClassName("race-place")[0];e[n].setAttribute("data-place",n.toString());var r=e[n].getAttribute("data-originalScore");"competitorTemplate"!==a.id&&(j(e[n])&&"0"!==r?(a.textContent=t.toString(),e[n].setAttribute("data-place",t.toString()),t++):(a.textContent=O(e[n]),e[n].removeAttribute("data-place")));var i=e[n].getElementsByClassName("code-points")[0];_(e[n])?i.style.display="":(i.style.display="none",i.value="")}}function w(e){for(var t=document.getElementById("results").getElementsByTagName("li"),n=0,o=t.length;n<o;n++)if(t[n].getAttribute("data-competitorId")===e.id.toString())return!0;return!1}var N,B,E;function I(e,t){$&&e&&t&&t.length>31&&$.getJSON("/api/Competitors",{clubId:e,fleetId:t},(function(e){N=e,A(),function(){$("#scoreButtonDiv").empty(),N&&N.length&&N.length<21?$("#scoreButtonFooter").show():$("#scoreButtonFooter").hide();N.forEach(e=>{let t="btn ";w(e)?t+="btn-primary add-comp-disabled":t+="btn-outline-primary add-comp-enabled",$("#scoreButtonDiv").append('<button class="'+t+'" data-competitorid="'+e.id+'" > '+(e.sailNumber||e.alternativeSailNumber||e.name)+" </button>")})}()}))}var D,x,R,T,k,L=!1;function A(){B=function(){const e=[];return N.forEach(t=>{if(!w(t)){let n={value:t.name,data:t};t.alternativeSailNumber?n.value=t.sailNumber+" ( "+t.alternativeSailNumber+" ) - "+t.name:t.sailNumber&&(n.value=t.sailNumber+" - "+t.name),e.push(n)}}),e}(),L&&$("#newCompetitor").autocomplete().dispose(),$("#newCompetitor").autocomplete({lookup:B,onSelect:function(e){S(e.data)},autoSelectFirst:!0,triggerSelectOnValidInput:!1,noCache:!0}),L=!0}function M(){$("#scoreButtonDiv").empty(),N.forEach(e=>{let t="btn ";w(e)?t+="btn-primary add-comp-disabled":t+="btn-outline-primary add-comp-enabled",$("#scoreButtonDiv").append('<button class="'+t+'" data-competitorid="'+e.id+'" > '+(e.sailNumber||e.alternativeSailNumber||e.name)+" </button>")})}function O(e){const t=e.getElementsByClassName("select-code")[0].value;return"No Code"===t?null:t}function P(e){const t=e.getElementsByClassName("code-points")[0].value;return"No Code"===t?null:t}function j(e){const t=e.getElementsByClassName("select-code")[0].value;if("No Code"===t)return!0;return!!scoreCodes.filter(e=>e.name===t)[0].preserveResult}function _(e){const t=e.getElementsByClassName("select-code")[0].value;if("No Code"===t)return!1;return"MAN"===scoreCodes.filter(e=>e.name===t)[0].formula}function z(){$("#weatherIcon").val("Select..."),$("#weatherIcon").selectpicker("refresh"),$("#weatherDescription").val(null),$("#windSpeed").val(null),$("#windGust").val(null),$("#windDirection").val(null),$("#temperature").val(null),$("#humidity").val(null),$("#cloudcover").val(null)}function F(e){$.ajax({type:"GET",url:window.speechInfoUrl,dataType:"json",beforeSend:function(e){e.setRequestHeader("Accept","application/json")},success:function(t){U=0,R=t.token,x=t.region,D=t.userLanguage,T=Date.now(),e&&e()},error:function(e,t,n){++U<3&&$.ajax(this)}})}var G,H,W,q,J,U=0;function V(e,t){!function(e){switch(console.debug("(recognized)  Reason: "+G.ResultReason[e.reason]),e.reason){case G.ResultReason.NoMatch:var t=G.NoMatchDetails.fromResult(e);console.debug(` NoMatchReason: ${G.NoMatchReason[t.reason]}\r\n`),Z();break;case G.ResultReason.Canceled:var n=G.CancellationDetails.fromResult(e);console.debug(" CancellationReason: "+G.CancellationReason[n.reason]),console.debug(n.reason===G.CancellationReason.Error?": "+n.errorDetails:""),Z();break;case G.ResultReason.RecognizedSpeech:e.text&&(H.innerHTML=e.text),e.text&&function e(t){let n;var o,a;console.debug(t),n=N.find(e=>e.sailNumber&&t.startsWith(K(e.sailNumber)+" ")),n&&(o=K(n.sailNumber));n||(n=N.find(e=>e.alternativeSailNumber&&t.startsWith(K(e.alternativeSailNumber)+" ")),n&&(o=K(n.alternativeSailNumber)));n||(n=N.find(e=>e.name&&t.startsWith(K(e.name)+" ")),n&&(o=K(n.name)));if(n)S(n),k=Date.now(),a=t.substr(o.length).trimLeft();else{var r=scoreCodes.find(e=>t.startsWith(K(e.name)+" "));!function(e){$(".select-code").last().val(e)}(r.name),o=K(r.name),a=t.substr(o.length).trimLeft()}n||r||!a&&t.indexOf(" ")>-1&&(a=t.substr(t.indexOf(" ")+1).trimLeft());a.length>0&&e(a);Z()}(K(e.text)+" ")}}(t.result)}function K(e){return e?e.replace(/[.?,\/#!$%\^&\*;:{}=\-_`~()]/g,"").toUpperCase():null}function Q(e,t){console.debug("(sessionStarted)"),W.style.display="none",q.style.display="block",H.innerHTML="Listening"}function X(e,t){console.debug("(sessionStopped)"),H.innerHTML="",W.style.display="block",q.style.display="none"}function Y(e,t){window.console.log(t),console.debug("(cancel) Reason: "+G.CancellationReason[t.reason]),t.reason===G.CancellationReason.Error&&console.debug(": "+t.errorDetails),Z()}function Z(){k<Date.now()-3e4&&te()}function ee(){if(H.innerHTML="",k=Date.now(),T<Date.now()-3e5)F(ee);else{var e=G.AudioConfig.fromDefaultMicrophoneInput(),t=function(e){var t;return R&&(t=e.fromAuthorizationToken(R,x)),t.setProperty(G.SpeechServiceConnection_EndSilenceTimeoutMs,1e3),t.speechRecognitionLanguage=D,t}(G.SpeechConfig);t&&(function(e){if(e.recognized=V,e.canceled=Y,J.sessionStarted=Q,J.sessionStopped=X,B){for(var t=G.PhraseListGrammar.fromRecognizer(J),n=0;n<N.length;n++)N[n].sailNumber&&t.addPhrase(N[n].sailNumber),N[n].alternativeSailNumber&&t.addPhrase(N[n].alternativeSailNumber),N[n].name&&t.addPhrase(N[n].name);for(n=0;n<scoreCodes.length;n++)t.addPhrase(scoreCodes[n].name)}}(J=new G.SpeechRecognizer(t,e)),J.startContinuousRecognitionAsync())}}function te(){J.stopContinuousRecognitionAsync((function(){J.close(),J=void 0}),(function(e){J.close(),J=void 0}))}document.addEventListener("DOMContentLoaded",(function(){var e;W=document.getElementById("scenarioStartButton"),q=document.getElementById("scenarioStopButton"),H=document.getElementById("phraseDiv"),q&&q.addEventListener("click",te),W&&(W.addEventListener("click",ee),e=function(e){G=e},window.SpeechSDK&&(document.getElementById("speechwarning").style.display="none",e(window.SpeechSDK)))})),a()}]);
//# sourceMappingURL=raceEditor.js.map