!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t){e.exports=jQuery},,,,,,,function(e,t,n){e.exports=n(8)},function(e,t,n){"use strict";n.r(t),n.d(t,"initialize",(function(){return i})),n.d(t,"loadSeriesOptions",(function(){return l})),n.d(t,"loadFleet",(function(){return c})),n.d(t,"raceStateChanged",(function(){return u})),n.d(t,"compCreateSubmit",(function(){return d})),n.d(t,"completeCompCreate",(function(){return s})),n.d(t,"completeCompCreateFailed",(function(){return m})),n.d(t,"hideAlert",(function(){return p})),n.d(t,"moveUp",(function(){return f})),n.d(t,"moveDown",(function(){return v})),n.d(t,"deleteResult",(function(){return g})),n.d(t,"confirmDelete",(function(){return b})),n.d(t,"hideScoreButtonFooter",(function(){return h})),n.d(t,"addNewCompetitorFromButton",(function(){return y})),n.d(t,"calculatePlaces",(function(){return S}));var o=n(0),r=n.n(o);n(9),n(10);function a(e){const t=e||event;return/textarea/i.test(t.srcElement.tagName)||13!==(e.keyCode||e.which||e.charCode||0)}function i(){document.querySelector("form").onkeypress=a,r()("#fleetId").change(c),r()("#date").change(l),r()("#raceState").change(u),r()("#results").on("click",".select-code",S),r()("#results").on("click",".move-up",f),r()("#results").on("click",".move-down",v),r()("#results").on("click",".delete-button",b),r()("#scoreButtonDiv").on("click",".add-comp-enabled",y),r()("#deleteConfirmed").click(g),r()("#closefooter").click(h),r()("#compform").submit(d),r()("#raceform").submit((function(e){e.preventDefault();!function(e){for(var t=document.getElementById("results").getElementsByTagName("li"),n=1;n<t.length;n++){const r=(n-1).toString();var o=document.createElement("input");o.type="hidden",o.name="Scores["+r+"].competitorId",o.value=t[n].getAttribute("data-competitorId"),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+r+"].place",A(t[n])&&(o.value=t[n].getAttribute("data-place")),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+r+"].code",o.value=T(t[n]),e.appendChild(o),(o=document.createElement("input")).type="hidden",o.name="Scores["+r+"].codePointsString",o.value=k(t[n]),e.appendChild(o)}}(this),this.submit(),function(e){e.find("[name^=Scores]").remove()}(this)})),c(),l(),S(),r()("#submitButton").prop("disabled",!1),r()("#submitDisabledMessage").prop("hidden",!0)}function l(){!function(e,t){e&&t&&r.a.getJSON("/api/Series",{clubId:e,date:t},(function(e){I=e,function(){let e=r()("#seriesIds");var t=e.val();e.empty(),r.a.each(I,(function(t,n){let o=n;e.append(r()("<option></option>").attr("value",o.id.toString()).text(o.name))})),e.selectpicker("destroy"),e.selectpicker(),e.val(t),e.selectpicker("refresh")}()}))}(r()("#clubId").val(),r()("#date").val())}function c(){let e=r()("#clubId").val(),t=r()("#fleetId").val(),n=document.getElementById("fleetId"),o=n.options[n.selectedIndex].getAttribute("data-boat-class-id");o&&r()("#createCompBoatClassSelect").val(o),t.length<30?r()("#createCompButton").prop("disabled",!0):r()("#createCompButton").prop("disabled",!1),r()("#createCompFleetId").val(t),E(e,t)}function u(){let e=r()("#raceState").val();var t;"2"===e&&(r()("#weatherIcon").val("Select..."),r()("#weatherIcon").selectpicker("refresh"),r()("#weatherDescription").val(null),r()("#windSpeed").val(null),r()("#windGust").val(null),r()("#windDirection").val(null),r()("#temperature").val(null),r()("#humidity").val(null),r()("#cloudcover").val(null)),"1"===e&&(t=r()("#clubInitials").val(),r.a.getJSON("/"+t+"/weather/current/",{},(function(e){console.log(e),e.icon&&r()("#weatherIcon").val(null)&&(r()("#weatherIcon").val(e.icon),r()("#weatherIcon").selectpicker("refresh")),e.description&&r()("#weatherDescription").val(null)&&r()("#weatherDescription").val(e.description),e.windSpeed&&r()("#windSpeed").val(null)&&r()("#windSpeed").val(e.windSpeed),e.windGust&&r()("#windGust").val(null)&&r()("#windGust").val(e.windGust),e.windDirection&&r()("#windDirection").val(null)&&r()("#windDirection").val(e.windDirection),e.temperature&&r()("#temperature").val(null)&&r()("#temperature").val(e.temperature),e.humidity&&r()("#humidity").val(null)&&r()("#humidity").val(e.humidity),e.cloudCoverPercent&&r()("#cloudCover").val(null)&&r()("#cloudCover").val(e.cloudCoverPercent)})))}function d(e){e.preventDefault(),r()("#compLoading").show();var t=r()(this);console.log(t);var n=t.attr("data-submit-url");console.log(n);return r.a.ajax({type:"POST",url:n,beforeSend:function(e){r()("#compLoading").show(),e.setRequestHeader("RequestVerificationToken",r()('input:hidden[name="__RequestVerificationToken"]').val())},data:t.serialize(),success:s,error:m}),r()("#compLoading").hide(),!1}function s(){E(r()("#clubId").val(),r()("#fleetId").val()),r()("#createCompetitor").modal("hide")}function m(){r()("#compCreateAlert").show()}function p(){r()("#compCreateAlert").hide()}function f(){var e=event.target,t=r()(e).closest("li");t.prev().insertAfter(t),S()}function v(){var e=event.target,t=r()(e).closest("li");t.next().insertBefore(t),S()}function g(){var e=r()("#deleteConfirm"),t=e.find("#compIdToDelete").val();r()("#results").find(`[data-competitorid='${t}']`).remove(),S(),e.modal("hide")}function b(){var e=event.target,t=r()(e).closest("li"),n=t.data("competitorid"),o=t.find(".competitor-name").text(),a=r()("#deleteConfirm");a.find("#competitorNameToDelete").text(o),a.find("#compIdToDelete").val(n),a.show()}function h(){r()("#scoreButtonFooter").hide()}function y(){if(!(event.target instanceof HTMLButtonElement))return;var e=event.target.dataset.competitorid;let t=w.find(t=>t.id.toString()===e);console.log(e),console.log(w),C(t)}function C(e){var t=document.getElementById("results"),n=document.getElementById("competitorTemplate").cloneNode(!0);n.id=e.id.toString(),n.setAttribute("data-competitorId",e.id.toString());var o=n.getElementsByClassName("competitor-name")[0];o.appendChild(document.createTextNode(e.name)),(o=n.getElementsByClassName("sail-number")[0]).appendChild(document.createTextNode(e.sailNumber)),e.alternativeSailNumber&&((o=n.getElementsByClassName("alt-sail-number")[0]).appendChild(document.createTextNode(" ("+e.alternativeSailNumber+")")),o.style.display=""),(o=n.getElementsByClassName("race-place")[0]).appendChild(document.createTextNode((0).toString()));for(var a=n.getElementsByClassName("delete-button"),i=0;i<a.length;i++)a[i].setAttribute("data-competitorId",e.id.toString());n.style.display="",t.appendChild(n),S(),r()("html, body").animate({scrollTop:r()(n).offset().top-150},300),r()("#newCompetitor").val(""),D(),r()("#scoreButtonDiv").empty(),w.forEach(e=>{let t="btn ";N(e)?t+="btn-primary add-comp-disabled":t+="btn-outline-primary add-comp-enabled",r()("#scoreButtonDiv").append('<button class="'+t+'" data-competitorid="'+e.id+'" > '+(e.sailNumber||e.alternativeSailNumber)+" </button>")})}function S(){for(var e=document.getElementById("results").getElementsByTagName("li"),t=1,n=1,o=e.length;n<o;n++){var r=e[n].getElementsByClassName("race-place")[0];e[n].setAttribute("data-place",n.toString());var a=e[n].getAttribute("data-originalScore");"competitorTemplate"!==r.id&&(A(e[n])&&"0"!==a?(r.textContent=t.toString(),e[n].setAttribute("data-place",t.toString()),t++):(r.textContent=T(e[n]),e[n].removeAttribute("data-place")));var i=e[n].getElementsByClassName("code-points")[0];O(e[n])?i.style.display="":(i.style.display="none",i.value="")}}function N(e){for(var t=document.getElementById("results").getElementsByTagName("li"),n=0,o=t.length;n<o;n++)if(t[n].getAttribute("data-competitorId")===e.id.toString())return!0;return!1}var w,B,I;function E(e,t){r.a&&e&&t&&t.length>31&&r.a.getJSON("/api/Competitors",{clubId:e,fleetId:t},(function(e){w=e,D(),function(){r()("#scoreButtonDiv").empty(),w&&w.length&&w.length<21?r()("#scoreButtonFooter").show():r()("#scoreButtonFooter").hide();w.forEach(e=>{let t="btn ";N(e)?t+="btn-primary add-comp-disabled":t+="btn-outline-primary add-comp-enabled",r()("#scoreButtonDiv").append('<button class="'+t+'" data-competitorid="'+e.id+'" > '+(e.sailNumber||e.alternativeSailNumber)+" </button>")})}()}))}var x=!1;function D(){B=function(){const e=[];return console.debug("checking for comps in results"),w.forEach(t=>{if(!N(t)){let n={value:t.sailNumber+" - "+t.name,data:t};t.alternativeSailNumber&&(n.value=t.sailNumber+" ( "+t.alternativeSailNumber+" ) - "+t.name),e.push(n)}}),e}(),x&&r()("#newCompetitor").autocomplete().dispose(),r()("#newCompetitor").autocomplete({lookup:B,onSelect:function(e){C(e.data)},autoSelectFirst:!0,triggerSelectOnValidInput:!1,noCache:!0}),x=!0}function T(e){const t=e.getElementsByClassName("select-code")[0].value;return"No Code"===t?null:t}function k(e){const t=e.getElementsByClassName("code-points")[0].value;return"No Code"===t?null:t}function A(e){const t=e.getElementsByClassName("select-code")[0].value;return"No Code"===t||!!scoreCodes.filter(e=>e.name===t)[0].preserveResult}function O(e){const t=e.getElementsByClassName("select-code")[0].value;return"No Code"!==t&&"MAN"===scoreCodes.filter(e=>e.name===t)[0].formula}i()},function(e,t){e.exports=bootstrap},function(e,t){e.exports=window["bootstrap-select"]}]);