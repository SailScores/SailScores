(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=jQuery;var n=e.n(t);bootstrap;const a="No Code";function o(e){const t=e||event;return/textarea/i.test(t.srcElement.tagName)||13!==(e.keyCode||e.which||e.charCode||0)}function l(){var e,t;e=n()("#clubId").val(),t=n()("#date").val(),e&&t&&n().getJSON("/api/Series",{clubId:e,date:t},(function(e){N=e,function(){let e=n()("#SeriesIds"),t=e.val()||[];e.hasClass("select2-hidden-accessible")&&e.select2("destroy"),e.empty(),n().each(N,(function(t,a){let o=a;e.append(n()("<option></option>").attr("value",o.id.toString()).text(o.name))})),e.select2({width:"100%",placeholder:"Select Series",allowClear:!0}),e.val(t).trigger("change")}()}))}function i(){let e=n()("#clubId").val(),t=n()("#fleetId").val(),a=document.getElementById("fleetId"),o=a.options[a.selectedIndex].getAttribute("data-boat-class-id");o&&n()("#createCompBoatClassSelect").val(o),t.length<30?n()("#createCompButton").prop("disabled",!0):n()("#createCompButton").prop("disabled",!1),n()("#createCompFleetId").val(t),I(e,t),T()}function s(){l(),"true"===n()("#defaultWeather").val()&&(console.log("defaultWeather was true"),$()),T()}function r(){n()("#defaultWeather").val("false")}function c(){let e=n()("#raceState").val();"2"===e&&$(),"1"===e&&"4"!==n()("#raceState").data("previous")&&function(){let e=n()("#clubInitials").val();n().getJSON("/"+e+"/weather/current/",{},(function(e){e.icon&&n()("#weatherIcon").val(null)&&n()("#weatherIcon").val(e.icon),e.description&&n()("#weatherDescription").val(null)&&n()("#weatherDescription").val(e.description),e.windSpeed&&n()("#windSpeed").val(null)&&n()("#windSpeed").val(e.windSpeed),e.windGust&&n()("#windGust").val(null)&&n()("#windGust").val(e.windGust),e.windDirection&&n()("#windDirection").val(null)&&n()("#windDirection").val(e.windDirection),e.temperature&&n()("#temperature").val(null)&&n()("#temperature").val(e.temperature),e.humidity&&n()("#humidity").val(null)&&n()("#humidity").val(e.humidity),e.cloudCoverPercent&&n()("#cloudCover").val(null)&&n()("#cloudCover").val(e.cloudCoverPercent)}))}(),n()("#raceState").data("previous",e)}function u(e){e.preventDefault(),n()("#compLoading").show();let t=n()(this),a=t.attr("data-submit-url");return n().ajax({type:"POST",url:a,beforeSend:function(e){n()("#compLoading").show(),e.setRequestHeader("RequestVerificationToken",n()('input:hidden[name="__RequestVerificationToken"]').val())},data:t.serialize(),success:d,error:m}),n()("#compLoading").hide(),!1}function d(){I(n()("#clubId").val(),n()("#fleetId").val()),n()("#createCompetitor").modal("hide")}function m(){n()("#compCreateAlert").show()}function p(){let e=event.target,t=n()(e).closest("li");t.prev().insertAfter(t),S()}function f(){let e=event.target,t=n()(e).closest("li");t.next().insertBefore(t),S()}function g(){document.activeElement.blur();let e=n()("#deleteConfirm"),t=e.find("#compIdToDelete").val();n()("#results").find(`[data-competitorid='${t}']`).remove(),S(),M(),A(),e.modal("hide")}function v(){let e=event.target,t=n()(e).closest("li"),a=t.data("competitorid"),o=t.find(".competitor-name").text();o||(o=t.find(".sail-number").text());let l=n()("#deleteConfirm");l.find("#competitorNameToDelete").text(o),l.find("#compIdToDelete").val(a),l.show()}function h(){n()("#scoreButtonFooter").hide()}function b(){if(!(event.target instanceof HTMLButtonElement))return;let e=event.target.dataset.competitorid;y(w.find((t=>t.id.toString()===e)))}function y(e){let t=document.getElementById("results"),a=document.getElementById("competitorTemplate").cloneNode(!0);a.id=e.id.toString(),a.setAttribute("data-competitorId",e.id.toString());let o=a.getElementsByClassName("competitor-name")[0];o.appendChild(document.createTextNode(e.name||"")),o=a.getElementsByClassName("sail-number")[0],o.appendChild(document.createTextNode(e.sailNumber||"")),e.alternativeSailNumber&&(o=a.getElementsByClassName("alt-sail-number")[0],o.appendChild(document.createTextNode(" ("+e.alternativeSailNumber+")")),o.style.display=""),o=a.getElementsByClassName("race-place")[0],o.appendChild(document.createTextNode((0).toString()));let l=a.getElementsByClassName("delete-button");for(let t=0;t<l.length;t++)l[t].setAttribute("data-competitorId",e.id.toString());let i=document.getElementById("trackTimesCheckbox")?.checked,s=a.getElementsByClassName("finish-time-div")[0],r=a.getElementsByClassName("finish-time-input")[0];s.style.display=i?"":"none";let c=a.getElementsByClassName("elapsed-time-div")[0],u=a.getElementsByClassName("elapsed-time-input")[0];c.style.display=i?"":"none";const d=n()("#date").val(),m=new Date;if(d===m.toISOString().substring(0,10)&&i){r.value=m.toTimeString().slice(0,8);const e=document.getElementById("StartTime");if(e?.value){const t=H(e.value);if(t){const e=new Date(m);t>e&&t.setDate(t.getDate()-1);let n=e.getTime()-t.getTime();n<0&&(n+=864e5),u.value=W(n)}}}r&&n()(r).change(se),u&&n()(u).change(re),a.style.display="",C(e)||(t.appendChild(a),S(),n()("html, body").animate({scrollTop:n()(a).offset().top-150},300),n()("#newCompetitor").val(""),M(),A())}function S(){let e=document.getElementById("results").getElementsByTagName("li"),t=1;for(let n=1,a=e.length;n<a;n++){let a=e[n].getElementsByClassName("race-place")[0];e[n].setAttribute("data-place",n.toString());let o=e[n].getAttribute("data-originalScore");"competitorTemplate"!==a.id&&(F(e[n])&&"0"!==o?(a.textContent=t.toString(),e[n].setAttribute("data-place",t.toString()),t++):(a.textContent=O(e[n]),e[n].removeAttribute("data-place")));let l=e[n].getElementsByClassName("code-points")[0];q(e[n])?l.style.display="":(l.style.display="none",l.value="")}}function C(e){let t=document.getElementById("results").getElementsByTagName("li");for(let n=0,a=t.length;n<a;n++)if(t[n].getAttribute("data-competitorId")===e.id.toString())return!0;return!1}let w,E,N;function I(e,t){n()&&e&&t&&t.length>31&&n().getJSON("/api/Competitors",{clubId:e,fleetId:t},(function(e){w=e,M(),n()("#scoreButtonDiv").empty(),n()("#scoreButtonFooter").show(),w.forEach((e=>{let t="btn quick-comp ";C(e)?t+="btn-primary add-comp-disabled":t+="btn-outline-primary add-comp-enabled",n()("#scoreButtonDiv").append('<button class="'+t+'" data-competitorid="'+e.id+'" > '+(e.sailNumber||e.alternativeSailNumber||e.name)+" </button>")}))}))}function T(){let e=document.getElementById("raceNumber");if(null==e)return;let t=n()("#clubId").val(),a=n()("#fleetId").val(),o=n()("#regattaId").val(),l=n()("#date").val();n()&&t&&a&&l&&a.length>=32&&n().getJSON("/api/Races/RaceNumber",{clubId:t,fleetId:a,raceDate:l,regattaId:o},(function(t){e.textContent=t?.order?t.order.toString():""}))}let D,B,R,k,x,L=!1;function M(){E=function(){const e=[];return w.forEach((t=>{if(!C(t)){let n={value:t.name,data:t};t.alternativeSailNumber?n.value=t.sailNumber+" ( "+t.alternativeSailNumber+" ) - "+t.name:t.sailNumber&&(n.value=t.sailNumber+" - "+t.name),e.push(n)}})),e}(),L&&n()("#newCompetitor").autocomplete().dispose(),n()("#newCompetitor").autocomplete({lookup:E,onSelect:function(e){y(e.data)},autoSelectFirst:!0,triggerSelectOnValidInput:!1,noCache:!0}),L=!0}function A(){n()("#scoreButtonDiv").empty(),w.forEach((e=>{let t="btn quick-comp ";C(e)?t+="btn-primary add-comp-disabled":t+="btn-outline-primary add-comp-enabled",n()("#scoreButtonDiv").append('<button class="'+t+'" data-competitorid="'+e.id+'" > '+(e.sailNumber||e.alternativeSailNumber||e.name)+" </button>")}))}function O(e){const t=e.getElementsByClassName("select-code")[0].value;return t===a?null:t}function P(e){const t=e.getElementsByClassName("code-points")[0].value;return t===a?null:t}function F(e){const t=e.getElementsByClassName("select-code")[0].value;return t===a||!!scoreCodes.filter((e=>e.name===t))[0].preserveResult}function q(e){const t=e.getElementsByClassName("select-code")[0].value;return t!==a&&"MAN"===scoreCodes.filter((e=>e.name===t))[0].formula}function $(){n()("#weatherIcon").val("Select..."),n()("#weatherDescription").val(null),n()("#windSpeed").val(null),n()("#windGust").val(null),n()("#windDirection").val(null),n()("#temperature").val(null),n()("#humidity").val(null),n()("#cloudcover").val(null)}function j(e){n().ajax({type:"GET",url:window.speechInfoUrl,dataType:"json",beforeSend:function(e){e.setRequestHeader("Accept","application/json")},success:function(t){X=0,R=t.token,B=t.region,D=t.userLanguage,k=Date.now(),e&&e()},error:function(e,t,a){X++,X<3&&n().ajax(this)}})}function z(){const e=document.getElementById("trackTimesCheckbox");if(!e||!e.checked)return;const t=document.getElementById("StartTime");if(!t||!t.value)return;const a=H(t.value);a&&n()("#results li").each((function(){const e=n()(this).find('input[name="FinishTime"]')[0],t=n()(this).find('input[name="ElapsedTime"]')[0];if(e||t)if(t&&t.value){const n=G(t.value);if(null!==n){let t=new Date(a.getTime()+n);t<a&&(t=new Date(t.getTime()+864e5)),e.value=_(t)}}else if(e&&e.value){let n=H(e.value,a);if(n){n<a&&(n=new Date(n.getTime()+864e5));const o=n.getTime()-a.getTime();t.value=W(o),e.value=_(n)}}}))}function H(e,t){if(!e)return null;const n=e.split(":");if(n.length<2)return null;const a=t?new Date(t):new Date;return a.setSeconds(0,0),a.setHours(parseInt(n[0],10)),a.setMinutes(parseInt(n[1],10)),n.length>2&&a.setSeconds(parseInt(n[2],10)),a}function W(e){const t=Math.floor(e/1e3),n=Math.floor(t/3600),a=Math.floor(t%3600/60),o=t%60;return`${n.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}function G(e){if(!e)return null;const t=e.split(":").map(Number);if(t.some(isNaN))return null;let n=0;if(3===t.length)n=3600*t[0]+60*t[1]+t[2];else if(2===t.length)n=60*t[0]+t[1];else{if(1!==t.length)return null;n=t[0]}return 1e3*n}function _(e){return e.toTimeString().slice(0,8)}!function(){if(document.querySelector("form").onkeypress=o,n()("#fleetId").change(i),""==n()("#defaultRaceDateOffset").val())n()("#date").val("");else if("True"===n()("#needsLocalDate").val()){let a=new Date;const d=new Date(n()("#date").val()),m=new Date(a);m.setDate(a.getDate()+1);const y=new Date(a);if(y.setDate(a.getDate()-1),d>y&&d<m){const C=Number.parseInt(n()("#defaultRaceDateOffset").val(),10);a.setDate(a.getDate()+C),a.setMinutes(a.getMinutes()-a.getTimezoneOffset()),n()("#date").val(a.toISOString().substring(0,10))}n()("#needsLocalDate").val("")}n()("#date").change(s),n()('#results input[name="FinishTime"]').change(se),n()('#results input[name="ElapsedTime"]').change(re),n()("#raceState").data("previous",n()("#raceState").val()),n()("#raceState").change(c),n()(".weather-input").change(r),n()("#results").on("click",".select-code",S),n()("#results").on("click",".move-up",p),n()("#results").on("click",".move-down",f),n()("#results").on("click",".delete-button",v),n()("#scoreButtonDiv").on("click",".add-comp-enabled",b),n()("#deleteConfirmed").click(g),n()("#closefooter").click(h),n()("#compform").submit(u),n()("#raceform").submit((function(e){let t=n()("#ssWaitingModal");t&&t.show(),n()("#submitButton").attr("value","Please wait...");let a=document.getElementById("raceform");n()("#submitButton").attr("disabled","disabled"),function(e){!function(e){n()(e).find("[name^=Scores]").remove()}(e);let t=document.getElementById("results").getElementsByTagName("li");for(let n=1;n<t.length;n++){const a=(n-1).toString();let o=document.createElement("input");o.type="hidden",o.name="Scores["+a+"].competitorId",o.value=t[n].getAttribute("data-competitorId"),e.appendChild(o),o=document.createElement("input"),o.type="hidden",o.name="Scores["+a+"].place",F(t[n])&&(o.value=t[n].getAttribute("data-place")),e.appendChild(o),o=document.createElement("input"),o.type="hidden",o.name="Scores["+a+"].code",o.value=O(t[n]),e.appendChild(o),o=document.createElement("input"),o.type="hidden",o.name="Scores["+a+"].codePointsString",o.value=P(t[n]),e.appendChild(o);let l=t[n].querySelector('input[name="FinishTime"]');l?.value&&(o=document.createElement("input"),o.type="hidden",o.name="Scores["+a+"].FinishTime",o.value=l.value,e.appendChild(o));let i=t[n].querySelector('input[name="ElapsedTime"]');i?.value&&(o=document.createElement("input"),o.type="hidden",o.name="Scores["+a+"].ElapsedTime",o.value=i.value,e.appendChild(o))}}(a)})),n()("#submitButton").prop("disabled",!1),n()("#submitDisabledMessage").prop("hidden",!0),j(null),window.onload=function(){i(),l(),S()};const e=document.getElementById("trackTimesCheckbox");if(e){function w(){!function(e){const t=e?"":"none";n()("#results li").each((function(){n()(this).find('input[name="FinishTime"]').closest("div").css("display",t),n()(this).find('input[name="ElapsedTime"]').closest("div").css("display",t)}))}(e.checked),z()}e.addEventListener("change",w),w()}const t=document.getElementById("StartTime");t&&t.addEventListener("change",(function(){z()}))}();let J,V,K,U,Q,X=0;function Y(e,t){!function(e){switch(console.debug(`(recognized)  Reason: ${J.ResultReason[e.reason]}`),e.reason){case J.ResultReason.NoMatch:let t=J.NoMatchDetails.fromResult(e);console.debug(` NoMatchReason: ${J.NoMatchReason[t.reason]}\r\n`),oe();break;case J.ResultReason.Canceled:let n=J.CancellationDetails.fromResult(e);console.debug(` CancellationReason: ${J.CancellationReason[n.reason]}`),console.debug(n.reason===J.CancellationReason.Error?`: ${n.errorDetails}`:""),oe();break;case J.ResultReason.RecognizedSpeech:e.text&&(V.innerHTML=e.text),e.text&&Z(ee(e.text)+" ")}}(t.result)}function Z(e){let t,a,o,l;console.debug(e),t=w.find((t=>t.sailNumber&&e.startsWith(ee(t.sailNumber)+" "))),t&&(a=ee(t.sailNumber)),t||(t=w.find((t=>t.alternativeSailNumber&&e.startsWith(ee(t.alternativeSailNumber)+" "))),t&&(a=ee(t.alternativeSailNumber))),t||(t=w.find((t=>t.name&&e.startsWith(ee(t.name)+" "))),t&&(a=ee(t.name))),t?(y(t),x=Date.now(),o=e.substr(a.length).trimLeft()):(l=scoreCodes.find((t=>e.startsWith(ee(t.name)+" "))),function(e){n()(".select-code").last().val(e)}(l.name),a=ee(l.name),o=e.substr(a.length).trimLeft()),t||l||!o&&e.indexOf(" ")>-1&&(o=e.substr(e.indexOf(" ")+1).trimLeft()),o.length>0&&Z(o),oe()}function ee(e){return e?e.replace(/[.?,\/#!$%\^&\*;:{}=\-_`~()]/g,"").toUpperCase():null}function te(e,t){console.debug("(sessionStarted)"),K.style.display="none",U.style.display="block",V.innerHTML="Listening"}function ne(e,t){console.debug("(sessionStopped)"),V.innerHTML="",K.style.display="block",U.style.display="none"}function ae(e,t){window.console.log(t),console.debug("(cancel) Reason: "+J.CancellationReason[t.reason]),t.reason===J.CancellationReason.Error&&console.debug(": "+t.errorDetails),oe()}function oe(){x<Date.now()-3e4&&ie()}function le(){if(V.innerHTML="",x=Date.now(),k<Date.now()-3e5)return void j(le);let e=J.AudioConfig.fromDefaultMicrophoneInput(),t=function(e){let t;return R&&(t=e.fromAuthorizationToken(R,B)),t.setProperty(J.SpeechServiceConnection_EndSilenceTimeoutMs,1e3),t.speechRecognitionLanguage=D,t}(J.SpeechConfig);t&&(Q=new J.SpeechRecognizer(t,e),function(e){if(e.recognized=Y,e.canceled=ae,Q.sessionStarted=te,Q.sessionStopped=ne,E){let e=J.PhraseListGrammar.fromRecognizer(Q);for(let t=0;t<w.length;t++)w[t].sailNumber&&e.addPhrase(w[t].sailNumber),w[t].alternativeSailNumber&&e.addPhrase(w[t].alternativeSailNumber),w[t].name&&e.addPhrase(w[t].name);for(let t=0;t<scoreCodes.length;t++)e.addPhrase(scoreCodes[t].name)}}(Q),Q.startContinuousRecognitionAsync())}function ie(){Q.stopContinuousRecognitionAsync((function(){Q.close(),Q=void 0}),(function(e){Q.close(),Q=void 0}))}function se(){const e=this,t=n()(e).closest("li").find('input[name="ElapsedTime"]')[0],a=document.getElementById("StartTime");if(!a||!a.value||!e.value)return;const o=H(a.value),l=H(e.value,o);if(!o||!l)return;let i=l.getTime()-o.getTime();i<0&&(i+=864e5),t.value=W(i)}function re(){const e=this,t=n()(e).closest("li").find('input[name="FinishTime"]')[0],a=document.getElementById("StartTime");if(!a||!a.value||!e.value)return;const o=H(a.value),l=G(e.value);if(!o||null===l)return;const i=new Date(o.getTime()+l);t.value=_(i)}document.addEventListener("DOMContentLoaded",(function(){var e;K=document.getElementById("scenarioStartButton"),U=document.getElementById("scenarioStopButton"),V=document.getElementById("phraseDiv"),U&&U.addEventListener("click",ie),K&&(K.addEventListener("click",le),e=function(e){J=e},window.SpeechSDK&&(document.getElementById("speechwarning").style.display="none",e(window.SpeechSDK)))}))})();
//# sourceMappingURL=raceEditor.min.js.map