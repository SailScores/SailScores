function getInputAtRowColumn(t,e){var a=document.getElementById("allCompetitors"),r='[data-row="'+t+'"]',n=document.querySelectorAll(r);if(!n||0===n.length){if(a.querySelectorAll(".row").length>102)throw alert("Only 100 competitors can be added at a time."),"Too many rows added.";return addNewRow(),getInputAtRowColumn(t,e)}var o=r+'[data-column="'+e+'"]',i=document.querySelectorAll(o);if(!i||i.length<1)throw"Problem finding input.";return i[0]}function addNewRow(){var t=0,e=document.getElementById("allCompetitors"),a=document.getElementById("compRowTemplate").cloneNode(!0);(t=e.querySelectorAll(".row").length-2)<0&&(t=0);var r="competitors["+t+"].",n=a.querySelectorAll('input[name="template.SailNumber"]')[0];n.name=r+"SailNumber",n.dataset.column=0,n.dataset.row=t;var o=a.querySelectorAll('input[name="template.Name"]')[0];o.name=r+"Name",o.dataset.column=1,o.dataset.row=t;var i=a.querySelectorAll('input[name="template.BoatName"]')[0];i.name=r+"BoatName",i.dataset.column=2,i.dataset.row=t;var l=a.querySelectorAll('input[name="template.HomeClubName"]')[0];l.name=r+"HomeClubName",l.dataset.column=3,l.dataset.row=t,a.style.display="",e.appendChild(a),n.focus()}!function(){document.getElementsByName("competitors[0].Name")[0];document.getElementById("allCompetitors").onpaste=function(t){for(var e=t.clipboardData.getData("text/plain").split(String.fromCharCode(13)),a=0;a<e.length;a++)e[a]=e[a].split(String.fromCharCode(9));if(1!==e.length||1!==e[0].length){t.preventDefault();var r=Number(t.target.dataset.column)||0,n=Number(t.target.dataset.row)||0;for(a=0;a<e.length;a++)for(var o=0;o<e[a].length;o++)r+o<4&&(getInputAtRowColumn(n+a,r+o).value=e[a][o]);t.stopPropagation(),t.preventDefault()}}}();var SailScores=function(t){var e={};function a(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=t,a.c=e,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},a.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/js/",a(a.s=0)}([function(t,e,a){"use strict";a.r(e),a.d(e,"init",(function(){return o})),a.d(e,"loadSeriesOptions",(function(){return i})),a.d(e,"loadFleet",(function(){return l})),a.d(e,"raceStateChanged",(function(){return c})),a.d(e,"completeCompCreate",(function(){return d})),a.d(e,"completeCompCreateFailed",(function(){return s})),a.d(e,"hideAlert",(function(){return p})),a.d(e,"moveUp",(function(){return u})),a.d(e,"moveDown",(function(){return m})),a.d(e,"deleteResult",(function(){return g})),a.d(e,"confirmDelete",(function(){return h})),a.d(e,"hideScoreButtonFooter",(function(){return f})),a.d(e,"addNewCompetitorById",(function(){return v})),a.d(e,"calculatePlaces",(function(){return w}));const r="No Code";function n(t){const e=t||event;return/textarea/i.test(e.srcElement.tagName)||13!==(t.keyCode||t.which||t.charCode||0)}function o(){document.querySelector("form").onkeypress=n,$("#raceform").submit((function(t){t.preventDefault(),function(t){for(var e=document.getElementById("results").getElementsByTagName("li"),a=1;a<e.length;a++){const n=(a-1).toString();var r=document.createElement("input");r.type="hidden",r.name="Scores["+n+"].competitorId",r.value=e[a].getAttribute("data-competitorId"),t.appendChild(r),(r=document.createElement("input")).type="hidden",r.name="Scores["+n+"].place",D(e[a])&&(r.value=e[a].getAttribute("data-place")),t.appendChild(r),(r=document.createElement("input")).type="hidden",r.name="Scores["+n+"].code",r.value=E(e[a]),t.appendChild(r),(r=document.createElement("input")).type="hidden",r.name="Scores["+n+"].codePointsString",r.value=B(e[a]),t.appendChild(r)}}(this),this.submit(),function(t){t.find("[name^=Scores]").remove()}(this)})),l(),i(),w(),$("#submitButton").prop("disabled",!1),$("#submitDisabledMessage").prop("hidden",!0)}function i(){!function(t,e){t&&e&&$.getJSON("/api/Series",{clubId:t,date:e},(function(t){x=t,function(){let t=$("#seriesIds");var e=t.val();t.empty(),$.each(x,(function(e,a){let r=a;t.append($("<option></option>").attr("value",r.id.toString()).text(r.name))})),t.selectpicker("destroy"),t.selectpicker(),t.val(e),t.selectpicker("refresh")}()}))}($("#clubId").val(),$("#date").val())}function l(){let t=$("#clubId").val(),e=$("#fleetId").val(),a=document.getElementById("fleetId"),r=a.options[a.selectedIndex].getAttribute("data-boat-class-id");r&&$("#createCompBoatClassSelect").val(r),$("#createCompFleetId").val(e),b(t,e)}function c(){let t=$("#raceState").val();"2"===t&&($("#weatherIcon").val("Select..."),$("#weatherIcon").selectpicker("refresh"),$("#weatherDescription").val(null),$("#windSpeed").val(null),$("#windGust").val(null),$("#windDirection").val(null),$("#temperature").val(null),$("#humidity").val(null),$("#cloudcover").val(null)),"1"===t&&function(){var t=$("#clubInitials").val();$.getJSON("/"+t+"/weather/current/",{},(function(t){console.log(t),t.icon&&$("#weatherIcon").val(null)&&($("#weatherIcon").val(t.icon),$("#weatherIcon").selectpicker("refresh")),t.description&&$("#weatherDescription").val(null)&&$("#weatherDescription").val(t.description),t.windSpeed&&$("#windSpeed").val(null)&&$("#windSpeed").val(t.windSpeed),t.windGust&&$("#windGust").val(null)&&$("#windGust").val(t.windGust),t.windDirection&&$("#windDirection").val(null)&&$("#windDirection").val(t.windDirection),t.temperature&&$("#temperature").val(null)&&$("#temperature").val(t.temperature),t.humidity&&$("#humidity").val(null)&&$("#humidity").val(t.humidity),t.cloudCoverPercent&&$("#cloudCover").val(null)&&$("#cloudCover").val(t.cloudCoverPercent)}))}()}function d(){b($("#clubId").val(),$("#fleetId").val()),$("#createCompetitor").modal("hide")}function s(){$("#compCreateAlert").show()}function p(){$("#compCreateAlert").hide()}function u(){var t=event.target,e=$(t).closest("li");e.prev().insertAfter(e),w()}function m(){var t=event.target,e=$(t).closest("li");e.next().insertBefore(e),w()}function g(){var t=$("#deleteConfirm"),e=t.find("#compIdToDelete").val();$("#results").find(`[data-competitorid='${e}']`).remove(),w(),t.modal("hide")}function h(){var t=event.target,e=$(t).closest("li"),a=e.data("competitorid"),r=e.find(".competitor-name").text(),n=$("#deleteConfirm");n.find("#competitorNameToDelete").text(r),n.find("#compIdToDelete").val(a),n.show()}function f(){$("#scoreButtonFooter").hide()}function v(t){y(I.find(e=>e.id===t))}function y(t){var e=document.getElementById("results"),a=document.getElementById("competitorTemplate").cloneNode(!0);a.id=t.id.toString(),a.setAttribute("data-competitorId",t.id.toString());var r=a.getElementsByClassName("competitor-name")[0];r.appendChild(document.createTextNode(t.name)),(r=a.getElementsByClassName("sail-number")[0]).appendChild(document.createTextNode(t.sailNumber)),t.alternativeSailNumber&&((r=a.getElementsByClassName("alt-sail-number")[0]).appendChild(document.createTextNode(" ("+t.alternativeSailNumber+")")),r.style.display=""),(r=a.getElementsByClassName("race-place")[0]).appendChild(document.createTextNode((0).toString()));for(var n=a.getElementsByClassName("delete-button"),o=0;o<n.length;o++)n[o].setAttribute("data-competitorId",t.id.toString());a.style.display="",e.appendChild(a),w(),$("html, body").animate({scrollTop:$(a).offset().top-150},300),$("#newCompetitor").val(""),A(),$("#scoreButtonDiv").empty(),I.forEach(t=>{let e="btn ",a="";C(t)?e+="btn-primary":(e+="btn-outline-primary",a="window.SailScores.addNewCompetitorById('"+t.id+"')"),$("#scoreButtonDiv").append('<button class="'+e+' data-id="'+t.id+'" onclick="'+a+'" > '+(t.sailNumber||t.alternativeSailNumber)+" </button>")})}function w(){for(var t=document.getElementById("results").getElementsByTagName("li"),e=1,a=1,r=t.length;a<r;a++){var n=t[a].getElementsByClassName("race-place")[0];t[a].setAttribute("data-place",a.toString());var o=t[a].getAttribute("data-originalScore");"competitorTemplate"!=n.id&&(D(t[a])&&"0"!==o?(n.textContent=e.toString(),t[a].setAttribute("data-place",e.toString()),e++):(n.textContent=E(t[a]),t[a].removeAttribute("data-place")));var i=t[a].getElementsByClassName("code-points")[0];k(t[a])?i.style.display="":(i.style.display="none",i.value="")}}function C(t){for(var e=document.getElementById("results").getElementsByTagName("li"),a=0,r=e.length;a<r;a++)if(e[a].getAttribute("data-competitorId")===t.id.toString())return!0;return!1}var I,S,x;function b(t,e){t&&e&&$.getJSON("/api/Competitors",{clubId:t,fleetId:e},(function(t){I=t,A(),$("#scoreButtonDiv").empty(),I&&I.length&&I.length<21?$("#scoreButtonFooter").show():$("#scoreButtonFooter").hide(),I.forEach(t=>{let e="btn ",a="";C(t)?e+="btn-primary":(e+="btn-outline-primary",a="window.SailScores.addNewCompetitorById('"+t.id+"')"),$("#scoreButtonDiv").append('<button class="'+e+' data-id="'+t.id+'" onclick="'+a+'" > '+(t.sailNumber||t.alternativeSailNumber)+" </button>")})}))}var N=!1;function A(){S=function(){const t=[];return console.debug("checking for comps in results"),I.forEach(e=>{if(!C(e)){let a={value:e.sailNumber+" - "+e.name,data:e};e.alternativeSailNumber&&(a.value=e.sailNumber+" ( "+e.alternativeSailNumber+" ) - "+e.name),t.push(a)}}),t}(),N&&$("#newCompetitor").autocomplete().dispose(),$("#newCompetitor").autocomplete({lookup:S,onSelect:function(t){y(t.data)},autoSelectFirst:!0,triggerSelectOnValidInput:!1,noCache:!0}),N=!0}function E(t){const e=t.getElementsByClassName("select-code")[0].value;return e===r?null:e}function B(t){const e=t.getElementsByClassName("code-points")[0].value;return e===r?null:e}function D(t){const e=t.getElementsByClassName("select-code")[0].value;return e===r||!!scoreCodes.filter(t=>t.name===e)[0].preserveResult}function k(t){const e=t.getElementsByClassName("select-code")[0].value;return e!==r&&"MAN"==scoreCodes.filter(t=>t.name===e)[0].formula}}]),seriesChart=(SailScores=function(t){var e={};function a(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=t,a.c=e,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},a.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/js/",a(a.s=0)}([function(t,e){function a(t,e){var a=e.races.find(e=>e.id===t.raceId),r=e.races.filter(t=>t.date===a.date);if(1===a.length)return new Date(a.date);var n=r.findIndex(t=>t.id===a.id);return new Date(new Date(a.date).getTime()+24*n*60*60*1e3/r.length)}function r(t,e){var a=Math.max(...e.entries.filter(e=>e.raceId===t.raceId).map(t=>t.seriesPoints)),r=Math.min(...e.entries.filter(e=>e.raceId===t.raceId&&0!==e.seriesPoints).map(t=>t.seriesPoints)),n=(t.seriesPoints-r)/(a-r);return 0===t.seriesPoints&&(n=1),margin+n*(chartOverallHeight-margin-margin)}function n(t){var e=d3.select(t.node().parentNode),a=parseInt(t.style("width")),r=parseInt(t.style("height")),n=a/r;function o(){var a=parseInt(e.style("width"));t.attr("width",a),t.attr("height",Math.round(a/n))}t.attr("viewBox","0 0 "+a+" "+r).attr("perserveAspectRatio","xMinYMid").call(o),d3.select(window).on("resize."+e.attr("id"),o)}chartOverallWidth=960,chartOverallHeight=600,margin=30,legendWidth=150,legendLineHeight=16,legendMargin=2,d3.json("chartdata2.json").then((function(t){var e=t.races.map(t=>new Date(t.date)),o=Math.min.apply(null,e),i=Math.max.apply(null,e),l=d3.scaleTime().domain([o,i]).range([margin,chartOverallWidth-margin-legendWidth]),c=d3.scaleOrdinal(d3.schemeDark2);chartOverallHeight=t.competitors.length*legendLineHeight+margin;var d=d3.select("#chart").attr("width",chartOverallWidth).attr("height",chartOverallHeight).call(n);function s(t){compId=t.competitorId||t.id,d.selectAll("path.compLine").attr("opacity",.4),d.selectAll("path[data-compId='"+compId+"']").attr("stroke-width",4).attr("opacity",1),d.selectAll("g.legendEntry").attr("opacity",.4),d.selectAll("g.legendEntry[data-compId='"+compId+"']").attr("opacity",1),d.selectAll("g.legendEntry[data-compId='"+compId+"'] rect").attr("stroke",t=>c(t.id)),d.selectAll("circle").attr("opacity",.4),d.selectAll("circle[data-compId='"+compId+"']").attr("opacity",1)}function p(t){d.selectAll("path.compLine").attr("stroke-width",1.5),d.selectAll("path.compLine").attr("opacity",1),d.selectAll("g.legendEntry rect").attr("stroke","none"),tooltipGroup.attr("opacity",0).attr("transform","translate("+chartOverallWidth+","+chartOverallHeight+")"),d.selectAll("path.compLine").attr("opacity",1),d.selectAll("g.legendEntry").attr("opacity",1),d.selectAll("circle").attr("opacity",1)}var u=d3.select("#chart").selectAll("g.legendEntry").attr("transform","translate("+(chartOverallWidth-legendWidth)+","+(margin+legendMargin)+")").data(t.competitors).enter().append("g").attr("class","legendEntry").attr("data-compId",t=>t.id).attr("transform",(function(t,e){return"translate("+(chartOverallWidth-legendWidth)+","+(e*legendLineHeight+legendMargin)+")"})).attr("opacity",1).on("mouseover",s).on("mouseout",p);u.append("rect").attr("width",legendWidth-1).attr("height",legendLineHeight).attr("fill","none").attr("stroke-width",2),u.append("rect").attr("width",20-legendMargin).attr("height",legendLineHeight-2*legendMargin).attr("x",legendMargin).attr("y",legendMargin).style("fill",t=>c(t.id)).style("stroke-width",0),u.append("text").attr("x",20+legendMargin).attr("y",legendLineHeight-4).style("font-size","11px").style("font-family","sans-serif").text((function(t){return t.name}));var m=d3.axisTop().scale(l);d3.select("#chart").append("g").attr("id","xAxisG").attr("transform","translate(0,20)").call(m),lineData=d3.line().x(e=>l(a(e,t))).y(e=>r(e,t)),d.selectAll("path.compLine").data(t.competitors).enter().append("path").attr("class","compLine").attr("d",e=>lineData(t.entries.filter(t=>t.competitorId===e.id))).attr("fill","none").attr("opacity",1).attr("stroke",t=>c(t.id)).attr("stroke-width",1).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("data-compId",t=>t.id).on("mouseover",s).on("mouseout",p),d.selectAll("circle").data(t.entries).enter().append("circle").attr("r",3).attr("cy",e=>r(e,t)).attr("cx",e=>l(a(e,t))).attr("data-compId",t=>t.competitorId).attr("fill",t=>c(t.competitorId)).on("mouseover",(function(e){tooltipGroup.attr("transform","translate("+l(a(e,t))+","+(r(e,t)-legendLineHeight)+")").attr("opacity",1).select("text").selectAll("*").remove(),tooltipGroup.select("text").append("tspan").text("Race place: "+e.racePlace),tooltipGroup.select("text").append("tspan").attr("x",5).attr("y",2*legendLineHeight-5).text("Series points: "+e.seriesPoints),s(e)})).on("mouseout",p),tooltipGroup=d.append("g").attr("opacity",0),tooltipGroup.append("rect").attr("width",120).attr("height",2*legendLineHeight).attr("fill","white").attr("fill-opacity",".7"),tooltipGroup.append("text").attr("x",5).attr("y",legendLineHeight-5).style("font-size","11px").style("font-family","sans-serif")}))}]),function(){var t,e,a,r=600;function n(t,e){var a=e.races.find(e=>e.id===t.raceId),r=e.races.filter(t=>t.date===a.date),n=r.findIndex(t=>t.id===a.id)+1;return new Date(new Date(a.date).getTime()+24*n*60*60*1e3/(r.length+1))}function o(t,e){var a=Math.max(...e.entries.filter(e=>e.raceId===t.raceId).map(t=>t.seriesPoints)),n=Math.min(...e.entries.filter(e=>e.raceId===t.raceId&&0!==e.seriesPoints).map(t=>t.seriesPoints)),o=(t.seriesPoints-n)/(a-n);return isNaN(o)&&(o=0),0===t.seriesPoints&&(o=1),30+o*(r-30-30)}function i(t){var e=d3.select(t.node().parentNode),a=parseInt(t.style("width")),r=parseInt(t.style("height")),n=a/r;function o(){var r=parseInt(e.style("width"));r<=100&&(r=a),t.attr("width",r),t.attr("height",Math.round(r/n))}t.attr("viewBox","0 0 "+a+" "+r).attr("perserveAspectRatio","xMinYMid").call(o),d3.select(window).on("resize."+e.attr("id"),o)}function l(l){if(null!==l){var c=l.races.map(t=>new Date(t.date));e=new Date(Math.min.apply(null,c)),(a=new Date(Math.max.apply(null,c))).setDate(a.getDate()+1);var d=d3.scaleTime().domain([e,a]).range([30,780]),s=d3.scaleOrdinal(d3.schemeDark2);r=16*l.competitors.length+60;var p=d3.select(t).attr("width",960).attr("height",r).call(i),u=d3.select(t).selectAll("g.legendEntry").attr("transform","translate(810,32)").data(l.competitors).enter().append("g").attr("class","legendEntry").attr("data-compId",t=>t.id).attr("transform",(function(t,e){return"translate(810,"+(16*e+2+20)+")"})).attr("opacity",1).on("mouseover",h).on("mouseout",f);u.append("rect").attr("width",149).attr("height",16).attr("fill","none").attr("stroke-width",2),u.append("rect").attr("width",18).attr("height",12).attr("x",2).attr("y",2).style("fill",t=>s(t.id)).style("stroke-width",0),u.append("text").attr("x",22).attr("y",12).style("font-size","11px").text((function(t){return t.name}));var m=d3.axisTop().scale(d),g=d3.select("html").attr("lang").substring(0,2);(e-a<864e6||"en"!==g)&&(m=m.tickFormat("")),p.append("g").attr("id","xAxisG").attr("transform","translate(0,20)").call(m),lineData=d3.line().x(t=>d(n(t,l))).y(t=>o(t,l)),p.selectAll("path.compLine").data(l.competitors).enter().append("path").attr("class","compLine").attr("d",t=>lineData(l.entries.filter(e=>e.competitorId===t.id))).attr("fill","none").attr("opacity",1).attr("stroke",t=>s(t.id)).attr("stroke-width",1).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("data-compId",t=>t.id).on("mouseover",h).on("mouseout",f),p.selectAll("circle").data(l.entries).enter().append("circle").attr("r",3).attr("cy",t=>o(t,l)).attr("cx",t=>d(n(t,l))).attr("data-compId",t=>t.competitorId).attr("fill",t=>s(t.competitorId)).on("mouseover",(function(t){var e;tooltipGroup.attr("transform","translate("+d(n(t,l))+","+(o(t,l)-16)+")").attr("opacity",1).select("text").selectAll("*").remove(),tooltipGroup.select("text").append("tspan").text((e=t.raceId,l.races.find(t=>t.id===e).shortName)),tooltipGroup.select("text").append("tspan").attr("x",5).attr("y",27).text("Place: "+t.racePlace),tooltipGroup.select("text").append("tspan").attr("x",5).attr("y",43).text("Series points: "+t.seriesPoints),h(t)})).on("mouseout",f),tooltipGroup=p.append("g").attr("opacity",0),tooltipGroup.append("rect").attr("width",120).attr("height",48).attr("fill","white").attr("fill-opacity",".7"),tooltipGroup.append("text").attr("x",5).attr("y",11).style("font-size","11px")}function h(t){compId=t.competitorId||t.id,p.selectAll("path.compLine").attr("opacity",.4),p.selectAll("path[data-compId='"+compId+"']").attr("stroke-width",4).attr("opacity",1),p.selectAll("g.legendEntry").attr("opacity",.4),p.selectAll("g.legendEntry[data-compId='"+compId+"']").attr("opacity",1),p.selectAll("g.legendEntry[data-compId='"+compId+"'] rect").attr("stroke",t=>s(t.id)),p.selectAll("circle").attr("opacity",.4),p.selectAll("circle[data-compId='"+compId+"']").attr("opacity",1)}function f(t){p.selectAll("path.compLine").attr("stroke-width",1.5),p.selectAll("path.compLine").attr("opacity",1),p.selectAll("g.legendEntry rect").attr("stroke","none"),tooltipGroup.attr("opacity",0).attr("transform","translate(960,"+r+")"),p.selectAll("path.compLine").attr("opacity",1),p.selectAll("g.legendEntry").attr("opacity",1),p.selectAll("circle").attr("opacity",1)}}return{drawChart:function(e,a){e,t=a;var r="/series/chart?seriesId="+e;d3.json(r).then(l)}}});export class Guid{constructor(t){this.guid=t,this._guid=t}ToString(){return this.guid}static MakeNew(){var t,e;for(t="",e=0;e<32;e++)8!=e&&12!=e&&16!=e&&20!=e||(t+="-"),t+=Math.floor(16*Math.random()).toString(16).toUpperCase();return new Guid(t)}}import $ from"jquery";import"bootstrap";import"bootstrap-select";const noCodeString="No Code";function checkEnter(t){const e=t||event;return/textarea/i.test(e.srcElement.tagName)||13!==(t.keyCode||t.which||t.charCode||0)}export function init(){document.querySelector("form").onkeypress=checkEnter,$("#raceform").submit((function(t){t.preventDefault();addScoresFieldsToForm(this),this.submit(),removeScoresFieldsFromForm(this)})),loadFleet(),loadSeriesOptions(),calculatePlaces(),$("#submitButton").prop("disabled",!1),$("#submitDisabledMessage").prop("hidden",!0)}export function loadSeriesOptions(){getSeries($("#clubId").val(),$("#date").val())}export function loadFleet(){let t=$("#clubId").val(),e=$("#fleetId").val(),a=document.getElementById("fleetId"),r=a.options[a.selectedIndex].getAttribute("data-boat-class-id");r&&$("#createCompBoatClassSelect").val(r),$("#createCompFleetId").val(e),getCompetitors(t,e)}export function raceStateChanged(){let t=$("#raceState").val();"2"===t&&clearWeatherFields(),"1"===t&&populateEmptyWeatherFields()}export function completeCompCreate(){getCompetitors($("#clubId").val(),$("#fleetId").val()),$("#createCompetitor").modal("hide")}export function completeCompCreateFailed(){$("#compCreateAlert").show()}export function hideAlert(){$("#compCreateAlert").hide()}export function moveUp(){var t=event.target,e=$(t).closest("li");e.prev().insertAfter(e),calculatePlaces()}export function moveDown(){var t=event.target,e=$(t).closest("li");e.next().insertBefore(e),calculatePlaces()}export function deleteResult(){var t=$("#deleteConfirm"),e=t.find("#compIdToDelete").val();$("#results").find(`[data-competitorid='${e}']`).remove(),calculatePlaces(),t.modal("hide")}export function confirmDelete(){var t=event.target,e=$(t).closest("li"),a=e.data("competitorid"),r=e.find(".competitor-name").text(),n=$("#deleteConfirm");n.find("#competitorNameToDelete").text(r),n.find("#compIdToDelete").val(a),n.show()}export function hideScoreButtonFooter(){$("#scoreButtonFooter").hide()}export function addNewCompetitorById(t){addNewCompetitor(allCompetitors.find(e=>e.id===t))}function addNewCompetitor(t){var e=document.getElementById("results"),a=document.getElementById("competitorTemplate").cloneNode(!0);a.id=t.id.toString(),a.setAttribute("data-competitorId",t.id.toString());var r=a.getElementsByClassName("competitor-name")[0];r.appendChild(document.createTextNode(t.name)),(r=a.getElementsByClassName("sail-number")[0]).appendChild(document.createTextNode(t.sailNumber)),t.alternativeSailNumber&&((r=a.getElementsByClassName("alt-sail-number")[0]).appendChild(document.createTextNode(" ("+t.alternativeSailNumber+")")),r.style.display=""),(r=a.getElementsByClassName("race-place")[0]).appendChild(document.createTextNode((0).toString()));for(var n=a.getElementsByClassName("delete-button"),o=0;o<n.length;o++)n[o].setAttribute("data-competitorId",t.id.toString());a.style.display="",e.appendChild(a),calculatePlaces(),$("html, body").animate({scrollTop:$(a).offset().top-150},300),$("#newCompetitor").val(""),initializeAutoComplete(),updateButtonFooter()}function addScoresFieldsToForm(t){for(var e=document.getElementById("results").getElementsByTagName("li"),a=1;a<e.length;a++){const n=(a-1).toString();var r=document.createElement("input");r.type="hidden",r.name="Scores["+n+"].competitorId",r.value=e[a].getAttribute("data-competitorId"),t.appendChild(r),(r=document.createElement("input")).type="hidden",r.name="Scores["+n+"].place",shouldCompKeepScore(e[a])&&(r.value=e[a].getAttribute("data-place")),t.appendChild(r),(r=document.createElement("input")).type="hidden",r.name="Scores["+n+"].code",r.value=getCompetitorCode(e[a]),t.appendChild(r),(r=document.createElement("input")).type="hidden",r.name="Scores["+n+"].codePointsString",r.value=getCompetitorCodePoints(e[a]),t.appendChild(r)}}function removeScoresFieldsFromForm(t){t.find("[name^=Scores]").remove()}export function calculatePlaces(){for(var t=document.getElementById("results").getElementsByTagName("li"),e=1,a=1,r=t.length;a<r;a++){var n=t[a].getElementsByClassName("race-place")[0];t[a].setAttribute("data-place",a.toString());var o=t[a].getAttribute("data-originalScore");"competitorTemplate"!==n.id&&(shouldCompKeepScore(t[a])&&"0"!==o?(n.textContent=e.toString(),t[a].setAttribute("data-place",e.toString()),e++):(n.textContent=getCompetitorCode(t[a]),t[a].removeAttribute("data-place")));var i=t[a].getElementsByClassName("code-points")[0];shouldHaveManualEntry(t[a])?i.style.display="":(i.style.display="none",i.value="")}}function competitorIsInResults(t){for(var e=document.getElementById("results").getElementsByTagName("li"),a=0,r=e.length;a<r;a++)if(e[a].getAttribute("data-competitorId")===t.id.toString())return!0;return!1}function getSuggestions(){const t=[];return console.debug("checking for comps in results"),allCompetitors.forEach(e=>{if(!competitorIsInResults(e)){let a={value:e.sailNumber+" - "+e.name,data:e};e.alternativeSailNumber&&(a.value=e.sailNumber+" ( "+e.alternativeSailNumber+" ) - "+e.name),t.push(a)}}),t}var allCompetitors,competitorSuggestions,seriesOptions;function getCompetitors(t,e){t&&e&&$.getJSON("/api/Competitors",{clubId:t,fleetId:e},(function(t){allCompetitors=t,initializeAutoComplete(),initializeButtonFooter()}))}function getSeries(t,e){t&&e&&$.getJSON("/api/Series",{clubId:t,date:e},(function(t){seriesOptions=t,setSeries()}))}function setSeries(){let t=$("#seriesIds");var e=t.val();t.empty(),$.each(seriesOptions,(function(e,a){let r=a;t.append($("<option></option>").attr("value",r.id.toString()).text(r.name))})),t.selectpicker("destroy"),t.selectpicker(),t.val(e),t.selectpicker("refresh")}var autoCompleteSetup=!1;function initializeAutoComplete(){competitorSuggestions=getSuggestions(),autoCompleteSetup&&$("#newCompetitor").autocomplete().dispose(),$("#newCompetitor").autocomplete({lookup:competitorSuggestions,onSelect:function(t){addNewCompetitor(t.data)},autoSelectFirst:!0,triggerSelectOnValidInput:!1,noCache:!0}),autoCompleteSetup=!0}function initializeButtonFooter(){$("#scoreButtonDiv").empty(),allCompetitors&&allCompetitors.length&&allCompetitors.length<21?$("#scoreButtonFooter").show():$("#scoreButtonFooter").hide(),allCompetitors.forEach(t=>{let e="btn ",a="";competitorIsInResults(t)?e+="btn-primary":(e+="btn-outline-primary",a="window.SailScores.addNewCompetitorById('"+t.id+"')"),$("#scoreButtonDiv").append('<button class="'+e+' data-id="'+t.id+'" onclick="'+a+'" > '+(t.sailNumber||t.alternativeSailNumber)+" </button>")})}function updateButtonFooter(){$("#scoreButtonDiv").empty(),allCompetitors.forEach(t=>{let e="btn ",a="";competitorIsInResults(t)?e+="btn-primary":(e+="btn-outline-primary",a="window.SailScores.addNewCompetitorById('"+t.id+"')"),$("#scoreButtonDiv").append('<button class="'+e+' data-id="'+t.id+'" onclick="'+a+'" > '+(t.sailNumber||t.alternativeSailNumber)+" </button>")})}function getCompetitorCode(t){const e=t.getElementsByClassName("select-code")[0].value;return"No Code"===e?null:e}function getCompetitorCodePoints(t){const e=t.getElementsByClassName("code-points")[0].value;return"No Code"===e?null:e}function shouldCompKeepScore(t){const e=t.getElementsByClassName("select-code")[0].value;return"No Code"===e||!!scoreCodes.filter(t=>t.name===e)[0].preserveResult}function shouldHaveManualEntry(t){const e=t.getElementsByClassName("select-code")[0].value;return"No Code"!==e&&"MAN"===scoreCodes.filter(t=>t.name===e)[0].formula}function clearWeatherFields(){$("#weatherIcon").val("Select..."),$("#weatherIcon").selectpicker("refresh"),$("#weatherDescription").val(null),$("#windSpeed").val(null),$("#windGust").val(null),$("#windDirection").val(null),$("#temperature").val(null),$("#humidity").val(null),$("#cloudcover").val(null)}function populateEmptyWeatherFields(){var t=$("#clubInitials").val();$.getJSON("/"+t+"/weather/current/",{},(function(t){console.log(t),t.icon&&$("#weatherIcon").val(null)&&($("#weatherIcon").val(t.icon),$("#weatherIcon").selectpicker("refresh")),t.description&&$("#weatherDescription").val(null)&&$("#weatherDescription").val(t.description),t.windSpeed&&$("#windSpeed").val(null)&&$("#windSpeed").val(t.windSpeed),t.windGust&&$("#windGust").val(null)&&$("#windGust").val(t.windGust),t.windDirection&&$("#windDirection").val(null)&&$("#windDirection").val(t.windDirection),t.temperature&&$("#temperature").val(null)&&$("#temperature").val(t.temperature),t.humidity&&$("#humidity").val(null)&&$("#humidity").val(t.humidity),t.cloudCoverPercent&&$("#cloudCover").val(null)&&$("#cloudCover").val(t.cloudCoverPercent)}))}import*as d3 from"d3";import*as d3axis from"d3-axis";let chartOverallWidth=960,chartOverallHeight=600,margin=30,legendWidth=150,legendLineHeight=16,legendMargin=2;function getDate(t,e){var a=e.races.find(e=>e.id===t.raceId),r=e.races.filter(t=>t.date===a.date);if(1===a.length)return new Date(a.date);var n=r.findIndex(t=>t.id==a.id);return new Date(new Date(a.date).getTime()+24*n*60*60*1e3/r.length)}function getY(t,e){var a=Math.max(...e.entries.filter(e=>e.raceId===t.raceId).map(t=>t.seriesPoints)),r=Math.min(...e.entries.filter(e=>e.raceId===t.raceId&&0!==e.seriesPoints).map(t=>t.seriesPoints)),n=(t.seriesPoints-r)/(a-r);return 0===t.seriesPoints&&(n=1),margin+n*(chartOverallHeight-margin-margin)}d3.json("chartdata2.json").then(processChartData);const unique=(t,e,a)=>a.indexOf(t)===e;function responsivefy(t){var e=d3.select(t.node().parentNode),a=parseInt(t.style("width")),r=parseInt(t.style("height")),n=a/r;function o(){var a=parseInt(e.style("width"));t.attr("width",a),t.attr("height",Math.round(a/n))}t.attr("viewBox","0 0 "+a+" "+r).attr("perserveAspectRatio","xMinYMid").call(o),d3.select(window).on("resize."+e.attr("id"),o)}function getCompName(t,e){return e.find(e=>e.id===t).name}function processChartData(t){var e=t.races.map(t=>new Date(t.date)),a=Math.min.apply(null,e),r=Math.max.apply(null,e),n=d3.scaleTime().domain([a,r]).range([margin,chartOverallWidth-margin-legendWidth]),o=d3.scaleOrdinal(d3.schemeDark2);chartOverallHeight=t.competitors.length*legendLineHeight+margin;var i=d3.select("#chart").attr("width",chartOverallWidth).attr("height",chartOverallHeight).call(responsivefy);function l(t){let e=t.competitorId||t.id;i.selectAll("path.compLine").attr("opacity",.4),i.selectAll("path[data-compId='"+e+"']").attr("stroke-width",4).attr("opacity",1),i.selectAll("g.legendEntry").attr("opacity",.4),i.selectAll("g.legendEntry[data-compId='"+e+"']").attr("opacity",1),i.selectAll("g.legendEntry[data-compId='"+e+"'] rect").attr("stroke",t=>o(t.id)),i.selectAll("circle").attr("opacity",.4),i.selectAll("circle[data-compId='"+e+"']").attr("opacity",1)}function c(t){i.selectAll("path.compLine").attr("stroke-width",1.5),i.selectAll("path.compLine").attr("opacity",1),i.selectAll("g.legendEntry rect").attr("stroke","none"),u.attr("opacity",0).attr("transform","translate("+chartOverallWidth+","+chartOverallHeight+")"),i.selectAll("path.compLine").attr("opacity",1),i.selectAll("g.legendEntry").attr("opacity",1),i.selectAll("circle").attr("opacity",1)}var d=d3.select("#chart").selectAll("g.legendEntry").attr("transform","translate("+(chartOverallWidth-legendWidth)+","+(margin+legendMargin)+")").data(t.competitors).enter().append("g").attr("class","legendEntry").attr("data-compId",t=>t.id).attr("transform",(function(t,e){return"translate("+(chartOverallWidth-legendWidth)+","+(e*legendLineHeight+legendMargin)+")"})).attr("opacity",1).on("mouseover",l).on("mouseout",c);d.append("rect").attr("width",legendWidth-1).attr("height",legendLineHeight).attr("fill","none").attr("stroke-width",2),d.append("rect").attr("width",20-legendMargin).attr("height",legendLineHeight-2*legendMargin).attr("x",legendMargin).attr("y",legendMargin).style("fill",t=>o(t.id)).style("stroke-width",0),d.append("text").attr("x",20+legendMargin).attr("y",legendLineHeight-4).style("font-size","11px").style("font-family","sans-serif").text((function(t){return t.name}));var s=d3axis.axisTop(n);d3.select("#chart").append("g").attr("id","xAxisG").attr("transform","translate(0,20)").call(s);let p=d3.line().x(e=>n(getDate(e,t))).y(e=>getY(e,t));i.selectAll("path.compLine").data(t.competitors).enter().append("path").attr("class","compLine").attr("d",e=>p(t.entries.filter(t=>t.competitorId===e.id))).attr("fill","none").attr("opacity",1).attr("stroke",t=>o(t.id)).attr("stroke-width",1).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("data-compId",t=>t.id).on("mouseover",l).on("mouseout",c),i.selectAll("circle").data(t.entries).enter().append("circle").attr("r",3).attr("cy",e=>getY(e,t)).attr("cx",e=>n(getDate(e,t))).attr("data-compId",t=>t.competitorId).attr("fill",t=>o(t.competitorId)).on("mouseover",(function(e){u.attr("transform","translate("+n(getDate(e,t))+","+(getY(e,t)-legendLineHeight)+")").attr("opacity",1).select("text").selectAll("*").remove(),u.select("text").append("tspan").text("Race place: "+e.racePlace),u.select("text").append("tspan").attr("x",5).attr("y",2*legendLineHeight-5).text("Series points: "+e.seriesPoints),l(e)})).on("mouseout",c);let u=i.append("g").attr("opacity",0);u.append("rect").attr("width",120).attr("height",2*legendLineHeight).attr("fill","white").attr("fill-opacity",".7"),u.append("text").attr("x",5).attr("y",legendLineHeight-5).style("font-size","11px").style("font-family","sans-serif")}