"use strict";function getInputAtRowColumn(e,t){var r=document.getElementById("allCompetitors"),a='[data-row="'+e+'"]',n=document.querySelectorAll(a);if(!n||0===n.length){if(r.querySelectorAll(".row").length>102)throw alert("Only 100 competitors can be added at a time."),"Too many rows added.";return addNewRow(),getInputAtRowColumn(e,t)}var o=a+'[data-column="'+t+'"]',i=document.querySelectorAll(o);if(!i||i.length<1)throw"Problem finding input.";return i[0]}function addNewRow(){var e=0,t=document.getElementById("allCompetitors"),r=document.getElementById("compRowTemplate").cloneNode(!0);(e=t.querySelectorAll(".row").length-2)<0&&(e=0);var a="competitors["+e+"].",n=r.querySelectorAll('input[name="template.SailNumber"]')[0];n.name=a+"SailNumber",n.dataset.column=0,n.dataset.row=e;var o=r.querySelectorAll('input[name="template.Name"]')[0];o.name=a+"Name",o.dataset.column=1,o.dataset.row=e;var i=r.querySelectorAll('input[name="template.BoatName"]')[0];i.name=a+"BoatName",i.dataset.column=2,i.dataset.row=e;var l=r.querySelectorAll('input[name="template.HomeClubName"]')[0];l.name=a+"HomeClubName",l.dataset.column=3,l.dataset.row=e,r.style.display="",t.appendChild(r),n.focus()}document.getElementsByName("competitors[0].Name")[0],document.getElementById("allCompetitors").onpaste=function(e){for(var t=e.clipboardData.getData("text/plain").split(String.fromCharCode(13)),r=0;r<t.length;r++)t[r]=t[r].split(String.fromCharCode(9));if(1!==t.length||1!==t[0].length){e.preventDefault();var a=Number(e.target.dataset.column)||0,n=Number(e.target.dataset.row)||0;for(r=0;r<t.length;r++)for(var o=0;o<t[r].length;o++)a+o<4&&(getInputAtRowColumn(n+r,a+o).value=t[r][o]);e.stopPropagation(),e.preventDefault()}};var SailScores=function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/js/",r(r.s=0)}([function(e,t,r){r.r(t),r.d(t,"init",(function(){return o})),r.d(t,"loadSeriesOptions",(function(){return i})),r.d(t,"loadFleet",(function(){return l})),r.d(t,"raceStateChanged",(function(){return c})),r.d(t,"completeCompCreate",(function(){return d})),r.d(t,"completeCompCreateFailed",(function(){return u})),r.d(t,"hideAlert",(function(){return s})),r.d(t,"moveUp",(function(){return p})),r.d(t,"moveDown",(function(){return m})),r.d(t,"deleteResult",(function(){return f})),r.d(t,"confirmDelete",(function(){return h})),r.d(t,"hideScoreButtonFooter",(function(){return g})),r.d(t,"addNewCompetitorById",(function(){return y})),r.d(t,"calculatePlaces",(function(){return C}));const a="No Code";function n(e){const t=e||event;return/textarea/i.test(t.srcElement.tagName)||13!==(e.keyCode||e.which||e.charCode||0)}function o(){document.querySelector("form").onkeypress=n,$("#raceform").submit((function(e){e.preventDefault(),function(e){for(var t=document.getElementById("results").getElementsByTagName("li"),r=1;r<t.length;r++){const n=(r-1).toString();var a=document.createElement("input");a.type="hidden",a.name="Scores["+n+"].competitorId",a.value=t[r].getAttribute("data-competitorId"),e.appendChild(a),(a=document.createElement("input")).type="hidden",a.name="Scores["+n+"].place",q(t[r])&&(a.value=t[r].getAttribute("data-place")),e.appendChild(a),(a=document.createElement("input")).type="hidden",a.name="Scores["+n+"].code",a.value=N(t[r]),e.appendChild(a),(a=document.createElement("input")).type="hidden",a.name="Scores["+n+"].codePointsString",a.value=j(t[r]),e.appendChild(a)}}(this),this.submit(),function(e){e.find("[name^=Scores]").remove()}(this)})),l(),i(),C(),$("#submitButton").prop("disabled",!1),$("#submitDisabledMessage").prop("hidden",!0)}function i(){!function(e,t){e&&t&&$.getJSON("/api/Series",{clubId:e,date:t},(function(e){S=e,function(){let e=$("#seriesIds");var t=e.val();e.empty(),$.each(S,(function(t,r){let a=r;e.append($("<option></option>").attr("value",a.id.toString()).text(a.name))})),e.selectpicker("destroy"),e.selectpicker(),e.val(t),e.selectpicker("refresh")}()}))}($("#clubId").val(),$("#date").val())}function l(){let e=$("#clubId").val(),t=$("#fleetId").val(),r=document.getElementById("fleetId"),a=r.options[r.selectedIndex].getAttribute("data-boat-class-id");a&&$("#createCompBoatClassSelect").val(a),$("#createCompFleetId").val(t),x(e,t)}function c(){let e=$("#raceState").val();"2"===e&&($("#weatherIcon").val("Select..."),$("#weatherIcon").selectpicker("refresh"),$("#weatherDescription").val(null),$("#windSpeed").val(null),$("#windGust").val(null),$("#windDirection").val(null),$("#temperature").val(null),$("#humidity").val(null),$("#cloudcover").val(null)),"1"===e&&function(){var e=$("#clubInitials").val();$.getJSON("/"+e+"/weather/current/",{},(function(e){console.log(e),e.icon&&$("#weatherIcon").val(null)&&($("#weatherIcon").val(e.icon),$("#weatherIcon").selectpicker("refresh")),e.description&&$("#weatherDescription").val(null)&&$("#weatherDescription").val(e.description),e.windSpeed&&$("#windSpeed").val(null)&&$("#windSpeed").val(e.windSpeed),e.windGust&&$("#windGust").val(null)&&$("#windGust").val(e.windGust),e.windDirection&&$("#windDirection").val(null)&&$("#windDirection").val(e.windDirection),e.temperature&&$("#temperature").val(null)&&$("#temperature").val(e.temperature),e.humidity&&$("#humidity").val(null)&&$("#humidity").val(e.humidity),e.cloudCoverPercent&&$("#cloudCover").val(null)&&$("#cloudCover").val(e.cloudCoverPercent)}))}()}function d(){x($("#clubId").val(),$("#fleetId").val()),$("#createCompetitor").modal("hide")}function u(){$("#compCreateAlert").show()}function s(){$("#compCreateAlert").hide()}function p(){var e=event.target,t=$(e).closest("li");t.prev().insertAfter(t),C()}function m(){var e=event.target,t=$(e).closest("li");t.next().insertBefore(t),C()}function f(){var e=$("#deleteConfirm"),t=e.find("#compIdToDelete").val();$("#results").find(`[data-competitorid='${t}']`).remove(),C(),e.modal("hide")}function h(){var e=event.target,t=$(e).closest("li"),r=t.data("competitorid"),a=t.find(".competitor-name").text(),n=$("#deleteConfirm");n.find("#competitorNameToDelete").text(a),n.find("#compIdToDelete").val(r),n.show()}function g(){$("#scoreButtonFooter").hide()}function y(e){v(I.find(t=>t.id===e))}function v(e){var t=document.getElementById("results"),r=document.getElementById("competitorTemplate").cloneNode(!0);r.id=e.id.toString(),r.setAttribute("data-competitorId",e.id.toString());var a=r.getElementsByClassName("competitor-name")[0];a.appendChild(document.createTextNode(e.name)),(a=r.getElementsByClassName("sail-number")[0]).appendChild(document.createTextNode(e.sailNumber)),e.alternativeSailNumber&&((a=r.getElementsByClassName("alt-sail-number")[0]).appendChild(document.createTextNode(" ("+e.alternativeSailNumber+")")),a.style.display=""),(a=r.getElementsByClassName("race-place")[0]).appendChild(document.createTextNode((0).toString()));for(var n=r.getElementsByClassName("delete-button"),o=0;o<n.length;o++)n[o].setAttribute("data-competitorId",e.id.toString());r.style.display="",t.appendChild(r),C(),$("html, body").animate({scrollTop:$(r).offset().top-150},300),$("#newCompetitor").val(""),_(),$("#scoreButtonDiv").empty(),I.forEach(e=>{let t="btn ",r="";w(e)?t+="btn-primary":(t+="btn-outline-primary",r="window.SailScores.addNewCompetitorById('"+e.id+"')"),$("#scoreButtonDiv").append('<button class="'+t+' data-id="'+e.id+'" onclick="'+r+'" > '+(e.sailNumber||e.alternativeSailNumber)+" </button>")})}function C(){for(var e=document.getElementById("results").getElementsByTagName("li"),t=1,r=1,a=e.length;r<a;r++){var n=e[r].getElementsByClassName("race-place")[0];e[r].setAttribute("data-place",r.toString());var o=e[r].getAttribute("data-originalScore");"competitorTemplate"!=n.id&&(q(e[r])&&"0"!==o?(n.textContent=t.toString(),e[r].setAttribute("data-place",t.toString()),t++):(n.textContent=N(e[r]),e[r].removeAttribute("data-place")));var i=e[r].getElementsByClassName("code-points")[0];E(e[r])?i.style.display="":(i.style.display="none",i.value="")}}function w(e){for(var t=document.getElementById("results").getElementsByTagName("li"),r=0,a=t.length;r<a;r++)if(t[r].getAttribute("data-competitorId")===e.id.toString())return!0;return!1}var I,b,S;function x(e,t){e&&t&&$.getJSON("/api/Competitors",{clubId:e,fleetId:t},(function(e){I=e,_(),$("#scoreButtonDiv").empty(),I&&I.length&&I.length<21?$("#scoreButtonFooter").show():$("#scoreButtonFooter").hide(),I.forEach(e=>{let t="btn ",r="";w(e)?t+="btn-primary":(t+="btn-outline-primary",r="window.SailScores.addNewCompetitorById('"+e.id+"')"),$("#scoreButtonDiv").append('<button class="'+t+' data-id="'+e.id+'" onclick="'+r+'" > '+(e.sailNumber||e.alternativeSailNumber)+" </button>")})}))}var A=!1;function _(){b=function(){const e=[];return console.debug("checking for comps in results"),I.forEach(t=>{if(!w(t)){let r={value:t.sailNumber+" - "+t.name,data:t};t.alternativeSailNumber&&(r.value=t.sailNumber+" ( "+t.alternativeSailNumber+" ) - "+t.name),e.push(r)}}),e}(),A&&$("#newCompetitor").autocomplete().dispose(),$("#newCompetitor").autocomplete({lookup:b,onSelect:function(e){v(e.data)},autoSelectFirst:!0,triggerSelectOnValidInput:!1,noCache:!0}),A=!0}function N(e){const t=e.getElementsByClassName("select-code")[0].value;return t===a?null:t}function j(e){const t=e.getElementsByClassName("code-points")[0].value;return t===a?null:t}function q(e){const t=e.getElementsByClassName("select-code")[0].value;return t===a||!!scoreCodes.filter(e=>e.name===t)[0].preserveResult}function E(e){const t=e.getElementsByClassName("select-code")[0].value;return t!==a&&"MAN"==scoreCodes.filter(e=>e.name===t)[0].formula}}]);SailScores=function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/js/",r(r.s=0)}([function(e,t){function r(e,t){var r=t.races.find(t=>t.id===e.raceId),a=t.races.filter(e=>e.date===r.date);if(1===r.length)return new Date(r.date);var n=a.findIndex(e=>e.id===r.id);return new Date(new Date(r.date).getTime()+24*n*60*60*1e3/a.length)}function a(e,t){var r=Math.max(...t.entries.filter(t=>t.raceId===e.raceId).map(e=>e.seriesPoints)),a=Math.min(...t.entries.filter(t=>t.raceId===e.raceId&&0!==t.seriesPoints).map(e=>e.seriesPoints)),n=(e.seriesPoints-a)/(r-a);return 0===e.seriesPoints&&(n=1),margin+n*(chartOverallHeight-margin-margin)}function n(e){var t=d3.select(e.node().parentNode),r=parseInt(e.style("width")),a=parseInt(e.style("height")),n=r/a;function o(){var r=parseInt(t.style("width"));e.attr("width",r),e.attr("height",Math.round(r/n))}e.attr("viewBox","0 0 "+r+" "+a).attr("perserveAspectRatio","xMinYMid").call(o),d3.select(window).on("resize."+t.attr("id"),o)}chartOverallWidth=960,chartOverallHeight=600,margin=30,legendWidth=150,legendLineHeight=16,legendMargin=2,d3.json("chartdata2.json").then((function(e){var t=e.races.map(e=>new Date(e.date)),o=Math.min.apply(null,t),i=Math.max.apply(null,t),l=d3.scaleTime().domain([o,i]).range([margin,chartOverallWidth-margin-legendWidth]),c=d3.scaleOrdinal(d3.schemeDark2);chartOverallHeight=e.competitors.length*legendLineHeight+margin;var d=d3.select("#chart").attr("width",chartOverallWidth).attr("height",chartOverallHeight).call(n);function u(e){compId=e.competitorId||e.id,d.selectAll("path.compLine").attr("opacity",.4),d.selectAll("path[data-compId='"+compId+"']").attr("stroke-width",4).attr("opacity",1),d.selectAll("g.legendEntry").attr("opacity",.4),d.selectAll("g.legendEntry[data-compId='"+compId+"']").attr("opacity",1),d.selectAll("g.legendEntry[data-compId='"+compId+"'] rect").attr("stroke",e=>c(e.id)),d.selectAll("circle").attr("opacity",.4),d.selectAll("circle[data-compId='"+compId+"']").attr("opacity",1)}function s(e){d.selectAll("path.compLine").attr("stroke-width",1.5),d.selectAll("path.compLine").attr("opacity",1),d.selectAll("g.legendEntry rect").attr("stroke","none"),tooltipGroup.attr("opacity",0).attr("transform","translate("+chartOverallWidth+","+chartOverallHeight+")"),d.selectAll("path.compLine").attr("opacity",1),d.selectAll("g.legendEntry").attr("opacity",1),d.selectAll("circle").attr("opacity",1)}var p=d3.select("#chart").selectAll("g.legendEntry").attr("transform","translate("+(chartOverallWidth-legendWidth)+","+(margin+legendMargin)+")").data(e.competitors).enter().append("g").attr("class","legendEntry").attr("data-compId",e=>e.id).attr("transform",(function(e,t){return"translate("+(chartOverallWidth-legendWidth)+","+(t*legendLineHeight+legendMargin)+")"})).attr("opacity",1).on("mouseover",u).on("mouseout",s);p.append("rect").attr("width",legendWidth-1).attr("height",legendLineHeight).attr("fill","none").attr("stroke-width",2),p.append("rect").attr("width",20-legendMargin).attr("height",legendLineHeight-2*legendMargin).attr("x",legendMargin).attr("y",legendMargin).style("fill",e=>c(e.id)).style("stroke-width",0),p.append("text").attr("x",20+legendMargin).attr("y",legendLineHeight-4).style("font-size","11px").style("font-family","sans-serif").text((function(e){return e.name}));var m=d3.axisTop().scale(l);d3.select("#chart").append("g").attr("id","xAxisG").attr("transform","translate(0,20)").call(m),lineData=d3.line().x(t=>l(r(t,e))).y(t=>a(t,e)),d.selectAll("path.compLine").data(e.competitors).enter().append("path").attr("class","compLine").attr("d",t=>lineData(e.entries.filter(e=>e.competitorId===t.id))).attr("fill","none").attr("opacity",1).attr("stroke",e=>c(e.id)).attr("stroke-width",1).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("data-compId",e=>e.id).on("mouseover",u).on("mouseout",s),d.selectAll("circle").data(e.entries).enter().append("circle").attr("r",3).attr("cy",t=>a(t,e)).attr("cx",t=>l(r(t,e))).attr("data-compId",e=>e.competitorId).attr("fill",e=>c(e.competitorId)).on("mouseover",(function(t){tooltipGroup.attr("transform","translate("+l(r(t,e))+","+(a(t,e)-legendLineHeight)+")").attr("opacity",1).select("text").selectAll("*").remove(),tooltipGroup.select("text").append("tspan").text("Race place: "+t.racePlace),tooltipGroup.select("text").append("tspan").attr("x",5).attr("y",2*legendLineHeight-5).text("Series points: "+t.seriesPoints),u(t)})).on("mouseout",s),tooltipGroup=d.append("g").attr("opacity",0),tooltipGroup.append("rect").attr("width",120).attr("height",2*legendLineHeight).attr("fill","white").attr("fill-opacity",".7"),tooltipGroup.append("text").attr("x",5).attr("y",legendLineHeight-5).style("font-size","11px").style("font-family","sans-serif")}))}]);function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}var seriesChart=function(){var e,t,r,a=600;function n(e,t){var r=t.races.find((function(t){return t.id===e.raceId})),a=t.races.filter((function(e){return e.date===r.date})),n=a.findIndex((function(e){return e.id===r.id}))+1;return new Date(new Date(r.date).getTime()+24*n*60*60*1e3/(a.length+1))}function o(e,t){var r=Math.max.apply(Math,_toConsumableArray(t.entries.filter((function(t){return t.raceId===e.raceId})).map((function(e){return e.seriesPoints})))),n=Math.min.apply(Math,_toConsumableArray(t.entries.filter((function(t){return t.raceId===e.raceId&&0!==t.seriesPoints})).map((function(e){return e.seriesPoints})))),o=(e.seriesPoints-n)/(r-n);return isNaN(o)&&(o=0),0===e.seriesPoints&&(o=1),30+o*(a-30-30)}function i(e){var t=d3.select(e.node().parentNode),r=parseInt(e.style("width")),a=parseInt(e.style("height")),n=r/a;function o(){var a=parseInt(t.style("width"));a<=100&&(a=r),e.attr("width",a),e.attr("height",Math.round(a/n))}e.attr("viewBox","0 0 "+r+" "+a).attr("perserveAspectRatio","xMinYMid").call(o),d3.select(window).on("resize."+t.attr("id"),o)}function l(l){if(null!==l){var c=l.races.map((function(e){return new Date(e.date)}));t=new Date(Math.min.apply(null,c)),(r=new Date(Math.max.apply(null,c))).setDate(r.getDate()+1);var d=d3.scaleTime().domain([t,r]).range([30,780]),u=d3.scaleOrdinal(d3.schemeDark2);a=16*l.competitors.length+60;var s=d3.select(e).attr("width",960).attr("height",a).call(i),p=d3.select(e).selectAll("g.legendEntry").attr("transform","translate(810,32)").data(l.competitors).enter().append("g").attr("class","legendEntry").attr("data-compId",(function(e){return e.id})).attr("transform",(function(e,t){return"translate(810,"+(16*t+2+20)+")"})).attr("opacity",1).on("mouseover",h).on("mouseout",g);p.append("rect").attr("width",149).attr("height",16).attr("fill","none").attr("stroke-width",2),p.append("rect").attr("width",18).attr("height",12).attr("x",2).attr("y",2).style("fill",(function(e){return u(e.id)})).style("stroke-width",0),p.append("text").attr("x",22).attr("y",12).style("font-size","11px").text((function(e){return e.name}));var m=d3.axisTop().scale(d),f=d3.select("html").attr("lang").substring(0,2);(t-r<864e6||"en"!==f)&&(m=m.tickFormat("")),s.append("g").attr("id","xAxisG").attr("transform","translate(0,20)").call(m),lineData=d3.line().x((function(e){return d(n(e,l))})).y((function(e){return o(e,l)})),s.selectAll("path.compLine").data(l.competitors).enter().append("path").attr("class","compLine").attr("d",(function(e){return lineData(l.entries.filter((function(t){return t.competitorId===e.id})))})).attr("fill","none").attr("opacity",1).attr("stroke",(function(e){return u(e.id)})).attr("stroke-width",1).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("data-compId",(function(e){return e.id})).on("mouseover",h).on("mouseout",g),s.selectAll("circle").data(l.entries).enter().append("circle").attr("r",3).attr("cy",(function(e){return o(e,l)})).attr("cx",(function(e){return d(n(e,l))})).attr("data-compId",(function(e){return e.competitorId})).attr("fill",(function(e){return u(e.competitorId)})).on("mouseover",(function(e){var t;tooltipGroup.attr("transform","translate("+d(n(e,l))+","+(o(e,l)-16)+")").attr("opacity",1).select("text").selectAll("*").remove(),tooltipGroup.select("text").append("tspan").text((t=e.raceId,l.races.find((function(e){return e.id===t})).shortName)),tooltipGroup.select("text").append("tspan").attr("x",5).attr("y",27).text("Place: "+e.racePlace),tooltipGroup.select("text").append("tspan").attr("x",5).attr("y",43).text("Series points: "+e.seriesPoints),h(e)})).on("mouseout",g),tooltipGroup=s.append("g").attr("opacity",0),tooltipGroup.append("rect").attr("width",120).attr("height",48).attr("fill","white").attr("fill-opacity",".7"),tooltipGroup.append("text").attr("x",5).attr("y",11).style("font-size","11px")}function h(e){compId=e.competitorId||e.id,s.selectAll("path.compLine").attr("opacity",.4),s.selectAll("path[data-compId='"+compId+"']").attr("stroke-width",4).attr("opacity",1),s.selectAll("g.legendEntry").attr("opacity",.4),s.selectAll("g.legendEntry[data-compId='"+compId+"']").attr("opacity",1),s.selectAll("g.legendEntry[data-compId='"+compId+"'] rect").attr("stroke",(function(e){return u(e.id)})),s.selectAll("circle").attr("opacity",.4),s.selectAll("circle[data-compId='"+compId+"']").attr("opacity",1)}function g(e){s.selectAll("path.compLine").attr("stroke-width",1.5),s.selectAll("path.compLine").attr("opacity",1),s.selectAll("g.legendEntry rect").attr("stroke","none"),tooltipGroup.attr("opacity",0).attr("transform","translate(960,"+a+")"),s.selectAll("path.compLine").attr("opacity",1),s.selectAll("g.legendEntry").attr("opacity",1),s.selectAll("circle").attr("opacity",1)}}return{drawChart:function(t,r){e=r;var a="/series/chart?seriesId="+t;d3.json(a).then(l)}}};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Guid=void 0;var Guid=function(){function e(t){_classCallCheck(this,e),this.guid=t,this._guid=t}return _createClass(e,[{key:"ToString",value:function(){return this.guid}}],[{key:"MakeNew",value:function(){var t,r;for(t="",r=0;r<32;r++)8!=r&&12!=r&&16!=r&&20!=r||(t+="-"),t+=Math.floor(16*Math.random()).toString(16).toUpperCase();return new e(t)}}]),e}();exports.Guid=Guid,Object.defineProperty(exports,"__esModule",{value:!0}),exports.init=init,exports.loadSeriesOptions=loadSeriesOptions,exports.loadFleet=loadFleet,exports.raceStateChanged=raceStateChanged,exports.completeCompCreate=completeCompCreate,exports.completeCompCreateFailed=completeCompCreateFailed,exports.hideAlert=hideAlert,exports.moveUp=moveUp,exports.moveDown=moveDown,exports.deleteResult=deleteResult,exports.confirmDelete=confirmDelete,exports.hideScoreButtonFooter=hideScoreButtonFooter,exports.addNewCompetitorById=addNewCompetitorById,exports.calculatePlaces=calculatePlaces;var _jquery=_interopRequireDefault(require("jquery"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}require("bootstrap"),require("bootstrap-select");var allCompetitors,competitorSuggestions,seriesOptions,noCodeString="No Code";function checkEnter(e){var t=e||event;return/textarea/i.test(t.srcElement.tagName)||13!==(e.keyCode||e.which||e.charCode||0)}function init(){document.querySelector("form").onkeypress=checkEnter,(0,_jquery.default)("#raceform").submit((function(e){e.preventDefault(),addScoresFieldsToForm(this),this.submit(),removeScoresFieldsFromForm(this)})),loadFleet(),loadSeriesOptions(),calculatePlaces(),(0,_jquery.default)("#submitButton").prop("disabled",!1),(0,_jquery.default)("#submitDisabledMessage").prop("hidden",!0)}function loadSeriesOptions(){getSeries((0,_jquery.default)("#clubId").val(),(0,_jquery.default)("#date").val())}function loadFleet(){var e=(0,_jquery.default)("#clubId").val(),t=(0,_jquery.default)("#fleetId").val(),r=document.getElementById("fleetId"),a=r.options[r.selectedIndex].getAttribute("data-boat-class-id");a&&(0,_jquery.default)("#createCompBoatClassSelect").val(a),(0,_jquery.default)("#createCompFleetId").val(t),getCompetitors(e,t)}function raceStateChanged(){var e=(0,_jquery.default)("#raceState").val();"2"===e&&clearWeatherFields(),"1"===e&&populateEmptyWeatherFields()}function completeCompCreate(){getCompetitors((0,_jquery.default)("#clubId").val(),(0,_jquery.default)("#fleetId").val()),(0,_jquery.default)("#createCompetitor").modal("hide")}function completeCompCreateFailed(){(0,_jquery.default)("#compCreateAlert").show()}function hideAlert(){(0,_jquery.default)("#compCreateAlert").hide()}function moveUp(){var e=event.target,t=(0,_jquery.default)(e).closest("li");t.prev().insertAfter(t),calculatePlaces()}function moveDown(){var e=event.target,t=(0,_jquery.default)(e).closest("li");t.next().insertBefore(t),calculatePlaces()}function deleteResult(){var e=(0,_jquery.default)("#deleteConfirm"),t=e.find("#compIdToDelete").val();(0,_jquery.default)("#results").find("[data-competitorid='".concat(t,"']")).remove(),calculatePlaces(),e.modal("hide")}function confirmDelete(){var e=event.target,t=(0,_jquery.default)(e).closest("li"),r=t.data("competitorid"),a=t.find(".competitor-name").text(),n=(0,_jquery.default)("#deleteConfirm");n.find("#competitorNameToDelete").text(a),n.find("#compIdToDelete").val(r),n.show()}function hideScoreButtonFooter(){(0,_jquery.default)("#scoreButtonFooter").hide()}function addNewCompetitorById(e){addNewCompetitor(allCompetitors.find((function(t){return t.id===e})))}function addNewCompetitor(e){var t=document.getElementById("results"),r=document.getElementById("competitorTemplate").cloneNode(!0);r.id=e.id.toString(),r.setAttribute("data-competitorId",e.id.toString());var a=r.getElementsByClassName("competitor-name")[0];a.appendChild(document.createTextNode(e.name)),(a=r.getElementsByClassName("sail-number")[0]).appendChild(document.createTextNode(e.sailNumber)),e.alternativeSailNumber&&((a=r.getElementsByClassName("alt-sail-number")[0]).appendChild(document.createTextNode(" ("+e.alternativeSailNumber+")")),a.style.display=""),(a=r.getElementsByClassName("race-place")[0]).appendChild(document.createTextNode((0).toString()));for(var n=r.getElementsByClassName("delete-button"),o=0;o<n.length;o++)n[o].setAttribute("data-competitorId",e.id.toString());r.style.display="",t.appendChild(r),calculatePlaces(),(0,_jquery.default)("html, body").animate({scrollTop:(0,_jquery.default)(r).offset().top-150},300),(0,_jquery.default)("#newCompetitor").val(""),initializeAutoComplete(),updateButtonFooter()}function addScoresFieldsToForm(e){for(var t=document.getElementById("results").getElementsByTagName("li"),r=1;r<t.length;r++){var a=(r-1).toString(),n=document.createElement("input");n.type="hidden",n.name="Scores["+a+"].competitorId",n.value=t[r].getAttribute("data-competitorId"),e.appendChild(n),(n=document.createElement("input")).type="hidden",n.name="Scores["+a+"].place",shouldCompKeepScore(t[r])&&(n.value=t[r].getAttribute("data-place")),e.appendChild(n),(n=document.createElement("input")).type="hidden",n.name="Scores["+a+"].code",n.value=getCompetitorCode(t[r]),e.appendChild(n),(n=document.createElement("input")).type="hidden",n.name="Scores["+a+"].codePointsString",n.value=getCompetitorCodePoints(t[r]),e.appendChild(n)}}function removeScoresFieldsFromForm(e){e.find("[name^=Scores]").remove()}function calculatePlaces(){for(var e=document.getElementById("results").getElementsByTagName("li"),t=1,r=1,a=e.length;r<a;r++){var n=e[r].getElementsByClassName("race-place")[0];e[r].setAttribute("data-place",r.toString());var o=e[r].getAttribute("data-originalScore");"competitorTemplate"!==n.id&&(shouldCompKeepScore(e[r])&&"0"!==o?(n.textContent=t.toString(),e[r].setAttribute("data-place",t.toString()),t++):(n.textContent=getCompetitorCode(e[r]),e[r].removeAttribute("data-place")));var i=e[r].getElementsByClassName("code-points")[0];shouldHaveManualEntry(e[r])?i.style.display="":(i.style.display="none",i.value="")}}function competitorIsInResults(e){for(var t=document.getElementById("results").getElementsByTagName("li"),r=0,a=t.length;r<a;r++)if(t[r].getAttribute("data-competitorId")===e.id.toString())return!0;return!1}function getSuggestions(){var e=[];return console.debug("checking for comps in results"),allCompetitors.forEach((function(t){if(!competitorIsInResults(t)){var r={value:t.sailNumber+" - "+t.name,data:t};t.alternativeSailNumber&&(r.value=t.sailNumber+" ( "+t.alternativeSailNumber+" ) - "+t.name),e.push(r)}})),e}function getCompetitors(e,t){e&&t&&_jquery.default.getJSON("/api/Competitors",{clubId:e,fleetId:t},(function(e){allCompetitors=e,initializeAutoComplete(),initializeButtonFooter()}))}function getSeries(e,t){e&&t&&_jquery.default.getJSON("/api/Series",{clubId:e,date:t},(function(e){seriesOptions=e,setSeries()}))}function setSeries(){var e=(0,_jquery.default)("#seriesIds"),t=e.val();e.empty(),_jquery.default.each(seriesOptions,(function(t,r){var a=r;e.append((0,_jquery.default)("<option></option>").attr("value",a.id.toString()).text(a.name))})),e.selectpicker("destroy"),e.selectpicker(),e.val(t),e.selectpicker("refresh")}var autoCompleteSetup=!1;function initializeAutoComplete(){competitorSuggestions=getSuggestions(),autoCompleteSetup&&(0,_jquery.default)("#newCompetitor").autocomplete().dispose(),(0,_jquery.default)("#newCompetitor").autocomplete({lookup:competitorSuggestions,onSelect:function(e){addNewCompetitor(e.data)},autoSelectFirst:!0,triggerSelectOnValidInput:!1,noCache:!0}),autoCompleteSetup=!0}function initializeButtonFooter(){(0,_jquery.default)("#scoreButtonDiv").empty(),allCompetitors&&allCompetitors.length&&allCompetitors.length<21?(0,_jquery.default)("#scoreButtonFooter").show():(0,_jquery.default)("#scoreButtonFooter").hide(),allCompetitors.forEach((function(e){var t="btn ",r="";competitorIsInResults(e)?t+="btn-primary":(t+="btn-outline-primary",r="window.SailScores.addNewCompetitorById('"+e.id+"')"),(0,_jquery.default)("#scoreButtonDiv").append('<button class="'+t+' data-id="'+e.id+'" onclick="'+r+'" > '+(e.sailNumber||e.alternativeSailNumber)+" </button>")}))}function updateButtonFooter(){(0,_jquery.default)("#scoreButtonDiv").empty(),allCompetitors.forEach((function(e){var t="btn ",r="";competitorIsInResults(e)?t+="btn-primary":(t+="btn-outline-primary",r="window.SailScores.addNewCompetitorById('"+e.id+"')"),(0,_jquery.default)("#scoreButtonDiv").append('<button class="'+t+' data-id="'+e.id+'" onclick="'+r+'" > '+(e.sailNumber||e.alternativeSailNumber)+" </button>")}))}function getCompetitorCode(e){var t=e.getElementsByClassName("select-code")[0].value;return t===noCodeString?null:t}function getCompetitorCodePoints(e){var t=e.getElementsByClassName("code-points")[0].value;return t===noCodeString?null:t}function shouldCompKeepScore(e){var t=e.getElementsByClassName("select-code")[0].value;return t===noCodeString||!!scoreCodes.filter((function(e){return e.name===t}))[0].preserveResult}function shouldHaveManualEntry(e){var t=e.getElementsByClassName("select-code")[0].value;return t!==noCodeString&&"MAN"===scoreCodes.filter((function(e){return e.name===t}))[0].formula}function clearWeatherFields(){(0,_jquery.default)("#weatherIcon").val("Select..."),(0,_jquery.default)("#weatherIcon").selectpicker("refresh"),(0,_jquery.default)("#weatherDescription").val(null),(0,_jquery.default)("#windSpeed").val(null),(0,_jquery.default)("#windGust").val(null),(0,_jquery.default)("#windDirection").val(null),(0,_jquery.default)("#temperature").val(null),(0,_jquery.default)("#humidity").val(null),(0,_jquery.default)("#cloudcover").val(null)}function populateEmptyWeatherFields(){var e=(0,_jquery.default)("#clubInitials").val();_jquery.default.getJSON("/"+e+"/weather/current/",{},(function(e){console.log(e),e.icon&&(0,_jquery.default)("#weatherIcon").val(null)&&((0,_jquery.default)("#weatherIcon").val(e.icon),(0,_jquery.default)("#weatherIcon").selectpicker("refresh")),e.description&&(0,_jquery.default)("#weatherDescription").val(null)&&(0,_jquery.default)("#weatherDescription").val(e.description),e.windSpeed&&(0,_jquery.default)("#windSpeed").val(null)&&(0,_jquery.default)("#windSpeed").val(e.windSpeed),e.windGust&&(0,_jquery.default)("#windGust").val(null)&&(0,_jquery.default)("#windGust").val(e.windGust),e.windDirection&&(0,_jquery.default)("#windDirection").val(null)&&(0,_jquery.default)("#windDirection").val(e.windDirection),e.temperature&&(0,_jquery.default)("#temperature").val(null)&&(0,_jquery.default)("#temperature").val(e.temperature),e.humidity&&(0,_jquery.default)("#humidity").val(null)&&(0,_jquery.default)("#humidity").val(e.humidity),e.cloudCoverPercent&&(0,_jquery.default)("#cloudCover").val(null)&&(0,_jquery.default)("#cloudCover").val(e.cloudCoverPercent)}))}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var d3=_interopRequireWildcard(require("d3")),d3axis=_interopRequireWildcard(require("d3-axis"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=a?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}var chartOverallWidth=960,chartOverallHeight=600,margin=30,legendWidth=150,legendLineHeight=16,legendMargin=2;function getDate(e,t){var r=t.races.find((function(t){return t.id===e.raceId})),a=t.races.filter((function(e){return e.date===r.date}));if(1===r.length)return new Date(r.date);var n=a.findIndex((function(e){return e.id==r.id}));return new Date(new Date(r.date).getTime()+24*n*60*60*1e3/a.length)}function getY(e,t){var r=Math.max.apply(Math,_toConsumableArray(t.entries.filter((function(t){return t.raceId===e.raceId})).map((function(e){return e.seriesPoints})))),a=Math.min.apply(Math,_toConsumableArray(t.entries.filter((function(t){return t.raceId===e.raceId&&0!==t.seriesPoints})).map((function(e){return e.seriesPoints})))),n=(e.seriesPoints-a)/(r-a);return 0===e.seriesPoints&&(n=1),margin+n*(chartOverallHeight-margin-margin)}d3.json("chartdata2.json").then(processChartData);var unique=function(e,t,r){return r.indexOf(e)===t};function responsivefy(e){var t=d3.select(e.node().parentNode),r=parseInt(e.style("width")),a=parseInt(e.style("height")),n=r/a;function o(){var r=parseInt(t.style("width"));e.attr("width",r),e.attr("height",Math.round(r/n))}e.attr("viewBox","0 0 "+r+" "+a).attr("perserveAspectRatio","xMinYMid").call(o),d3.select(window).on("resize."+t.attr("id"),o)}function getCompName(e,t){return t.find((function(t){return t.id===e})).name}function processChartData(e){var t=e.races.map((function(e){return new Date(e.date)})),r=Math.min.apply(null,t),a=Math.max.apply(null,t),n=d3.scaleTime().domain([r,a]).range([margin,chartOverallWidth-margin-legendWidth]),o=d3.scaleOrdinal(d3.schemeDark2);chartOverallHeight=e.competitors.length*legendLineHeight+margin;var i=d3.select("#chart").attr("width",chartOverallWidth).attr("height",chartOverallHeight).call(responsivefy);function l(e){var t=e.competitorId||e.id;i.selectAll("path.compLine").attr("opacity",.4),i.selectAll("path[data-compId='"+t+"']").attr("stroke-width",4).attr("opacity",1),i.selectAll("g.legendEntry").attr("opacity",.4),i.selectAll("g.legendEntry[data-compId='"+t+"']").attr("opacity",1),i.selectAll("g.legendEntry[data-compId='"+t+"'] rect").attr("stroke",(function(e){return o(e.id)})),i.selectAll("circle").attr("opacity",.4),i.selectAll("circle[data-compId='"+t+"']").attr("opacity",1)}function c(e){i.selectAll("path.compLine").attr("stroke-width",1.5),i.selectAll("path.compLine").attr("opacity",1),i.selectAll("g.legendEntry rect").attr("stroke","none"),p.attr("opacity",0).attr("transform","translate("+chartOverallWidth+","+chartOverallHeight+")"),i.selectAll("path.compLine").attr("opacity",1),i.selectAll("g.legendEntry").attr("opacity",1),i.selectAll("circle").attr("opacity",1)}var d=d3.select("#chart").selectAll("g.legendEntry").attr("transform","translate("+(chartOverallWidth-legendWidth)+","+(margin+legendMargin)+")").data(e.competitors).enter().append("g").attr("class","legendEntry").attr("data-compId",(function(e){return e.id})).attr("transform",(function(e,t){return"translate("+(chartOverallWidth-legendWidth)+","+(t*legendLineHeight+legendMargin)+")"})).attr("opacity",1).on("mouseover",l).on("mouseout",c);d.append("rect").attr("width",legendWidth-1).attr("height",legendLineHeight).attr("fill","none").attr("stroke-width",2),d.append("rect").attr("width",20-legendMargin).attr("height",legendLineHeight-2*legendMargin).attr("x",legendMargin).attr("y",legendMargin).style("fill",(function(e){return o(e.id)})).style("stroke-width",0),d.append("text").attr("x",20+legendMargin).attr("y",legendLineHeight-4).style("font-size","11px").style("font-family","sans-serif").text((function(e){return e.name}));var u=d3axis.axisTop(n);d3.select("#chart").append("g").attr("id","xAxisG").attr("transform","translate(0,20)").call(u);var s=d3.line().x((function(t){return n(getDate(t,e))})).y((function(t){return getY(t,e)}));i.selectAll("path.compLine").data(e.competitors).enter().append("path").attr("class","compLine").attr("d",(function(t){return s(e.entries.filter((function(e){return e.competitorId===t.id})))})).attr("fill","none").attr("opacity",1).attr("stroke",(function(e){return o(e.id)})).attr("stroke-width",1).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("data-compId",(function(e){return e.id})).on("mouseover",l).on("mouseout",c),i.selectAll("circle").data(e.entries).enter().append("circle").attr("r",3).attr("cy",(function(t){return getY(t,e)})).attr("cx",(function(t){return n(getDate(t,e))})).attr("data-compId",(function(e){return e.competitorId})).attr("fill",(function(e){return o(e.competitorId)})).on("mouseover",(function(t){p.attr("transform","translate("+n(getDate(t,e))+","+(getY(t,e)-legendLineHeight)+")").attr("opacity",1).select("text").selectAll("*").remove(),p.select("text").append("tspan").text("Race place: "+t.racePlace),p.select("text").append("tspan").attr("x",5).attr("y",2*legendLineHeight-5).text("Series points: "+t.seriesPoints),l(t)})).on("mouseout",c);var p=i.append("g").attr("opacity",0);p.append("rect").attr("width",120).attr("height",2*legendLineHeight).attr("fill","white").attr("fill-opacity",".7"),p.append("text").attr("x",5).attr("y",legendLineHeight-5).style("font-size","11px").style("font-family","sans-serif")}