"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var d3=_interopRequireWildcard(require("d3")),d3axis=_interopRequireWildcard(require("d3-axis"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return _getRequireWildcardCache=function(){return t},t}function _interopRequireWildcard(t){if(t&&t.__esModule)return t;if(null===t||"object"!==_typeof(t)&&"function"!=typeof t)return{default:t};var e=_getRequireWildcardCache();if(e&&e.has(t))return e.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var i=n?Object.getOwnPropertyDescriptor(t,a):null;i&&(i.get||i.set)?Object.defineProperty(r,a,i):r[a]=t[a]}return r.default=t,e&&e.set(t,r),r}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}var chartOverallWidth=960,chartOverallHeight=600,margin=30,legendWidth=150,legendLineHeight=16,legendMargin=2;function getDate(t,e){var r=e.races.find((function(e){return e.id===t.raceId})),n=e.races.filter((function(t){return t.date===r.date}));if(1===r.length)return new Date(r.date);var a=n.findIndex((function(t){return t.id==r.id}));return new Date(new Date(r.date).getTime()+24*a*60*60*1e3/n.length)}function getY(t,e){var r=Math.max.apply(Math,_toConsumableArray(e.entries.filter((function(e){return e.raceId===t.raceId})).map((function(t){return t.seriesPoints})))),n=Math.min.apply(Math,_toConsumableArray(e.entries.filter((function(e){return e.raceId===t.raceId&&0!==e.seriesPoints})).map((function(t){return t.seriesPoints})))),a=(t.seriesPoints-n)/(r-n);return 0===t.seriesPoints&&(a=1),margin+a*(chartOverallHeight-margin-margin)}d3.json("chartdata2.json").then(processChartData);var unique=function(t,e,r){return r.indexOf(t)===e};function responsivefy(t){var e=d3.select(t.node().parentNode),r=parseInt(t.style("width")),n=parseInt(t.style("height")),a=r/n;function i(){var r=parseInt(e.style("width"));t.attr("width",r),t.attr("height",Math.round(r/a))}t.attr("viewBox","0 0 "+r+" "+n).attr("perserveAspectRatio","xMinYMid").call(i),d3.select(window).on("resize."+e.attr("id"),i)}function getCompName(t,e){return e.find((function(e){return e.id===t})).name}function processChartData(t){var e=t.races.map((function(t){return new Date(t.date)})),r=Math.min.apply(null,e),n=Math.max.apply(null,e),a=d3.scaleTime().domain([r,n]).range([margin,chartOverallWidth-margin-legendWidth]),i=d3.scaleOrdinal(d3.schemeDark2);chartOverallHeight=t.competitors.length*legendLineHeight+margin;var o=d3.select("#chart").attr("width",chartOverallWidth).attr("height",chartOverallHeight).call(responsivefy);function l(t){var e=t.competitorId||t.id;o.selectAll("path.compLine").attr("opacity",.4),o.selectAll("path[data-compId='"+e+"']").attr("stroke-width",4).attr("opacity",1),o.selectAll("g.legendEntry").attr("opacity",.4),o.selectAll("g.legendEntry[data-compId='"+e+"']").attr("opacity",1),o.selectAll("g.legendEntry[data-compId='"+e+"'] rect").attr("stroke",(function(t){return i(t.id)})),o.selectAll("circle").attr("opacity",.4),o.selectAll("circle[data-compId='"+e+"']").attr("opacity",1)}function c(t){o.selectAll("path.compLine").attr("stroke-width",1.5),o.selectAll("path.compLine").attr("opacity",1),o.selectAll("g.legendEntry rect").attr("stroke","none"),u.attr("opacity",0).attr("transform","translate("+chartOverallWidth+","+chartOverallHeight+")"),o.selectAll("path.compLine").attr("opacity",1),o.selectAll("g.legendEntry").attr("opacity",1),o.selectAll("circle").attr("opacity",1)}var d=d3.select("#chart").selectAll("g.legendEntry").attr("transform","translate("+(chartOverallWidth-legendWidth)+","+(margin+legendMargin)+")").data(t.competitors).enter().append("g").attr("class","legendEntry").attr("data-compId",(function(t){return t.id})).attr("transform",(function(t,e){return"translate("+(chartOverallWidth-legendWidth)+","+(e*legendLineHeight+legendMargin)+")"})).attr("opacity",1).on("mouseover",l).on("mouseout",c);d.append("rect").attr("width",legendWidth-1).attr("height",legendLineHeight).attr("fill","none").attr("stroke-width",2),d.append("rect").attr("width",20-legendMargin).attr("height",legendLineHeight-2*legendMargin).attr("x",legendMargin).attr("y",legendMargin).style("fill",(function(t){return i(t.id)})).style("stroke-width",0),d.append("text").attr("x",20+legendMargin).attr("y",legendLineHeight-4).style("font-size","11px").style("font-family","sans-serif").text((function(t){return t.name}));var s=d3axis.axisTop(a);d3.select("#chart").append("g").attr("id","xAxisG").attr("transform","translate(0,20)").call(s);var p=d3.line().x((function(e){return a(getDate(e,t))})).y((function(e){return getY(e,t)}));o.selectAll("path.compLine").data(t.competitors).enter().append("path").attr("class","compLine").attr("d",(function(e){return p(t.entries.filter((function(t){return t.competitorId===e.id})))})).attr("fill","none").attr("opacity",1).attr("stroke",(function(t){return i(t.id)})).attr("stroke-width",1).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("data-compId",(function(t){return t.id})).on("mouseover",l).on("mouseout",c),o.selectAll("circle").data(t.entries).enter().append("circle").attr("r",3).attr("cy",(function(e){return getY(e,t)})).attr("cx",(function(e){return a(getDate(e,t))})).attr("data-compId",(function(t){return t.competitorId})).attr("fill",(function(t){return i(t.competitorId)})).on("mouseover",(function(e){u.attr("transform","translate("+a(getDate(e,t))+","+(getY(e,t)-legendLineHeight)+")").attr("opacity",1).select("text").selectAll("*").remove(),u.select("text").append("tspan").text("Race place: "+e.racePlace),u.select("text").append("tspan").attr("x",5).attr("y",2*legendLineHeight-5).text("Series points: "+e.seriesPoints),l(e)})).on("mouseout",c);var u=o.append("g").attr("opacity",0);u.append("rect").attr("width",120).attr("height",2*legendLineHeight).attr("fill","white").attr("fill-opacity",".7"),u.append("text").attr("x",5).attr("y",legendLineHeight-5).style("font-size","11px").style("font-family","sans-serif")}