"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}var seriesChart=function(){var t,e,r,a=600;function n(t,e){var r=e.races.find((function(e){return e.id===t.raceId})),a=e.races.filter((function(t){return t.date===r.date})),n=a.findIndex((function(t){return t.id===r.id}))+1;return new Date(new Date(r.date).getTime()+24*n*60*60*1e3/(a.length+1))}function o(t,e){var r=Math.max.apply(Math,_toConsumableArray(e.entries.filter((function(e){return e.raceId===t.raceId})).map((function(t){return t.seriesPoints})))),n=Math.min.apply(Math,_toConsumableArray(e.entries.filter((function(e){return e.raceId===t.raceId&&0!==e.seriesPoints})).map((function(t){return t.seriesPoints})))),o=(t.seriesPoints-n)/(r-n);return isNaN(o)&&(o=0),0===t.seriesPoints&&(o=1),30+o*(a-30-30)}function i(t){var e=d3.select(t.node().parentNode),r=parseInt(t.style("width")),a=parseInt(t.style("height")),n=r/a;function o(){var a=parseInt(e.style("width"));a<=100&&(a=r),t.attr("width",a),t.attr("height",Math.round(a/n))}t.attr("viewBox","0 0 "+r+" "+a).attr("perserveAspectRatio","xMinYMid").call(o),d3.select(window).on("resize."+e.attr("id"),o)}function l(l){if(null!==l){var c=l.races.map((function(t){return new Date(t.date)}));e=new Date(Math.min.apply(null,c)),(r=new Date(Math.max.apply(null,c))).setDate(r.getDate()+1);var s=d3.scaleTime().domain([e,r]).range([30,780]),p=d3.scaleOrdinal(d3.schemeDark2);a=16*l.competitors.length+60;var d=d3.select(t).attr("width",960).attr("height",a).call(i),u=d3.select(t).selectAll("g.legendEntry").attr("transform","translate(810,32)").data(l.competitors).enter().append("g").attr("class","legendEntry").attr("data-compId",(function(t){return t.id})).attr("transform",(function(t,e){return"translate(810,"+(16*e+2+20)+")"})).attr("opacity",1).on("mouseover",y).on("mouseout",h);u.append("rect").attr("width",149).attr("height",16).attr("fill","none").attr("stroke-width",2),u.append("rect").attr("width",18).attr("height",12).attr("x",2).attr("y",2).style("fill",(function(t){return p(t.id)})).style("stroke-width",0),u.append("text").attr("x",22).attr("y",12).style("font-size","11px").text((function(t){return t.name}));var f=d3.axisTop().scale(s),m=d3.select("html").attr("lang").substring(0,2);(e-r<864e6||"en"!==m)&&(f=f.tickFormat("")),d.append("g").attr("id","xAxisG").attr("transform","translate(0,20)").call(f),lineData=d3.line().x((function(t){return s(n(t,l))})).y((function(t){return o(t,l)})),d.selectAll("path.compLine").data(l.competitors).enter().append("path").attr("class","compLine").attr("d",(function(t){return lineData(l.entries.filter((function(e){return e.competitorId===t.id})))})).attr("fill","none").attr("opacity",1).attr("stroke",(function(t){return p(t.id)})).attr("stroke-width",1).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("data-compId",(function(t){return t.id})).on("mouseover",y).on("mouseout",h),d.selectAll("circle").data(l.entries).enter().append("circle").attr("r",3).attr("cy",(function(t){return o(t,l)})).attr("cx",(function(t){return s(n(t,l))})).attr("data-compId",(function(t){return t.competitorId})).attr("fill",(function(t){return p(t.competitorId)})).on("mouseover",(function(t){var e;tooltipGroup.attr("transform","translate("+s(n(t,l))+","+(o(t,l)-16)+")").attr("opacity",1).select("text").selectAll("*").remove(),tooltipGroup.select("text").append("tspan").text((e=t.raceId,l.races.find((function(t){return t.id===e})).shortName)),tooltipGroup.select("text").append("tspan").attr("x",5).attr("y",27).text("Place: "+t.racePlace),tooltipGroup.select("text").append("tspan").attr("x",5).attr("y",43).text("Series points: "+t.seriesPoints),y(t)})).on("mouseout",h),tooltipGroup=d.append("g").attr("opacity",0),tooltipGroup.append("rect").attr("width",120).attr("height",48).attr("fill","white").attr("fill-opacity",".7"),tooltipGroup.append("text").attr("x",5).attr("y",11).style("font-size","11px")}function y(t){compId=t.competitorId||t.id,d.selectAll("path.compLine").attr("opacity",.4),d.selectAll("path[data-compId='"+compId+"']").attr("stroke-width",4).attr("opacity",1),d.selectAll("g.legendEntry").attr("opacity",.4),d.selectAll("g.legendEntry[data-compId='"+compId+"']").attr("opacity",1),d.selectAll("g.legendEntry[data-compId='"+compId+"'] rect").attr("stroke",(function(t){return p(t.id)})),d.selectAll("circle").attr("opacity",.4),d.selectAll("circle[data-compId='"+compId+"']").attr("opacity",1)}function h(t){d.selectAll("path.compLine").attr("stroke-width",1.5),d.selectAll("path.compLine").attr("opacity",1),d.selectAll("g.legendEntry rect").attr("stroke","none"),tooltipGroup.attr("opacity",0).attr("transform","translate(960,"+a+")"),d.selectAll("path.compLine").attr("opacity",1),d.selectAll("g.legendEntry").attr("opacity",1),d.selectAll("circle").attr("opacity",1)}}return{drawChart:function(e,r){e,t=r;var a="/series/chart?seriesId="+e;d3.json(a).then(l)}}};