@using SailScores.Web.Models.SailScores
@using SailScores.Core.Model
@using SailScores.Core.FlatModel
@using SailScores.Api.Enumerations
@using Microsoft.Extensions.Localization
@using SailScores.Web.Resources
@using SailScores.Web.Services
@using Microsoft.AspNetCore.Http.Extensions;

@inject IStringLocalizer<SharedResource> localizer

@model ClubItemViewModel<Series>

@{
    ViewBag.Title = Model.Item.Name;
    Layout = "_ClubLayout";
}
@{ 
    var results = Model.Item.FlatResults;
}

<div class="row">
    <div class="col-md-6">
        <h2>@Model.Item.Name</h2>
        @if (!String.IsNullOrWhiteSpace(Model.Item.Description))
        {
            <h5>@Model.Item.Description</h5>
        }
        @results.NumberOfSailedRaces @localizer["races sailed with"] @results.NumberOfDiscards 
        @localizer["discards"],
        @results.Competitors.Count() @localizer["competitors"]
        @if (!String.IsNullOrWhiteSpace(@results.ScoringSystemName))
        {
            @:&ndash; @results.ScoringSystemName
        }
        @if (results.IsPercentSystem && results.PercentRequired.HasValue)
        {
            @:&ndash; @results.PercentRequired.Value.ToString("G5")% participation required for ranking
        }
    </div>

    <div class="col-md-6">
        @if (Model.CanEdit)
        {
            <br class="d-md-none" />
            <hr class="d-md-none" />
            <div class="row bg-light">
                <div class="col-sm-4 my-2">
                    <a asp-controller="Race"
                        asp-action="Create"
                        asp-route-seriesId="@Model.Item.Id"
                        asp-route-returnUrl="@Context.Request.GetEncodedUrl()"
                        class="btn btn-outline-primary">@localizer["New Race"]</a>
                </div>
            </div>
        }
    </div>
</div>

@await Html.PartialAsync("_ResultsTable", Model.Item)

@if (Model.Item.UpdatedDate.HasValue)
{
    <br />
    <i>@localizer["Updated"] @(Model.Item.UpdatedDate.Value.ToString("f")) UTC</i>
}
