@model SailScores.Web.Models.SailScores.SiteAdminClubDetailsViewModel

@{
    ViewData["Title"] = "Site Admin - " + Model.Name;
    Layout = "_Layout";
}

<h1>Site Administration - @Model.Name</h1>

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a asp-action="Index">Site Admin</a></li>
        <li class="breadcrumb-item active" aria-current="page">@Model.Name (@Model.Initials)</li>
    </ol>
</nav>

@if (TempData["Message"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["Message"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="row mb-3">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3>Club Information</h3>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-3">Club Name:</dt>
                    <dd class="col-sm-9">@Model.Name</dd>

                    <dt class="col-sm-3">Initials:</dt>
                    <dd class="col-sm-9">@Model.Initials</dd>

                    <dt class="col-sm-3">Visibility:</dt>
                    <dd class="col-sm-9">
                        @if (Model.IsHidden)
                        {
                            <span class="badge bg-secondary">Hidden</span>
                        }
                        else
                        {
                            <span class="badge bg-success">Visible</span>
                        }
                    </dd>

                    <dt class="col-sm-3">Latest Series Update:</dt>
                    <dd class="col-sm-9">
                        @if (Model.LatestSeriesUpdate.HasValue)
                        {
                            @Model.LatestSeriesUpdate.Value.ToString("yyyy-MM-dd HH:mm:ss")
                        }
                        else
                        {
                            <span class="text-muted">N/A</span>
                        }
                    </dd>

                    <dt class="col-sm-3">Latest Race Date:</dt>
                    <dd class="col-sm-9">
                        @if (Model.LatestRaceDate.HasValue)
                        {
                            @Model.LatestRaceDate.Value.ToString("yyyy-MM-dd HH:mm:ss")
                        }
                        else
                        {
                            <span class="text-muted">N/A</span>
                        }
                    </dd>

                    <dt class="col-sm-3">Total Races:</dt>
                    <dd class="col-sm-9">@Model.RaceCount</dd>
                </dl>
            </div>
        </div>
    </div>
</div>



<div class="row mb-3">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3>Series Management</h3>
            </div>
            <div class="card-body">
                @if (Model.Series != null && Model.Series.Any())
                {
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Series Name</th>
                                <th>Season</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var series in Model.Series)
                            {
                                <tr>
                                    <td>@series.Name</td>
                                    <td>@series.Season?.Name</td>
                                    <td>
                                        <form asp-action="RecalculateSeries" method="post" class="d-inline">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="seriesId" value="@series.Id" />
                                            <input type="hidden" name="clubInitials" value="@Model.Initials" />
                                            <button type="submit" class="btn btn-sm btn-primary">
                                                <i class="fas fa-calculator"></i> Recalculate
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-muted">No series found for this club.</p>
                }
            </div>
        </div>
    </div>
</div>


<div class="row mb-3">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3>Club Management Actions</h3>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <form asp-action="Backup" method="post" class="d-inline">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="clubInitials" value="@Model.Initials" />
                        <button type="submit" class="btn btn-info">
                            <i class="fas fa-download"></i> Download Club Backup (compressed .gz file)
                        </button>
                    </form>

                    <div class="mt-3">
                        <h5>Reset Club Data</h5>
                        <p class="text-muted mb-2">Choose a reset level based on what data you want to preserve:</p>

                        <form asp-action="Reset" method="post" class="mb-2">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="clubId" value="@Model.Id" />
                            <input type="hidden" name="clubInitials" value="@Model.Initials" />
                            <input type="hidden" name="resetLevel" value="1" />
                            <button type="submit" class="btn btn-warning w-100 text-start" onclick="return confirm('Reset Level 1: Clear races, scores, series, and regattas.\n\nPreserves: Competitors, fleets, boat classes, seasons, and scoring systems.\n\nAre you sure?');">
                                <i class="fas fa-broom"></i> <strong>Reset Level 1:</strong> Races and Series Only
                                <br /><small class="ms-4">Preserves competitors, fleets, boat classes, seasons, scoring systems</small>
                            </button>
                        </form>

                        <form asp-action="Reset" method="post" class="mb-2">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="clubId" value="@Model.Id" />
                            <input type="hidden" name="clubInitials" value="@Model.Initials" />
                            <input type="hidden" name="resetLevel" value="2" />
                            <button type="submit" class="btn btn-warning w-100 text-start" onclick="return confirm('Reset Level 2: Clear races, scores, series, regattas, and competitors.\n\nPreserves: Fleets, boat classes, seasons, and scoring systems.\n\nAre you sure?');">
                                <i class="fas fa-broom"></i> <strong>Reset Level 2:</strong> Races, Series, and Competitors
                                <br /><small class="ms-4">Preserves fleets, boat classes, seasons, scoring systems</small>
                            </button>
                        </form>

                        <form asp-action="Reset" method="post">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="clubId" value="@Model.Id" />
                            <input type="hidden" name="clubInitials" value="@Model.Initials" />
                            <input type="hidden" name="resetLevel" value="3" />
                            <button type="submit" class="btn btn-danger w-100 text-start" onclick="return confirm('FULL RESET: This will clear ALL data and reset scoring systems to defaults.\n\nOnly preserves: Club name, initials, and website URL.\n\nTHIS ACTION CANNOT BE UNDONE. Are you absolutely sure?');">
                                <i class="fas fa-trash"></i> <strong>Reset Level 3:</strong> Full Reset
                                <br /><small class="ms-4">WARNING: Removes everything except club name, initials, and URL</small>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <a asp-action="Index" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Site Admin
        </a>
        <a asp-controller="Admin" asp-action="Index" asp-route-clubInitials="@Model.Initials" class="btn btn-primary">
            <i class="fas fa-cog"></i> Go to Club Admin
        </a>
    </div>
</div>
