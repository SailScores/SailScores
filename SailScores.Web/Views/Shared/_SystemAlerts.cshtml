@using SailScores.Core.Model
@using Markdig
@using Ganss.Xss
@model IEnumerable<SystemAlert>
@inject IHtmlSanitizer HtmlSanitizer

@if (Model != null && Model.Any())
{
    foreach (var alert in Model)
    {
        var alertId = $"alert-{alert.Id}";
        var markdownHtml = Markdown.ToHtml(alert.Content ?? "", new MarkdownPipelineBuilder().UseAdvancedExtensions().Build());
        var sanitizedHtml = HtmlSanitizer.Sanitize(markdownHtml);
        
        <div class="alert alert-warning alert-dismissible fade show system-alert" id="@alertId" role="alert" data-alert-id="@alert.Id">
            <div class="container-lg">
                @Html.Raw(sanitizedHtml)
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        </div>
    }
    
    <script>
        (function() {
            document.querySelectorAll('.system-alert').forEach(function(alertElement) {
                var alertId = alertElement.getAttribute('data-alert-id');
                var dismissedKey = 'dismissed_' + alertId;
                
                // Check if this alert was dismissed in this session
                if (sessionStorage.getItem(dismissedKey) === 'true') {
                    alertElement.style.display = 'none';
                }
                
                // Listen for dismiss event
                alertElement.addEventListener('closed.bs.alert', function () {
                    sessionStorage.setItem(dismissedKey, 'true');
                });
            });
        })();
    </script>
}
