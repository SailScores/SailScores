@model SailScores.Web.Models.SailScores.WhatIfResultsViewModel
@inject IStringLocalizer<SharedResource> localizer
@inject AppSettingsService settingsService

@{
    var results = Model.Series.FlatResults;
    var alternateResults = Model.AlternateResults;
    ViewData["Title"] = "What If results";
    ViewData["WideLayout"] = (results.Races?.Count() ?? 0) > 7;
    Layout = "~/Views/Shared/_ClubLayout.cshtml";
}

<a class="btn btn-sm btn-outline-primary"
   asp-action="Edit"
   asp-controller="Series"
   asp-route-id="@Model.SeriesId"
   asp-route-returnUrl="@ViewData["ReturnUrl"]"
   class="btn btn-outline-primary">Back to Series admin</a>
<hr />

<h3>
    <span class="text-muted">Preview</span>
    @if (!String.IsNullOrWhiteSpace(@alternateResults.ScoringSystemName))
    {
        @alternateResults.ScoringSystemName
    }
    &ndash; @alternateResults.NumberOfDiscards @localizer["discards"]
</h3>
<p class="lead">
    @if (alternateResults.IsPercentSystem && alternateResults.PercentRequired.HasValue && alternateResults.PercentRequired.Value > 1)
    {
        @alternateResults.PercentRequired.Value.ToString("G5")@:% participation required for ranking
    }
</p>
@await Html.PartialAsync("_ResultsTable", Model.Series,
                                new ViewDataDictionary(this.ViewData) {
                                { "ExcludeCompetitorLinks", true },
                                { "AlternateResults", Model.AlternateResults }})

<hr />
<h3>
    <span class="text-muted">Currently shared</span>
    @if (!String.IsNullOrWhiteSpace(@results.ScoringSystemName))
    {
        @results.ScoringSystemName
    }
    &ndash; @results.NumberOfDiscards @localizer["discards"]
</h3>
<p class="lead">
    @if (results.IsPercentSystem && results.PercentRequired.HasValue && results.PercentRequired.Value > 1)
    {
        @results.PercentRequired.Value.ToString("G5")

        @:% participation required for ranking
    }
</p>
@await Html.PartialAsync("_ResultsTable", Model.Series,
                                new ViewDataDictionary(this.ViewData) {
                                { "ExcludeCompetitorLinks", true }
                            })

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script src="~/vendor/bootstrap-select/js/bootstrap-select.min.js"></script>
}
